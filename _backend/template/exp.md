# 📘 Experiment Report Template

---
> **Name:** TODO  
> **ID:**  `[PROJECT]-[YYYYMMDD]-[topic]-[##]`  
> **Topic ｜ MVP:** `VIT` / `SpecDiffusion` |`moe` /  `diffusion` / ...  ｜ MVP-X.X (from roadmap.md)   
> **Author:** Viska Wei  
> **Date:** TODO  
> **Project:** `VIT` / `SpecDiffusion`  
> **Status:** 🔄 In Progress / ✅ Completed
---
## 🔗 Upstream Links

| Type | Link | Description |
|------|------|-------------|
| 🧠 Hub | `logg/[topic]/[topic]_hub_[YYYYMMDD].md` | Hypothesis pyramid |
| 🗺️ Roadmap | `logg/[topic]/[topic]_roadmap_[YYYYMMDD].md` | MVP design |
| 📋 Kanban | `status/kanban.md` | Experiment queue |
| 📚 Prerequisite | `[exp_xxx](./exp_xxx_YYYYMMDD.md)` | MVP-X.X (optional) |

---
# 📑 Table of Contents

- [⚡ Key Findings](#-key-findings-for-hub-extraction)
- [1. 🎯 Objective](#1--objective)
- [2. 🧪 Experiment Design](#2--experiment-design)
- [3. 📊 Figures & Results](#3--figures--results)
- [4. 💡 Insights](#4--insights)
- [5. 📝 Conclusions](#5--conclusions)
- [6. 📎 Appendix](#6--appendix)

---


## ⚡ 核心结论速览（供 main 提取）

> **本节在实验完成后第一时间填写。**
> **30行内应该有关节信息**

### 一句话总结

> **[用一句话概括本实验最重要的发现，包含关键数字]**

### 对假设的验证

| 验证问题 | 结果 | 结论 |
|---------|------|------|
| [Q from main] | ✅/❌ [数值] | [简短结论] |

### 设计启示（1-2 条）

| 启示 | 具体建议 |
|------|---------|
| [启示 1] | [建议] |
| [启示 2] | [建议] |

### 关键数字

| 指标 | 值 |
|------|-----|
| [核心指标 1] | [数值] |
| [核心指标 2] | [数值] |
| [对比 baseline] | [差值/提升] |

---

# 1. 🎯 目标

## 1.1 实验目的

> 从 main.md 的 MVP 设计中提取，明确本实验要回答的具体问题。

**核心问题**：[一句话说明]

**回答的问题**：
- [问题 1]
- [问题 2]

**对应 main.md 的**：
- 验证问题：Q[X]
- 子假设：H[X.X]

## 1.2 预期结果

| 场景 | 预期结果 | 判断标准 |
|------|---------|---------|
| 正常情况 | [预期数值范围] | 验收通过 |
| 异常情况 A | [如果出现这个结果] | 需要 [处理方式] |
| 异常情况 B | [如果出现这个结果] | 需要 [处理方式] |

---

# 2. 🧪 实验设计

## 2.1 数据

> ⚠️ **必须详细记录**：后续实验可能更换数据集或噪声设定，完整记录便于对比和复现。

### 数据来源与规模

| 配置项 | 值 | 说明 |
|--------|-----|------|
| **数据来源** | | 如 APOGEE DR17 / 合成数据 |
| **数据路径** | | 如 `~/VIT/data/apogee_100k.h5` |
| **数据大小** | | 文件大小或总样本数，如 2.3GB / 100k samples |
| **训练样本数** | | |
| **验证样本数** | | |
| **测试样本数** | | |
| **特征维度** | | 光谱长度/像素数 |
| **波长范围** | | 如 15100-17000 Å |
| **标签参数** | | 如 log_g |
| **辅助参数** | | 如 Teff, Fe_H（如有） |

### 噪声配置

| 配置项 | 值 | 说明 |
|--------|-----|------|
| **噪声类型** | | gaussian / poisson / snr_based / none |
| **噪声水平 noise level** | 0.1 | 高斯噪声标准差 |
| **SNR** | | 信噪比（如适用） |
| **应用范围** | | train / train+val / all |

**噪声添加公式**：

$$
\text{noisy\_flux} = \text{flux} + \mathcal{N}(0, \sigma^2)
$$

> 如果是 SNR-based：$\sigma = \text{flux} / \text{SNR}$

**Noise levels**: $\sigma \in \{...\}$

### 数据预处理

| 步骤 | 配置 |
|------|------|
| **归一化** | 如 StandardScaler / MinMax / 无 |
| **特征选择** | 如 Top-K / PCA / 全部 |
| **其他处理** | 如 continuum normalization |

## 2.2 模型与算法

### [模型名称 1]

$$
[公式]
$$

**超参数**：
- [参数 1]：[值/范围]
- [参数 2]：[值/范围]

### [模型名称 2]（可选）

[模型描述]

## 2.3 超参数配置

> ⚠️ **必须记录所有参数**：包括 default 值！后续实验可能调整这些参数，完整记录便于追溯和对比。

### 训练超参数

| 参数 | 值 | 说明 |
|------|-----|------|
| **epochs** | | 训练轮数 |
| **batch_size** | | 批大小 |
| **learning_rate** | | 学习率 |
| **optimizer** | | 如 Adam / AdamW / SGD |
| **weight_decay** | | L2 正则化系数 |
| **scheduler** | | 如 CosineAnnealing / StepLR / None |
| **grad_clip** | | 梯度裁剪阈值 |
| **early_stopping** | | true/false + patience |
| **random_seed** | | 随机种子（复现性） |

### 模型超参数

| 参数 | 范围/值 | 说明 |
|------|--------|------|
| [参数 1] | [范围] | [为什么选这个范围] |
| [参数 2] | [范围] | |

### 本实验扫描的参数

| 扫描参数 | 扫描范围 | 固定参数 |
|---------|---------|---------|
| [参数名] | [范围] | [其他固定参数一览] |

## 2.4 评价指标

| 指标 | 公式 | 用途 |
|------|------|------|
| $R^2$ | $1 - \frac{\sum(y - \hat{y})^2}{\sum(y - \bar{y})^2}$ | 主要评价指标 |
| MAE | $\frac{1}{n}\sum\|y - \hat{y}\|$ | 绝对误差参考 |
| RMSE | $\sqrt{\frac{1}{n}\sum(y - \hat{y})^2}$ | 与 $R^2$ 配合 |

---

# 3. 📊 实验图表

> 每张图配有标题、描述和关键观察。

### 图 1：[图表标题]

![图片](./img/[filename].png)

**Figure 1. [一句话描述图表内容]**

**关键观察**：
- [观察点 1]
- [观察点 2]
- [观察点 3]

---

### 图 2：[图表标题]

![图片](./img/[filename].png)

**Figure 2. [一句话描述图表内容]**

**关键观察**：
- [观察点 1]
- [观察点 2]

---

# 4. 💡 关键洞见

> 分层次组织洞见，从宏观到微观。

## 4.1 宏观层洞见

> 用于指导架构设计、理解问题本质的高层次发现。

[洞见描述，最好配表格/数据支撑]

| [维度] | [指标] | [解释] |
|--------|--------|--------|
| | | |

## 4.2 模型层洞见

> 用于优化模型、调参的中层次发现。

- [洞见 1]
- [洞见 2]

## 4.3 实验层细节洞见

> 具体的实验观察和技术细节。

- [洞见 1]
- [洞见 2]

---

# 5. 📝 结论

## 5.1 核心发现

> 用一句话总结本实验最重要的发现（punch line）。

> **[核心发现一句话]**

**假设验证**：
- ❌ 原假设：[原来以为是什么]
- ✅ 实验结果：[实际发现是什么]

## 5.2 关键结论（2-4 条）

| # | 结论 | 证据 |
|---|------|------|
| 1 | **[结论关键词]** | [支撑数据/观察] |
| 2 | **[结论关键词]** | [支撑数据/观察] |
| 3 | **[结论关键词]** | [支撑数据/观察] |

## 5.3 设计启示

### 架构/方法原则

| 原则 | 建议 | 原因 |
|------|------|------|
| [原则名] | [具体做法] | [为什么] |

### ⚠️ 常见陷阱

| 常见做法 | 实验证据 |
|----------|----------|
| "[错误做法]" | [为什么是错的/会导致什么问题] |

## 5.4 物理解释（可选）

> 用领域知识解释为什么会有这样的结果。

- [解释 1]
- [解释 2]

## 5.5 关键数字速查

| 指标 | 值 | 配置/条件 |
|------|-----|----------|
| 最佳性能 | [数值] | [配置] |
| 达到目标的最小条件 | [数值] | [条件] |
| 性能天花板 | [数值] | [配置] |
| 与 baseline 对比 | [差值/比例] | |

## 5.6 下一步工作

> 基于本实验结果，建议的后续方向。

| 方向 | 具体任务 | 优先级 | 对应 MVP |
|------|----------|--------|---------|
| [方向 1] | [具体做什么] | 🔴/🟡/🟢 | MVP-X.X |
| [方向 2] | [具体做什么] | 🔴/🟡/🟢 | MVP-X.X |

---

# 6. 📎 附录

## 6.1 数值结果表

> 完整的实验数值结果。

### 主要结果

| 配置 | $R^2$ | MAE | RMSE | 备注 |
|------|-------|-----|------|------|
| [配置 1] | | | | |
| [配置 2] | | | | |
| [配置 3] | | | | |

### [维度扫描名称]（如 Noise Level）

| [维度] | $R^2$ | MAE | RMSE | 备注 |
|--------|-------|-----|------|------|
| [值 1] | | | | |
| [值 2] | | | | |
| [值 3] | | | | |

---

## 6.2 实验流程记录

> 记录实验执行过程，便于复现和追溯。

### 6.2.1 环境与配置

| 项目 | 值 |
|------|-----|
| **仓库** | `~/VIT` / `~/BlindSpotDenoiser` |
| **Config 路径** | `configs/xxx.yaml` |
| **输出路径** | `lightning_logs/version_X` |
| **Python** | 3.x |
| **关键依赖** | PyTorch X.X, Lightning X.X |

### 6.2.2 执行命令

```bash
# Step 1: 数据准备（如有）
python prepare_data.py --input xxx --output xxx

# Step 2: 训练
python train.py --config configs/xxx.yaml

# Step 3: 评估
python eval.py --ckpt lightning_logs/version_X/checkpoints/best.ckpt

# Step 4: 生成图表
python plot.py --exp_id [experiment_id]
```

### 6.2.3 运行日志摘要

```
# 关键日志输出
[粘贴关键的训练日志、评估结果等]
```

### 6.2.4 调试记录（如有）

| 问题 | 原因 | 解决方案 |
|------|------|---------|
| [问题描述] | [原因分析] | [如何解决] |

---

## 6.3 相关文件

| 类型 | 路径 | 说明 |
|------|------|------|
| 主框架 | `logg/[topic]/[topic]_main_YYYYMMDD.md` | main 文件 |
| 本报告 | `logg/[topic]/exp_[name]_YYYYMMDD.md` | 当前文件 |
| 图表 | `logg/[topic]/img/` | 实验图表 |
| 实验代码 | `scripts/xxx.py` | 实验脚本 |

### 跨仓库链接

| 仓库 | 路径 | 说明 |
|------|------|------|
| 实验索引 | `experiments_index/index.csv` | 中央索引 |
| VIT 源 | `~/VIT/[output_path]` | VIT 训练结果 |
| BlindSpot 源 | `~/BlindSpotDenoiser/[output_path]` | BlindSpot 结果 |

---

## 6.4 实验日志（可选）

> 记录实验过程中的关键事件和决策。

| 时间 | 事件 | 处理 |
|------|------|------|
| [时间] | [遇到的问题/发现] | [如何处理] |

## 🔗 Cross-Repo Metadata

| Field | Value |
|-------|-------|
| **source_repo_path** | `~/VIT/results/xxx` or `~/BlindSpotDenoiser/evals/xxx` |
| **config_path** | `configs/xxx.yaml` |
| **output_path** | `lightning_logs/version_X` or `results/xxx` |

---

> **模板使用说明**：
> 
> **语言规范**：
> - 开头（Header）、Upstream links、Table of contents（前30行）用英文写
> 
> **设计原则**：前 300 行能快速了解实验最重要的信息
> - ⚡ 核心结论速览：30 秒了解实验发现
> - §1-2 目标+设计：理解实验方案
> - §3-4 图表+洞见：看到结果和分析
> - §5 结论：完整结论和下一步
> - §6 附录：实验流程、完整数据（供复现用）
> 
> **工作流程**：
> 1. **实验前**：填写 §1（目标）、§2（实验设计）
> 2. **实验中**：记录结果到 §6.1，添加图表到 §3，记录流程到 §6.2
> 3. **实验后**：填写 §4（洞见）、§5（结论）
> 4. **最后**：填写 ⚡核心结论速览，同步到 main.md
> 
> **与 main.md 的关系**：
> - exp.md 的 ⚡核心结论速览 → 直接复制到 main.md §3.3 结论提取记录
> - exp.md 的 §5.6 下一步工作 → 反馈到 main.md §5.4 下一步计划
> - main.md 提出假设 (H) 和验证问题 (Q) → exp.md 验证并回答
> 
> **LaTeX 公式规范**：
> - 行内公式：`$R^2 = 0.99$`
> - 独立公式块：`$$..$$`
> - 下划线变量：`$\log g$` 或 `log\_g`

