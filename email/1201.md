Subject: log g 预测实验阶段性结果汇报（附全局总结文档）

老师您好，

近期我把 log g 预测相关的所有传统 ML 与神经网络实验做了一轮系统整理，形成了一份主笔记 `logg_main_20251130.md`，作为当前阶段的“全局结论”和后续 NN 架构设计的依据，现随邮件附上，下面是最关键的几条结果（含数据）：

---

**1. 信息结构：本质线性 + 高维但稀疏**

* 在无噪声条件下，Ridge 回归可达到 **R² = 0.999**，说明 $\log g$–flux 映射在理想情况下几乎完全线性。
* PCA + Ridge 表明，有效信息集中在约 **100–200 个主成分**上：k < 50 明显欠拟合，k ≥ 100 才能恢复到 R² ≳ 0.99。
* Top-K 特征实验显示，只使用约 **24% 像素**（K≈1000）即可接近全谱基线，说明信息在波长轴上是“高维但稀疏”的。

---

**2. 标准噪声 (noise=1.0) 下的模型对比**

在 32k 训练样本、noise=1.0 条件下：

* Ridge（最优 α）约 **R² ≈ 0.458**。
* LightGBM 可提升到 **R² ≈ 0.536**。
* 引入 **Linear Shortcut** 的 Residual MLP（让 MLP 只学习 Ridge 残差），可达到 **R² ≈ 0.498**，比纯 Ridge 提升约 **+8.7%**。
* 在同样任务上将训练样本扩展到 **100k**，MLP 最佳 R² 可进一步提升到 **≈ 0.551**，相较 32k 提升约 **+10.6%**，说明数据量本身是非常关键的杠杆。

---

**3. CNN 结果：小卷积核显著优于大卷积核**

在 noise=0.1 的设定下，系统扫描了一系列 1D CNN 配置：

* **小卷积核 CNN（kernel=9，2 层 1D Conv + AdaptiveAvgPool）可达到 R² ≈ 0.657，是当前最好的 NN 结果。**
* 随 kernel / 感受野继续变大（例如 k=21, 45, 63；感受野从 61 增长到 133、187），R² 反而从 0.6 级别下降到接近 0，说明“更大感受野并不会带来更好 log g 表征”，反而破坏了局部谱线形状建模。
* 这与“log g 主要由局部线型（而非全局连续形状）决定”的物理直觉是吻合的。

---

**4. 架构设计启示（为后续 Physics-Informed NN 准备）**

综合 ridge / PCA / LightGBM / CNN / latent probe 的结果，目前可以比较清晰地给出几条神经网络设计原则：

1. **必须保留线性 shortcut：**
   由于无噪声时几乎全线性，建议统一采用
   [
   \hat y = w^\top x + g_\theta(x)
   ]
   的结构，让 NN 专注于“纠正噪声与非线性残差”。

2. **小 kernel + 全局池化优于大感受野：**
   局部 kernel (k=7–9) 负责建模局部谱线形状，全局信息通过池化或后续全连接聚合，而不是通过扩大卷积感受野硬编码。

3. **Global Feature Tower 需要 ~100–150 维输入：**
   PCA 及 Top-K/latent 实验都指向一个结论：一个中等维度（~100–150）的 global 特征向量，就足以承载大部分 log g 信息，这为后续“全局特征塔 + 局部光谱塔”的 Physics-Informed 架构提供了明确容量参考。

---

**5. 下一步计划（已开始设计的 MVP 实验）**

在上述结论基础上，下一步我计划优先推进两条主线（目前已在设计具体实验配置）：

1. **Top-K window + CNN / 小 Transformer：**
   用 Top-K 重要像素的邻域窗口（而非单点）构建“局部谱线序列”，在 noise=0 和 0.1 下做一版残差 CNN/Transformer，目标是不明显落后于 Ridge / LightGBM。

2. **Global Feature Tower + MLP baseline：**
   将 PCA 成分、Ridge 预测、Top-K segment 统计量、noise summary、latent segment 特征统一成一个 ~150 维的 global feature 向量，训练一个 Residual MLP，作为后续 Physics-Informed 大模型的“信息上界参考”。

---

以上是当前阶段的关键结果和对后续网络设计的直接启示，详细的实验表格、图和分目录总结已整理在附件 `logg_main_20251130.md` 中，方便您随时查阅。

如您方便，我也很希望在接下来的一次组会中，用 10 分钟左右的时间做一个简短汇报，讨论一下后续 Physics-Informed 结构（Global Tower + Local Tower）的设计方向。

谢谢老师的时间！

此致
敬礼

Viska
