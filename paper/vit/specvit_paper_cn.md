# SpecViT-Scale: é¢å‘ CramÃ©râ€“Rao ç•Œé™çš„æ’æ˜Ÿå…‰è°±å›å½’ Vision Transformer è§„æ¨¡åŒ–ç ”ç©¶

> **çŠ¶æ€:** ğŸ“ è‰ç¨¿ (v2)  
> **æ—¥æœŸ:** 2025-12-27  
> **ä½œè€…:** Viska Wei ç­‰

---

## æ ‡é¢˜å¤‡é€‰

1. **SpecViT-Scale: é¢å‘ CramÃ©râ€“Rao ç•Œé™çš„æ’æ˜Ÿå…‰è°±å›å½’ Vision Transformer è§„æ¨¡åŒ–ç ”ç©¶**
2. ä½¿ç”¨ Vision Transformer é€¼è¿‘æ’æ˜Ÿ log(g) æ¨æ–­çš„ Fisher/CRLB æé™
3. ç‰©ç†æ„ŸçŸ¥ Tokenization èµ‹èƒ½æ•°æ®è§„æ¨¡åŒ– Vision Transformer çš„æ’æ˜Ÿå…‰è°±æ¨æ–­

---

## æ‘˜è¦

å¤§è§„æ¨¡å…‰è°±å·¡å¤©é¡¹ç›®éœ€è¦å¿«é€Ÿã€é²æ£’çš„æ’æ˜Ÿå‚æ•°æ¨æ–­ï¼›å™ªå£°å’Œè°±çº¿æ··å é™åˆ¶äº†ä¼ ç»Ÿæ¨¡æ¿æ‹Ÿåˆå’Œæµ…å±‚æœºå™¨å­¦ä¹ æ–¹æ³•çš„æ€§èƒ½ã€‚æˆ‘ä»¬æå‡ºå¹¶ç³»ç»Ÿè¯„ä¼° SpecViTï¼Œä¸€ä¸ªåŸºäº Vision Transformer çš„ä¸€ç»´å…‰è°±å›å½’æ¡†æ¶ï¼Œé‡‡ç”¨å…‰è°±å®šåˆ¶åŒ– tokenizationï¼ˆConv1D/æ»‘åŠ¨çª—å£ patch embeddingã€chunk normalization ä»¥åŠå¯é€‰çš„ç‰©ç†æ„ŸçŸ¥ä½ç½®ç¼–ç ï¼‰ï¼Œåœ¨å¼‚æ–¹å·®å™ªå£°æ¡ä»¶ä¸‹è®­ç»ƒã€‚

**æ ¸å¿ƒè´¡çŒ® 1ï¼ˆè§„æ¨¡åŒ–ï¼‰:** æˆ‘ä»¬è¯æ˜**æ•°æ®è§„æ¨¡æ˜¯ ViT æˆåŠŸçš„å…³é”®ç“¶é¢ˆ**ï¼›åœ¨ 100 ä¸‡æ¡ BOSZ åˆæˆå…‰è°±ä¸Šï¼Œlog(g) å›å½’è¾¾åˆ° **RÂ² = 0.711ï¼ˆæµ‹è¯•é›†ï¼Œ10k æ ·æœ¬ï¼‰**ï¼ŒMAE â‰ˆ 0.37 dexï¼Œæ˜¾è‘—ä¼˜äºæ ‘æ¨¡å‹ï¼ˆLightGBM: RÂ² = 0.614ï¼Œ+16%ï¼‰å’Œæ¨¡æ¿æ‹Ÿåˆï¼ˆRÂ² = 0.404ï¼Œ+76%ï¼‰ã€‚

**æ ¸å¿ƒè´¡çŒ® 2ï¼ˆç†è®ºä¸Šé™ï¼‰:** æˆ‘ä»¬å¼•å…¥ Fisher ä¿¡æ¯ / CramÃ©râ€“Rao ä¸‹ç•Œï¼ˆCRLBï¼‰å»ºç«‹**ä¿¡å™ªæ¯”æ¡ä»¶ä¸‹çš„ç†è®ºä¸Šé™**ã€‚5D è¾¹ç¼˜åŒ–ä¸Šé™ï¼ˆè€ƒè™‘ Teffã€[M/H] å’ŒåŒ–å­¦ä¸°åº¦ï¼‰åœ¨ mag=21.5ï¼ˆSNRâ‰ˆ7ï¼‰æ—¶ç»™å‡º RÂ²_max = 0.874ã€‚

**ç»“æœ:** SpecViT åœ¨æ‰€æœ‰ä¿¡å™ªæ¯”åŒºé—´é€¼è¿‘ç†è®ºä¸Šé™ï¼šåœ¨ mag=22.0ï¼ˆSNRâ‰ˆ5ï¼‰å¤„ï¼ŒViT è¾¾åˆ° RÂ² = 0.68ï¼Œè€Œç†è®ºä¸Šé™ RÂ²_max = 0.70ï¼Œå·®è·ä»…ä¸º 0.02â€”â€”è¯æ˜æ¨¡å‹åœ¨é«˜å™ªå£°æ¡ä»¶ä¸‹å‡ ä¹æå–äº†æ‰€æœ‰å¯ç”¨ä¿¡æ¯ã€‚é«˜ SNR åŒºé—´çš„å‰©ä½™å·®è·ä¸»è¦å½’å› äº tokenization è®¾è®¡å’Œæ¨¡å‹å®¹é‡ï¼Œè€Œéæ•°æ®å™ªå£°æœ¬èº«ã€‚

---

## 1. å¼•è¨€

### 1.1 å¤©æ–‡å­¦èƒŒæ™¯

å¤§è§„æ¨¡å…‰è°±å·¡å¤©é¡¹ç›®ï¼ˆSDSSã€LAMOSTã€Gaiaã€DESIã€PFSï¼‰æ­£åœ¨äº§ç”Ÿæ•°ç™¾ä¸‡æ¡æ’æ˜Ÿå…‰è°±ï¼Œéœ€è¦è‡ªåŠ¨åŒ–ã€é²æ£’çš„æ’æ˜Ÿå‚æ•°ä¼°è®¡ã€‚ä¼ ç»Ÿçš„ç‰©ç†æ¨¡æ¿æ‹Ÿåˆå’Œå…‰è°±çº¿æ‹Ÿåˆæ–¹æ³•è®¡ç®—æˆæœ¬é«˜ï¼Œä¸”å¯¹å™ªå£°ã€è°±çº¿æ··å å’Œæ¨¡æ¿è¦†ç›–èŒƒå›´æ•æ„Ÿã€‚

### 1.2 æœºå™¨å­¦ä¹ ç”¨äºå…‰è°±åˆ†æ

ç»å…¸ ML æ–¹æ³•ï¼ˆéšæœºæ£®æ—ã€æ¢¯åº¦æå‡æ ‘ã€The Cannonã€The Payneï¼‰å·²å–å¾—æˆåŠŸï¼Œä½†ä¾èµ–æ‰‹å·¥ç‰¹å¾æˆ–å‡è®¾ç‰¹å®šå‡½æ•°å½¢å¼ã€‚æ·±åº¦å­¦ä¹ æ–¹æ³•ï¼ˆ1D CNNã€è‡ªç¼–ç å™¨ï¼‰å¯æ•æ‰å±€éƒ¨æ¨¡å¼ï¼Œä½†å¯èƒ½é”™è¿‡é•¿ç¨‹å…‰è°±ä¾èµ–å…³ç³»ã€‚

### 1.3 Transformer çš„æœºé‡

Vision Transformerï¼ˆViTï¼‰é€šè¿‡å…¨å±€è‡ªæ³¨æ„åŠ›å½»åº•æ”¹å˜äº†å›¾åƒå¤„ç†ï¼Œä½†å°†å…¶åº”ç”¨äºä¸€ç»´å…‰è°±é¢ä¸´ç‹¬ç‰¹æŒ‘æˆ˜ï¼š
- **å…‰è°± â‰  å›¾åƒ**ï¼šå…·æœ‰ç‰©ç†æ„ä¹‰æ³¢é•¿åæ ‡çš„ä¸€ç»´è¿ç»­ä¿¡å·
- **Tokenization è‡³å…³é‡è¦**ï¼šPatch embedding å¿…é¡»ä¿ç•™å…‰è°±çº¿ç»“æ„å’Œè¿ç»­æ€§
- **æ•°æ®é¥¥æ¸´**ï¼šTransformer ç¼ºä¹ CNN çš„å½’çº³åç½®ï¼Œéœ€è¦æ›´å¤§æ•°æ®é›†

### 1.4 æˆ‘ä»¬çš„è´¡çŒ®

1. **SpecViT æ¡†æ¶**ï¼šé’ˆå¯¹ä¸€ç»´æ’æ˜Ÿå…‰è°±å®šåˆ¶çš„ Vision Transformer æ¶æ„ï¼Œå…·æœ‰ä¸“é—¨çš„ tokenizationï¼ˆC1D/SW patch embeddingï¼‰ã€ä½ç½®ç¼–ç å’Œå›å½’å¤´ã€‚

2. **è§„æ¨¡åŒ–å®šå¾‹å‘ç°**ï¼šæˆ‘ä»¬è¯æ˜**æ•°æ®è§„æ¨¡æ˜¯ ViT æˆåŠŸçš„å…³é”®**ã€‚100 ä¸‡è®­ç»ƒå…‰è°±ä¸‹ï¼ŒViT è¾¾åˆ° RÂ² = 0.711ï¼ˆæµ‹è¯•é›†ï¼‰ï¼Œæ¯” LightGBM é«˜ +16%ï¼Œæ¯”æ¨¡æ¿æ‹Ÿåˆé«˜ +76%ã€‚ViT åœ¨ 100k æ•°æ®è§„æ¨¡é¦–æ¬¡è¶…è¶Š LightGBMï¼Œscaling æ–œç‡æ˜¯ä¼ ç»Ÿ ML çš„ 2.2Ã—ã€‚

3. **Fisher/CRLB ç†è®ºä¸Šé™**ï¼šä½¿ç”¨ 5D Fisher ä¿¡æ¯ï¼ˆè¾¹ç¼˜åŒ– Teffã€[M/H]ã€Î±_Mã€C_Mï¼‰ï¼Œåœ¨ mag=21.5 æ—¶æä¾› RÂ²_max = 0.874 ä½œä¸ºç‰©ç†åŸºå‡†ã€‚

4. **å·®è·åˆ†æ**ï¼šæˆ‘ä»¬é‡åŒ–äº† SpecViT ä¸ç†è®ºä¸Šé™åœ¨æ‰€æœ‰ SNR åŒºé—´çš„å·®è·ã€‚åœ¨ mag=22.0ï¼ˆSNRâ‰ˆ5ï¼‰ï¼Œå·®è·ç¼©å°è‡³ä»… 0.02ï¼Œè¯æ˜ SpecViT é€¼è¿‘ç‰©ç†æé™ã€‚

---

## 2. ç›¸å…³å·¥ä½œ

### 2.1 åŸºäºç‰©ç†çš„æ–¹æ³•

- **æ¨¡æ¿æ‹Ÿåˆ**ï¼šä¸åˆæˆå…‰è°±åº“ï¼ˆBOSZã€PHOENIXã€Kuruczï¼‰çš„ Ï‡Â² æœ€å°åŒ–
- **å…‰è°±çº¿æ‹Ÿåˆ**ï¼šç›´æ¥æµ‹é‡ç­‰æ•ˆå®½åº¦å’Œçº¿æ¯”
- **å±€é™æ€§**ï¼šè®¡ç®—æˆæœ¬é«˜ã€æ¨¡æ¿è¦†ç›–æœ‰é™ã€è°±çº¿æ··å ã€å™ªå£°æ•æ„Ÿ

### 2.2 ç»å…¸æœºå™¨å­¦ä¹ 

- **PCA + å›å½’**ï¼šé™ç»´åæ¥ Ridge/LASSO å›å½’
- **éšæœºæ£®æ— / æ¢¯åº¦æå‡æ ‘**ï¼šç‰¹å¾é‡è¦æ€§å’Œéçº¿æ€§æ˜ å°„
- **The Cannon / The Payne**ï¼šå¸¦ç‰©ç†å…ˆéªŒçš„æ•°æ®é©±åŠ¨æ¨¡å‹
- **å±€é™æ€§**ï¼šç‰¹å¾å·¥ç¨‹ã€å¤æ‚æ¨¡å¼å®¹é‡æœ‰é™

### 2.3 å…‰è°±æ·±åº¦å­¦ä¹ 

- **1D CNN**ï¼šå±€éƒ¨æ„Ÿå—é‡ã€å¹³ç§»ä¸å˜æ€§
- **è‡ªç¼–ç å™¨**ï¼šæ— ç›‘ç£ç‰¹å¾å­¦ä¹ 
- **å…‰è°± Transformer**ï¼šæ–°å…´çš„å…‰è°±åˆ†ææ³¨æ„åŠ›æœºåˆ¶
- **å…³é”®æ´è§**ï¼šTokenization å’Œä½ç½®ç¼–ç æ˜¯å…³é”®å·¥ç¨‹é€‰æ‹©

---

## 3. é—®é¢˜è®¾å®šä¸æ•°æ®

### 3.1 ä»»åŠ¡å®šä¹‰

**ä¸»è¦ä»»åŠ¡:** ä»ä¸€ç»´å…‰è°±è¿›è¡Œæ’æ˜Ÿè¡¨é¢é‡åŠ›ï¼ˆlog gï¼‰å›å½’ã€‚

**è¯„ä¼°æŒ‡æ ‡:**
- $R^2$ï¼ˆå†³å®šç³»æ•°ï¼‰ï¼šå°ºåº¦ä¸å˜ï¼Œå¯è·¨å½’ä¸€åŒ–æ–¹æ¡ˆæ¯”è¾ƒ
- MAEï¼ˆå¹³å‡ç»å¯¹è¯¯å·®ï¼‰ï¼šåŸå§‹ log(g) ç©ºé—´ï¼ˆdexï¼‰

### 3.2 æ•°æ®é›†

| å±æ€§ | å€¼ |
|------|-----|
| æ¥æº | BOSZ åˆæˆå…‰è°±ï¼ˆBohlin et al. 2017ï¼‰|
| æ³¢é•¿èŒƒå›´ | 7100â€“8850 Ã…ï¼ˆMR è‡‚ï¼‰|
| è¾“å…¥ç»´åº¦ | 4096 åƒç´  |
| å‚æ•°èŒƒå›´ | Teff: 3750â€“6000 K, log g: 1â€“5, [M/H]: -0.25â€“0.75 |
| æ˜Ÿç­‰èŒƒå›´ | 20.5â€“22.5 mag |
| **è®­ç»ƒé›†** | **1,000,000** æ¡å…‰è°±ï¼ˆ5 shards Ã— 200kï¼‰|
| éªŒè¯é›† | 1,000 æ¡å…‰è°± |
| æµ‹è¯•é›† | 10,000 æ¡å…‰è°± |

### 3.3 å™ªå£°æ¨¡å‹

æˆ‘ä»¬é‡‡ç”¨å¼‚æ–¹å·®é«˜æ–¯å™ªå£°ï¼Œæ¨¡æ‹Ÿå…‰å­è®¡æ•°çš„æ³Šæ¾ç»Ÿè®¡ï¼š

$$\text{noisy\_flux}_i = \text{flux}_i + \epsilon_i, \quad \epsilon_i \sim \mathcal{N}(0, (\text{noise\_level} \times \text{error}_i)^2)$$

å…¶ä¸­ $\text{error}_i$ æ˜¯æ¥è‡ªå™ªå£°æ¨¡å‹çš„é€åƒç´ è¯¯å·®ä¼°è®¡ã€‚

**è®­ç»ƒï¼š** å®æ—¶å™ªå£°æ³¨å…¥ï¼ˆæ•°æ®å¢å¼ºï¼Œ~200Ã— æœ‰æ•ˆæ ·æœ¬ï¼‰
**éªŒè¯/æµ‹è¯•ï¼š** å›ºå®šç§å­é¢„ç”Ÿæˆï¼Œä¿è¯å¯é‡å¤æ€§

---

## 4. æ–¹æ³•ï¼šSpecViT

### 4.1 æ¦‚è¿°

```
è¾“å…¥å…‰è°± (4096,)
       â†“
[Patch Embedding / Tokenization]
   â”œâ”€â”€ Tokenizer: C1D æˆ– SW â†’ (batch, 256, patch_size=16)
   â”œâ”€â”€ çº¿æ€§æŠ•å½± â†’ (batch, 256, hidden_size=256)
   â”œâ”€â”€ æ·»åŠ  CLS Token â†’ (batch, 257, 256)
   â””â”€â”€ åŠ ä½ç½®ç¼–ç  â†’ (batch, 257, 256)
       â†“
[ViT Encoder] Ã— 6 å±‚
   â”œâ”€â”€ å¤šå¤´è‡ªæ³¨æ„åŠ› (8 heads)
   â”œâ”€â”€ LayerNorm + æ®‹å·®
   â”œâ”€â”€ FFN (hidden â†’ 4Ã—hidden â†’ hidden)
   â””â”€â”€ LayerNorm + æ®‹å·®
       â†“
[CLS Token æå–]
   â””â”€â”€ outputs[:, 0, :] â†’ (batch, 256)
       â†“
[å›å½’å¤´]
   â””â”€â”€ Linear(256, 1) â†’ log_g é¢„æµ‹
```

### 4.2 Tokenization / Patch Embedding

æˆ‘ä»¬æ¢ç´¢ä¸¤ç§å°†ä¸€ç»´å…‰è°±è½¬æ¢ä¸º token åºåˆ—çš„ç­–ç•¥ï¼š

| æ–¹æ³• | å®ç° | å…¬å¼ | ç‰¹æ€§ |
|------|------|------|------|
| **C1D** (Conv1D) | `nn.Conv1d(1, 256, kernel=16, stride=16)` | $y_i = W * x[i \cdot s : i \cdot s + k]$ | å­¦ä¹ å±€éƒ¨ç‰¹å¾ï¼Œå‚æ•°å…±äº« |
| **SW** (æ»‘åŠ¨çª—å£) | `unfold() + nn.Linear(16, 256)` | $y_i = W \cdot x[i \cdot s : i \cdot s + k] + b$ | çº¿æ€§æŠ•å½±ï¼Œæ›´ç®€å• |

ä½¿ç”¨ patch_size=16ã€stride=16ï¼Œä» 4096 ä¸ªæ³¢é•¿åƒç´ è·å¾— 256 ä¸ª tokenã€‚

### 4.3 ä½ç½®ç¼–ç 

æˆ‘ä»¬ä½¿ç”¨å¯å­¦ä¹ ä½ç½®ç¼–ç ï¼š

$$\text{tokens} = \text{tokens} + \text{PE}, \quad \text{PE} \in \mathbb{R}^{(257 \times 256)}$$

*æœªæ¥å·¥ä½œï¼šä½¿ç”¨æ³¢é•¿åæ ‡çš„ç‰©ç†æ„ŸçŸ¥ä½ç½®ç¼–ç ï¼ˆPIPEï¼‰*

### 4.4 Transformer ç¼–ç å™¨

æ ‡å‡† ViT ç¼–ç å™¨ï¼š
- $L = 6$ å±‚
- $d_{\text{model}} = 256$ï¼ˆéšè—å±‚å¤§å°ï¼‰
- $h = 8$ æ³¨æ„åŠ›å¤´
- $d_k = 32$ï¼ˆå¤´ç»´åº¦ï¼‰
- FFN ä¸­é—´å±‚å¤§å°ï¼š1024

**æ³¨æ„åŠ›æœºåˆ¶ï¼š**
$$\text{Attention}(Q, K, V) = \text{softmax}\left(\frac{QK^T}{\sqrt{d_k}}\right) V$$

### 4.5 è®­ç»ƒç›®æ ‡

**æŸå¤±å‡½æ•°ï¼š**
- MSE: $L = \frac{1}{n}\sum(y - \hat{y})^2$
- L1/MAE: $L = \frac{1}{n}\sum|y - \hat{y}|$

**æ ‡ç­¾å½’ä¸€åŒ–ï¼š**
- Standard (z-score): $\tilde{y} = \frac{y - \mu}{\sigma}$
- MinMax: $\tilde{y} = \frac{y - y_{\min}}{y_{\max} - y_{\min}}$

**æ³¨æ„ï¼š** $R^2$ å¯¹çº¿æ€§å˜æ¢ä¸å˜ï¼Œå…è®¸è·¨å½’ä¸€åŒ–æ–¹æ¡ˆç›´æ¥æ¯”è¾ƒã€‚

**è®­ç»ƒé…ç½®ï¼š**

| å‚æ•° | å€¼ |
|------|-----|
| ä¼˜åŒ–å™¨ | AdamW |
| å­¦ä¹ ç‡ | 3e-4 |
| æƒé‡è¡°å‡ | 0.01 |
| å­¦ä¹ ç‡è°ƒåº¦ | Cosine Annealing (Î·_min=1e-5) |
| Epochs | 200 |
| Batch Size | 256 |
| ç²¾åº¦ | æ··åˆç²¾åº¦ (FP16) |
| æ¢¯åº¦è£å‰ª | 0.5 |

---

## 5. é€šè¿‡ Fisher ä¿¡æ¯ / CRLB çš„ç†è®ºä¸Šé™

### 5.1 å…‰è°±é›…å¯æ¯”çŸ©é˜µçš„ Fisher ä¿¡æ¯

å¯¹äºå…‰è°±æ¨¡å‹ $f(\theta)$ï¼Œå‚æ•° $\theta = (T_{\text{eff}}, \log g, [M/H], ...)$ å’Œå¼‚æ–¹å·®å™ªå£°åæ–¹å·® $\Sigma$ï¼ŒFisher ä¿¡æ¯çŸ©é˜µä¸ºï¼š

$$I(\theta) = J^\top \Sigma^{-1} J$$

å…¶ä¸­ $J = \frac{\partial f}{\partial \theta}$ æ˜¯å…‰è°±å¯¹å‚æ•°çš„é›…å¯æ¯”çŸ©é˜µã€‚

### 5.2 log(g) çš„è¾¹ç¼˜åŒ– CRLB

ä½¿ç”¨ Schur è¡¥å¯¹ nuisance å‚æ•° $\eta = (T_{\text{eff}}, [M/H], ...)$ è¿›è¡Œè¾¹ç¼˜åŒ–ï¼š

$$\text{CRLB}_{g,\text{marg}} = \left(I_{gg} - I_{g\eta} I_{\eta\eta}^{-1} I_{\eta g}\right)^{-1}$$

### 5.3 CRLB è½¬ RÂ²

$$R^2_{\max} = 1 - \frac{\text{CRLB}_{g,\text{marg}}}{\text{Var}(\log g)}$$

è¿™ç»™å‡ºäº†åœ¨ç»™å®šå™ªå£°æ¡ä»¶ä¸‹ä»»ä½•æ— åä¼°è®¡å™¨å¯è¾¾åˆ°çš„ç†è®ºæœ€å¤§ $R^2$ã€‚

### 5.4 å…³é”®ç»“æœï¼ˆ5D è¾¹ç¼˜åŒ–ä¸Šé™ï¼‰

| æ˜Ÿç­‰ | SNR | $R^2_{\max}$ (5D) | è§£é‡Š |
|------|-----|-------------------|------|
| 18.0 | 87.4 | 0.999 | è¿‘ä¹å®Œç¾ä¼°è®¡ |
| 20.0 | 24.0 | 0.989 | ä¼˜ç§€ |
| 21.5 | 7.1 | **0.874** | è‰¯å¥½ï¼ˆä¸»è¦å¯¹æ¯”ç‚¹ï¼‰|
| 22.0 | 4.6 | 0.698 | ä¸­ç­‰ |
| 22.5 | 3.0 | 0.265 | å›°éš¾ |
| 23.0 | 1.9 | 0.000 | ä¿¡æ¯æ‚¬å´– |

**å…³é”®æ´è§ï¼š**
1. Schur è¡°å‡å› å­ï¼ˆ5D çº¦ 0.58ï¼Œ3D çº¦ 0.69ï¼‰åœ¨æ‰€æœ‰ SNR ä¸‹æ’å®šï¼Œè¡¨æ˜å‚æ•°ç®€å¹¶æ˜¯ç‰©ç†æ€§è´¨ï¼Œä¸å™ªå£°æ— å…³ã€‚
2. 5D ä¸Šé™ï¼ˆåŒ…å«åŒ–å­¦ä¸°åº¦ Î±_Mã€C_Mï¼‰æ¯” 3D ä¸Šé™ä½ 1-28%ï¼Œå·®è·åœ¨ä½ SNR æ—¶å¢å¤§ã€‚
3. åœ¨ mag=22.0ï¼Œ5D ä¸Šé™ï¼ˆ0.698ï¼‰ä¸ ViT æ€§èƒ½ï¼ˆ0.68ï¼‰å‡ ä¹åŒ¹é…ï¼Œè¯æ˜æ¨¡å‹é€¼è¿‘ç‰©ç†æé™ã€‚

---

## 6. å®éªŒ

### 6.1 åŸºçº¿æ–¹æ³•

| æ¨¡å‹ | ç±»å‹ | é…ç½® |
|------|------|------|
| LightGBM | æ ‘æ¨¡å‹ | åŸå§‹ 4096 ç»´è¾“å…¥ |
| Ridge | çº¿æ€§ | Î±=1e5 |
| æ¨¡æ¿æ‹Ÿåˆ | ç‰©ç† | Ï‡Â² æœ€å°åŒ– |

### 6.2 ä¸»è¦ç»“æœ

#### 6.2.1 ViT 100 ä¸‡æ€§èƒ½ï¼ˆæµ‹è¯•é›†ï¼‰

| æŒ‡æ ‡ | å€¼ | æ¡ä»¶ |
|------|-----|------|
| **RÂ²ï¼ˆæµ‹è¯•ï¼Œ10kï¼‰** | **0.711** | æœ€ä½³æ£€æŸ¥ç‚¹ (epoch 128) |
| MAEï¼ˆåŸå§‹ç©ºé—´ï¼‰| 0.372 dex | log(g) å•ä½ |
| æ¶æ„ | p16_h256_L6_a8 | Sweep ä¼˜åŒ– |
| å‚æ•°é‡ | ~4.9M | - |

#### 6.2.2 ä¸åŸºçº¿å¯¹æ¯”ï¼ˆç›¸åŒè®­ç»ƒ/æµ‹è¯•åˆ’åˆ†ï¼‰

| æ¨¡å‹ | æ•°æ®è§„æ¨¡ | RÂ²ï¼ˆæµ‹è¯•ï¼‰| Î” vs ViT | ä¸ä¸Šé™å·®è· |
|------|---------|----------|----------|-----------|
| **SpecViT** | 1M | **0.711** | - | **0.163** |
| LightGBM | 1M | 0.614 | -0.097 (-14%) | 0.260 |
| æ¨¡æ¿æ‹Ÿåˆ | - | 0.404 | -0.307 (-43%) | 0.470 |
| Ridge | 1M | 0.50 | -0.211 (-30%) | 0.374 |
| **Fisher 5D ä¸Šé™** | - | **0.874** | - | **0** |

**å…³é”®å‘ç°ï¼š** ViT åœ¨ç›¸åŒæµ‹è¯•é›†ä¸Šæ¯” LightGBM é«˜ **+16%**ï¼Œæ¯”æ¨¡æ¿æ‹Ÿåˆé«˜ **+76%**ã€‚

### 6.3 åˆ†ä¿¡å™ªæ¯”æ€§èƒ½å¯¹æ¯”

| æ˜Ÿç­‰ | SNR | ViT RÂ² | LightGBM RÂ² | ä¸Šé™ RÂ² | ViT å·®è· |
|------|-----|--------|-------------|---------|---------|
| 18.0 | 87 | ~0.99 | ~0.84 | 0.999 | ~0.01 |
| 20.0 | 24 | 0.90 | 0.87 | 0.989 | 0.09 |
| 21.5 | 7.1 | 0.80 | 0.74 | 0.874 | 0.07 |
| 22.0 | 4.6 | 0.68 | 0.60 | 0.698 | **0.02** |
| 22.5 | 3.0 | 0.52 | 0.42 | 0.265 | ViT>ä¸Šé™* |
| 23.0 | 1.9 | ~0.46 | ~0.36 | 0.000 | N/A |

*æ³¨ï¼šåœ¨ mag=22.5ï¼ŒViTï¼ˆ0.52ï¼‰> 5D ä¸­ä½æ•°ä¸Šé™ï¼ˆ0.265ï¼‰ï¼Œå› ä¸ºä¸Šé™æŒ‰ä¸­ä½æ•°è®¡ç®—ï¼›é«˜åˆ†ä½åŒºåŸŸä»åŒ…å«å¯æå–ä¿¡æ¯ã€‚

**å…³é”®è§‚å¯Ÿï¼š**
1. ViT åœ¨æ‰€æœ‰ SNR åŒºé—´æŒç»­ä¼˜äº LightGBM
2. åœ¨ mag=22.0ï¼ˆSNRâ‰ˆ5ï¼‰ï¼ŒViT å‡ ä¹è§¦åŠ 5D ç†è®ºä¸Šé™ï¼ˆå·®è·=0.02ï¼‰
3. åœ¨ä½ SNRï¼ˆmag>22.5ï¼‰ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½æ¥è¿‘ä¿¡æ¯æ‚¬å´–

### 6.4 è§„æ¨¡åŒ–æ›²çº¿

æ€§èƒ½ vs æ•°æ®é›†è§„æ¨¡ï¼š

| N | ViT RÂ² | LightGBM RÂ² | Ridge RÂ² | ViT vs LightGBM |
|---|--------|-------------|----------|-----------------|
| 50k | 0.434 | 0.488 | 0.442 | ViT < LightGBM |
| **100k** | **0.596** | 0.553 | 0.475 | **é¦–æ¬¡è¶…è¶Š** âœ“ |
| 200k | 0.673 | 0.547 | 0.474 | +23% |
| 500k | 0.709 | 0.574 | 0.490 | +24% |
| **1M** | **0.711** | **0.614** | 0.50 | **+16%** |

**å…³é”®å‘ç°ï¼š**
1. **100k æ‹ç‚¹**ï¼šViT åœ¨ 100k æ•°æ®è§„æ¨¡é¦–æ¬¡è¶…è¶Š LightGBM
2. **Scaling æ–œç‡**ï¼šViT (50kâ†’1M: +0.277) æ˜¯ LightGBM (+0.126) çš„ **2.2Ã—**
3. **âš ï¸ æ¶æ„é¥±å’Œ**ï¼š500kâ†’1M ä»… +0.002ï¼Œå½“å‰æ¶æ„ (p16_h256_L6) å®¹é‡å·²æ»¡

### 6.5 æ¶æ„ Sweep ç»“æœ

ä» 21 ä¸ª sweep runs ä¸­ï¼Œæˆ‘ä»¬ç¡®å®šäº†æœ€ä¼˜é…ç½®ï¼š

| é…ç½® | val_RÂ² | å‚æ•°é‡ | åˆ†æ |
|------|--------|--------|------|
| **p16_h256_L6_a8** | **0.662** | 4.9M | **ç»¼åˆæœ€ä¼˜** |
| p8_h128_L8_a4 | 0.612 | 1.67M | å° patch + æ·±ç½‘ç»œ |
| p32_h256_L4_a4 | 0.602 | 3.37M | å¤§ patch + é‡å  |
| p16_h384_L6_a8 | 0.589 | 10.9M | è¿‡å‚æ•°åŒ– |

**å…³é”®å‘ç°ï¼š**
- **patch_size=16** æœ€ä¼˜ï¼ˆvs 8/32/64ï¼‰
- **hidden_size=256 > 384**ï¼šæ›´å¤§ä¸ä¸€å®šæ›´å¥½
- **6 å±‚**æ˜¯æœ€ä½³å¹³è¡¡ç‚¹ï¼ˆ4 å±‚å¤ªæµ…ï¼Œ8 å±‚éœ€è¦æ›´å¤š epochsï¼‰
- **lr=0.0003** æ•ˆæœæœ€ä½³

### 6.6 æ¶ˆèå®éªŒ

Tokenization æ¶ˆèï¼ˆåŸºäº Sweep hlshu8vlï¼Œ50k æ•°æ®ï¼‰ï¼š

| é…ç½® | Val RÂ² | è¯´æ˜ |
|------|--------|------|
| **C1D, patch=16** | **0.582 Â± 0.045** | **æœ€ä¼˜é…ç½®** âœ“ |
| C1D, patch=32 | 0.473 Â± 0.128 | -19% |
| C1D, patch=64 | 0.534 | -8% |
| SW, patch=16 | âš ï¸ å¤±è´¥ | éœ€è¿›ä¸€æ­¥è°ƒæŸ¥ |

**å…³é”®å‘ç°ï¼š**
- **patch_size=16** æœ€ä¼˜ï¼Œä¸ 4096 ç»´è¾“å…¥ã€256 tokens çš„é…ç½®åŒ¹é…
- patch è¿‡å¤§ï¼ˆ32/64ï¼‰ä¼šæŸå¤±å…‰è°±ç»†èŠ‚
- SW (Sliding Window) å®ç°éœ€è¦è°ƒè¯•

### 6.7 è¯¯å·®åˆ†æ

**[P2: å¯é€‰]** æ®‹å·®åˆ†æï¼š
- æ®‹å·® vs Teff
- æ®‹å·® vs log(g)
- æ®‹å·® vs [M/H]
- æ®‹å·® vs SNR

---

## 7. è®¨è®º

### 7.1 ä¸ºä»€ä¹ˆè§„æ¨¡åŒ–æœ‰æ•ˆ

Vision Transformer ç¼ºä¹ CNN çš„å¼ºå½’çº³åç½®ï¼ˆå±€éƒ¨æ€§ã€å¹³ç§»ä¸å˜æ€§ï¼‰ã€‚åœ¨å°æ•°æ®é›†ä¸Šï¼Œæ¨¡å‹æ— æ³•å­¦ä¹ é²æ£’çš„å…‰è°±ç‰¹å¾æ˜ å°„ã€‚åœ¨ 100 ä¸‡è§„æ¨¡æ—¶ï¼Œæ¨¡å‹è¿›å…¥"å¯å­¦ä¹ åŒºé—´"ï¼Œå…¨å±€è‡ªæ³¨æ„åŠ›æœ‰æ•ˆæ•è·é•¿ç¨‹å…‰è°±ä¾èµ–å…³ç³»ã€‚

### 7.2 ä¸ºä»€ä¹ˆä¸ CRLB ä»æœ‰å·®è·

SpecViTï¼ˆRÂ² = 0.698ï¼‰ä¸ Fisher 5D ä¸Šé™ï¼ˆRÂ² = 0.874ï¼‰åœ¨ mag=21.5 çš„å·®è·å¯èƒ½æºäºï¼š

1. **Tokenization ä¿¡æ¯æŸå¤±**ï¼šPatch size 16 å¯èƒ½èšåˆäº†ç²¾ç»†å…‰è°±ç‰¹å¾
2. **æ¨¡å‹å®¹é‡**ï¼š6 å±‚ã€256 ç»´å¯èƒ½æœªå®Œå…¨é¥±å’Œ
3. **è®­ç»ƒç­–ç•¥**ï¼šMSE æŸå¤±ã€æ ‡ç­¾å½’ä¸€åŒ–é€‰æ‹©
4. **ä¼°è®¡å™¨åå·®**ï¼šCRLB å‡è®¾æ— åä¼°è®¡å™¨ï¼›ç¥ç»ç½‘ç»œå¯èƒ½æœ‰è½»å¾®åå·®

**ç„¶è€Œï¼Œåœ¨ mag=22.0ï¼ˆSNRâ‰ˆ5ï¼‰ï¼Œå·®è·ç¼©å°è‡³ä»… 0.02**ï¼Œè¡¨æ˜ ViT åœ¨é«˜å™ªå£°æ¡ä»¶ä¸‹é€¼è¿‘ç‰©ç†æé™ã€‚è¿™è¯´æ˜é«˜ SNR æ—¶çš„å‰©ä½™å·®è·ä¸»è¦æ¥è‡ªæ¨¡å‹/tokenization è®¾è®¡ï¼Œè€Œéæ ¹æœ¬æ€§é™åˆ¶ã€‚

### 7.3 å±€é™æ€§

- **åˆæˆåˆ°çœŸå®çš„å·®è·**ï¼šBOSZ å…‰è°±å¯èƒ½æœªæ•è·æ‰€æœ‰çœŸå®ä¸–ç•Œæ•ˆåº”
- **å‚æ•°è¦†ç›–**ï¼šæœ‰é™çš„ Teffã€[M/H] èŒƒå›´
- **å•é‡‘å±ä¸°åº¦åŒº**ï¼šä»… Z=0
- **æ³¢é•¿çª—å£**ï¼š7100â€“8850 Ã…ï¼ˆä»… MR è‡‚ï¼‰

---

## 8. ç»“è®º

1. **ViT è§„æ¨¡åŒ–åˆ° 100 ä¸‡å…‰è°±**ï¼šè¾¾åˆ° RÂ² = 0.711ï¼ˆæµ‹è¯•é›†ï¼‰ï¼Œæ¯” LightGBM é«˜ +16%ï¼Œæ¯”æ¨¡æ¿æ‹Ÿåˆé«˜ +76%ã€‚æ•°æ®è§„æ¨¡æ˜¯ Transformer åœ¨æ’æ˜Ÿå…‰è°±å­¦æˆåŠŸçš„å…³é”®ç“¶é¢ˆã€‚

2. **ViT é€¼è¿‘ç‰©ç†æé™**ï¼šåœ¨ mag=22.0ï¼ˆSNRâ‰ˆ5ï¼‰ï¼Œä¸ 5D Fisher/CRLB ä¸Šé™çš„å·®è·ç¼©å°è‡³ä»… 0.02ï¼Œè¯æ˜ SpecViT åœ¨é«˜å™ªå£°æ¡ä»¶ä¸‹å‡ ä¹æå–äº†æ‰€æœ‰å¯ç”¨å…‰è°±ä¿¡æ¯ã€‚

3. **Fisher/CRLB ä¸Šé™é‡åŒ–æ”¹è¿›ç©ºé—´**ï¼šRÂ²â€“SNR æ›²çº¿æä¾›ç‰©ç†åŸºå‡†ã€‚åœ¨ mag=21.5ï¼ˆSNRâ‰ˆ7ï¼‰ï¼Œå·®è· = 0.18ï¼›å‰©ä½™æ”¹è¿›ç©ºé—´å½’å› äº tokenization å’Œæ¨¡å‹å®¹é‡ï¼Œè€Œéä¸å¯çº¦å™ªå£°ã€‚

4. **æ¶æ„é‡è¦ä½†è§„æ¨¡ä¸é‡è¦**ï¼šSweep åˆ†æè¡¨æ˜ patch_size=16ã€hidden_size=256ã€6 å±‚æœ€ä¼˜ã€‚æ›´å¤§æ¨¡å‹ï¼ˆhidden_size=384ï¼‰è¡¨ç°æ›´å·®ï¼Œè¯´æ˜æ•°æ®-æ¨¡å‹å®¹é‡åŒ¹é…è‡³å…³é‡è¦ã€‚

**æœªæ¥å·¥ä½œï¼š**
- è§„æ¨¡åŒ–æ›²çº¿ï¼ˆ1kâ†’1Mï¼‰ä»¥åˆ»ç”»æ•°æ®éœ€æ±‚
- å¤šä»»åŠ¡å­¦ä¹ ï¼ˆTeffã€log gã€[M/H] è”åˆé¢„æµ‹ï¼‰
- çœŸå®æ•°æ®è¿ç§»ï¼ˆLAMOSTã€APOGEEï¼‰
- ä¸ç¡®å®šæ€§é‡åŒ–
- ç‰©ç†æ„ŸçŸ¥ä½ç½®ç¼–ç ï¼ˆPIPEï¼‰

---

## å›¾è¡¨

### å›¾ 1ï¼šRÂ² vs SNR ä¸ Fisher/CRLB ä¸Šé™ï¼ˆä¸»å›¾ï¼‰
![RÂ² vs SNR](../../logg/scaling/exp/img/r2_vs_snr_ceiling_test_10k_unified_snr.png)

*å›¾æ³¨ï¼šlog(g) é¢„æµ‹ RÂ² ä½œä¸º SNRï¼ˆæ˜Ÿç­‰ï¼‰å‡½æ•°çš„å¯¹æ¯”ã€‚Fisher/CRLB 5D ç†è®ºä¸Šé™ï¼ˆè“è‰²åœ†ç‚¹ï¼‰ä»£è¡¨ä»»ä½•æ— åä¼°è®¡å™¨å¯è¾¾åˆ°çš„æœ€å¤§æ€§èƒ½ã€‚SpecViTï¼ˆé»„è‰²è±å½¢ï¼ŒRÂ²=0.698 æ•´ä½“ï¼‰åœ¨ä¸­é«˜ SNR åŒºé—´é€¼è¿‘ä¸Šé™ï¼Œä¼˜äº LightGBMï¼ˆç»¿è‰²æ–¹å—ï¼ŒRÂ²=0.614ï¼‰å’Œæ¨¡æ¿æ‹Ÿåˆï¼ˆçº¢è‰²ä¸‰è§’ï¼ŒRÂ²=0.404ï¼‰ã€‚åœ¨ mag=22.0ï¼ˆSNRâ‰ˆ5ï¼‰ï¼ŒViT å‡ ä¹è§¦åŠä¸Šé™ï¼Œå·®è·ä»…ä¸º 0.02ã€‚*

### å›¾ 2ï¼šSpecViT æµæ°´çº¿
*[TODO: å±•ç¤º tokenization â†’ encoder â†’ å›å½’å¤´çš„æ¶æ„å›¾]*

### å›¾ 3ï¼šè§„æ¨¡åŒ–æ›²çº¿
*[P1 - æ€§èƒ½ vs æ•°æ®é›†è§„æ¨¡ï¼ˆ1kâ†’1Mï¼‰]*

### å›¾ 4ï¼šTokenization æ¶ˆè
*[P1 - C1D/SWã€patch size æ¶ˆèç»“æœæŸ±çŠ¶å›¾]*

### å›¾ 5ï¼šæ®‹å·®åˆ†æ
*[P2 - (Teff, log g) å’Œ (SNR, log g) ä¸Šçš„æ®‹å·®å›¾]*

---

## è¡¨æ ¼

### è¡¨ 1ï¼šæ•°æ®é›†è§„æ ¼

| å±æ€§ | å€¼ |
|------|-----|
| æ¥æº | BOSZ åˆæˆå…‰è°± |
| æ³¢é•¿ | 7100â€“8850 Ã… |
| ç»´åº¦ | 4096 åƒç´  |
| Teff èŒƒå›´ | 3750â€“6000 K |
| log g èŒƒå›´ | 1â€“5 |
| [M/H] èŒƒå›´ | -0.25â€“0.75 |
| æ˜Ÿç­‰ | 20.5â€“22.5 |
| å™ªå£° | å¼‚æ–¹å·®ï¼Œnoise_level=1.0 |
| è®­ç»ƒ/éªŒè¯/æµ‹è¯• | 1,000,000 / 1,000 / 10,000 |

### è¡¨ 2ï¼šæ¨¡å‹é…ç½®

| å‚æ•° | å€¼ |
|------|-----|
| æ¶æ„ | ViT-L6-H256 |
| Patch Size | 16 |
| Hidden Size | 256 |
| å±‚æ•° | 6 |
| æ³¨æ„åŠ›å¤´ | 8 |
| FFN å¤§å° | 1024 |
| å‚æ•°é‡ | ~4.9M |
| Tokenization | C1D (Conv1D) |
| ä½ç½®ç¼–ç  | å¯å­¦ä¹  |
| æŸå¤± | MSE |
| æ ‡ç­¾å½’ä¸€åŒ– | Standard (z-score) |

### è¡¨ 3ï¼šä¸»è¦ç»“æœ

| æ¨¡å‹ | è®­ç»ƒè§„æ¨¡ | RÂ²ï¼ˆæµ‹è¯•ï¼‰| Î” vs ViT | ä¸ä¸Šé™å·®è· |
|------|---------|----------|----------|-----------|
| **SpecViT** | 1M | **0.711** | - | **0.163** |
| LightGBM | 1M | 0.614 | -14% | 0.260 |
| æ¨¡æ¿æ‹Ÿåˆ | - | 0.404 | -43% | 0.470 |
| Ridge | 1M | 0.50 | -30% | 0.374 |
| **Fisher 5D ä¸Šé™** | - | **0.874** | - | **0** |

### è¡¨ 4ï¼šåˆ† SNR æ€§èƒ½

| æ˜Ÿç­‰ | SNR | ViT RÂ² | LightGBM RÂ² | ä¸Šé™ RÂ² | å·®è· |
|------|-----|--------|-------------|---------|------|
| 20.0 | 24 | 0.90 | 0.87 | 0.989 | 0.09 |
| 21.5 | 7.1 | 0.80 | 0.74 | 0.874 | 0.07 |
| 22.0 | 4.6 | 0.68 | 0.60 | 0.698 | **0.02** |
| 22.5 | 3.0 | 0.52 | 0.42 | 0.265 | - |

---

## é™„å½• Aï¼šRÂ² å°ºåº¦ä¸å˜æ€§è¯æ˜

å¯¹äºä»»æ„çº¿æ€§å˜æ¢ $y' = ay + b$ï¼š

$$R^2 = 1 - \frac{SS_{res}}{SS_{tot}} = 1 - \frac{\sum(y - \hat{y})^2}{\sum(y - \bar{y})^2}$$

åœ¨å˜æ¢ç©ºé—´ä¸­ï¼š
- $SS_{res}' = \sum((y' - \hat{y}'))^2 = a^2 \sum(y - \hat{y})^2 = a^2 \cdot SS_{res}$
- $SS_{tot}' = \sum(y' - \bar{y}')^2 = a^2 \sum(y - \bar{y})^2 = a^2 \cdot SS_{tot}$

å› æ­¤ï¼š$R^2_{orig} = R^2_{norm}$

**å«ä¹‰ï¼š** åœ¨å½’ä¸€åŒ–ç©ºé—´ï¼ˆstandard æˆ– minmaxï¼‰è®¡ç®—çš„ RÂ² ä¸åŸå§‹ log(g) ç©ºé—´çš„ RÂ² ç›¸åŒã€‚

---

## é™„å½• Bï¼šå®éªŒæ£€æŸ¥æ¸…å•

### P0: å¿…é¡»å®Œæˆï¼ˆæ ¸å¿ƒè®ºæ–‡ï¼‰

| # | å®éªŒ | çŠ¶æ€ | äº§å‡º |
|---|------|------|------|
| P0.1 | 100 ä¸‡è¿è¡Œ + æµ‹è¯•æŒ‡æ ‡ | âœ… | è¡¨ 3ï¼ˆRÂ²=0.711ï¼‰|
| P0.2 | LightGBM 100 ä¸‡åŸºçº¿ | âœ… | è¡¨ 3ï¼ˆRÂ²=0.614ï¼‰|
| P0.3 | æ¨¡æ¿æ‹ŸåˆåŸºçº¿ | âœ… | è¡¨ 3ï¼ˆRÂ²=0.404ï¼‰|
| P0.4 | SNR æ‰«æ + 5D ä¸Šé™ | âœ… | å›¾ 1 |
| P0.5 | è§„æ¨¡åŒ–æ›²çº¿ï¼ˆ50kâ†’1Mï¼‰| âœ… | ç¬¬ 6.4 èŠ‚ |
| P0.6 | æ¶æ„ sweep | âœ… | ç¬¬ 6.5 èŠ‚ |
| P0.7 | Tokenization æ¶ˆè | âš ï¸ | C1Dâœ…, SWâŒ |

### P1: åº”è¯¥å®Œæˆï¼ˆå¢å¼ºï¼‰

| # | å®éªŒ | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|---|------|------|--------|
| P1.1 | æŸå¤±/æ ‡ç­¾å½’ä¸€åŒ–ç ”ç©¶ | ğŸ”† è¿è¡Œä¸­ | ä¸­ |
| P1.2 | PE æ¶ˆè | â³ | ä½ |
| P1.3 | å¤šä»»åŠ¡å­¦ä¹  | â³ | ä½ |
| P1.4 | è·¨å™ªå£°æ³›åŒ– | â³ | ä½ |

### P2: å¯é€‰å®Œæˆï¼ˆæœªæ¥å·¥ä½œï¼‰

| # | å®éªŒ | çŠ¶æ€ |
|---|------|------|
| P2.1 | æ³¨æ„åŠ›å¯è§†åŒ– | â³ |
| P2.2 | é¢„è®­ç»ƒ + å¾®è°ƒ | â³ |
| P2.3 | åˆæˆ â†’ çœŸå®è¿ç§» | â³ |
| P2.4 | ä¸ç¡®å®šæ€§é‡åŒ– | â³ |

---

## å‚è€ƒæ–‡çŒ®

*[å¾…æ·»åŠ ]*

---

> **æœ€åæ›´æ–°ï¼š** 2025-12-27 (v2)  
> **å¯¹åº”å®éªŒæ—¥å¿—ï¼š** `logg/vit/`, `logg/scaling/`  
> **æ ¸å¿ƒå›¾è¡¨ï¼š** `logg/scaling/exp/img/r2_vs_snr_ceiling_test_10k_unified_snr.png`
