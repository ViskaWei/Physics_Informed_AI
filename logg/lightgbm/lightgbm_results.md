# 📊 LightGBM 实验结果汇总

> **目的**：统一汇总所有 LightGBM 实验结果，解决各实验报告结论"不一致"的表面冲突

**最后更新**: 2025-12-06  
**Author**: Viska Wei

---

## ⚠️ 结论差异说明

各实验报告的结论看似不同，**根本原因是实验设置不同**：

| 实验 | 数据量 | n_estimators | 噪声范围 | 最优 lr 结论 |
|------|--------|--------------|---------|-------------|
| E01 超参数 | 25.6k | 1000-2000 | **σ=0** | lr=0.05 |
| E02 噪声 Sweep | 32k | **≤100** | σ=0.1~1.0 | lr=0.1 |
| E03 100k Sweep | 100k | **500** | σ=0.1~2.0 | lr=0.05(低噪声) / lr=0.1(高噪声) |

**统一结论**：
- **小模型 (n≤100)**：lr=0.1 最优（快速收敛）
- **大模型 (n=500+) + 低噪声**：lr=0.05 最优（更稳定）
- **大模型 (n=500+) + 高噪声**：lr=0.1 最优（防止欠拟合）

---

## 📋 全部实验结果一览表

### 表 1: 按实验分类的完整结果

| Exp | Noise σ | Data | n_est | leaves | lr | Test R² | MAE | 备注 |
|-----|---------|------|-------|--------|-----|---------|-----|------|
| **E01** | 0.0 | 25.6k | 2000 | 31 | 0.05 | **0.9982** | 0.0099 | 极限最优 |
| E01 | 0.0 | 25.6k | 1000 | 31 | 0.1 | 0.9975 | 0.0101 | 性价比最优 |
| E01 | 0.0 | 25.6k | 1000 | 31 | 0.01 | 0.9894 | 0.0210 | 欠拟合 |
| **E02** | 0.1 | 32k | 100 | 31 | 0.10 | 0.9456 | 0.0469 | ≤100树约束 |
| E02 | 0.2 | 32k | 100 | 63 | 0.10 | 0.8778 | 0.0712 | - |
| E02 | 0.5 | 32k | 100 | 63 | 0.10 | 0.6740 | 0.1192 | - |
| E02 | 1.0 | 32k | 100 | 63 | 0.10 | 0.4505 | 0.1682 | 性能临界点 |
| **E03** | 0.1 | 100k | 500 | 31 | 0.05 | **0.9641** | 0.0392 | 最优配置 |
| E03 | 0.1 | 100k | 500 | 31 | 0.10 | 0.9619 | 0.0383 | 次优 |
| E03 | 0.2 | 100k | 500 | 31 | 0.05 | **0.9129** | 0.0625 | - |
| E03 | 0.5 | 100k | 500 | 31 | 0.10 | **0.7370** | 0.1106 | - |
| E03 | 1.0 | 100k | 500 | 31 | 0.10 | **0.5310** | 0.1553 | - |
| E03 | 2.0 | 100k | 500 | 31 | 0.05 | **0.3038** | 0.2013 | 信号几乎不存在 |

---

### 表 2: 噪声水平 × 模型规模 交叉对比

| Noise σ | 32k n≤100 (E02) | 100k n=500 (E03) | Δ R² | 增益 |
|---------|-----------------|------------------|------|------|
| 0.1 | 0.9456 | 0.9641 | +0.0185 | **+2.0%** |
| 0.2 | 0.8778 | 0.9129 | +0.0351 | **+4.0%** |
| 0.5 | 0.6740 | 0.7370 | +0.0630 | **+9.3%** |
| 1.0 | 0.4505 | 0.5310 | +0.0805 | **+17.9%** |
| 2.0 | ~0.20 | 0.3038 | +0.1038 | **+52%** |

> **关键发现**：更多数据 + 更多树在高噪声下收益更大

---

### 表 3: 最优 lr 随配置变化

| 配置条件 | 最优 lr | 原因 |
|----------|---------|------|
| 无噪声 + 大模型 (n=1000+) | **0.05** | 足够迭代，更稳定 |
| 有噪声 + 小模型 (n≤100) | **0.1** | 树数少，需快速拟合 |
| 有噪声 + 大模型 + 低噪声 (σ≤0.2) | **0.05** | 大模型 + 保守 lr 更稳定 |
| 有噪声 + 大模型 + 高噪声 (σ≥0.5) | **0.1** | 噪声大，需快速抓 signal |
| 所有配置 | **避免 0.3** | 过早过拟合 |

---

### 表 4: LightGBM vs Ridge 对比

| Noise σ | LightGBM R² | Ridge best R² | Ridge α | 优势方 | Δ R² |
|---------|-------------|---------------|---------|--------|------|
| 0.0 | **0.9982** | 0.9694 | - | LightGBM | +3.0% |
| 0.1 | **0.9456** | 0.9090 | 1.0 | LightGBM | +4.0% |
| 0.2 | **0.8775** | 0.8264 | 10.0 | LightGBM | +6.2% |
| 0.5 | **0.6697** | 0.6550 | 50.0 | LightGBM | +2.2% |
| 1.0 | 0.4407 | **0.458** | 200.0 | Ridge | -3.9% |

> **关键发现**：noise ≥ 1.0 时 Ridge L2 正则化更鲁棒

---

## 🔢 关键数字速查

### 最佳 R² 参照系

| 场景 | R² | 配置 |
|------|-----|------|
| 理论极限 (noise=0) | **0.9982** | E01: n=2000, leaves=31, lr=0.05 |
| 轻微噪声 (σ=0.1) | **0.9641** | E03: 100k, n=500, lr=0.05 |
| 中等噪声 (σ=0.5) | **0.7370** | E03: 100k, n=500, lr=0.10 |
| 高噪声 (σ=1.0) | **0.5310** | E03: 100k, n=500, lr=0.10 |

### 超参数重要性排序

| 排名 | 超参数 | 与 R² 相关系数 | 影响程度 |
|:----:|--------|:---------------:|:--------:|
| 1 | **learning_rate** | **+0.491** | 最关键 |
| 2 | num_leaves | +0.141 | 中等 |
| 3 | max_depth | +0.124 | 中等 |
| 4 | n_estimators | +0.080 | 较低 |

### 推荐默认配置

```python
# ⭐ 通用推荐配置
LIGHTGBM_DEFAULT = {
    'n_estimators': 1000,
    'num_leaves': 31,
    'max_depth': 7,
    'learning_rate': 0.05,  # 无噪声或低噪声
    # 'learning_rate': 0.1,  # 高噪声 (σ≥0.5) 时切换
    'boosting_type': 'gbdt',
    'objective': 'regression',
    'metric': 'mae',
    'feature_fraction': 0.8,
    'bagging_fraction': 0.8,
    'bagging_freq': 5,
    'early_stopping_rounds': 50,
    'verbose': -1,
    'n_jobs': -1,
    'random_state': 42
}
```

---

## 📐 设计原则总结

### ✅ 已验证的原则

| 原则 | 证据 | 实验来源 |
|------|------|---------|
| lr 是最敏感超参数 | 相关系数 +0.491 | E01 |
| num_leaves=31-128 最优 | >256 过拟合 | E01 |
| 大数据量在高噪声下收益更大 | Δ R² 随 noise 递增 | E03 |
| 大模型需要更保守 lr | 100k+n=500 时 lr=0.05 更优 | E03 |

### ⚠️ 常见陷阱

| 陷阱 | 正确做法 |
|------|---------|
| "lr 越小越稳定" | ❌ lr=0.01 导致欠拟合 |
| "越多树越好" | ❌ 1000→2000 仅 +0.11%，时间翻倍 |
| "LightGBM 万能" | ❌ noise≥1.0 时用 Ridge |
| "所有场景用相同 lr" | ❌ 根据模型规模和噪声调整 |

---

## 📑 实验来源索引

| ID | 文件 | 主题 |
|----|------|------|
| E01 | `exp_lightgbm_hyperparam_sweep_20251129.md` | 超参数网格搜索 (无噪声) |
| E02 | `exp_lightgbm_noise_sweep_lr_20251204.md` | 噪声 Sweep (小模型) |
| E03 | `exp_lightgbm_100k_noise_sweep_20251205.md` | 100k 数据 + 大模型 |
| Summary | `exp_lightgbm_summary_20251205.md` | 综合总结 |

---

*汇总生成时间: 2025-12-06*

