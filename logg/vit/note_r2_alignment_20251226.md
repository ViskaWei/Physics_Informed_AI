# RÂ² è®¡ç®—å¯¹é½åˆ†æ

> **æ—¥æœŸ**: 2025-12-26
> **å®éªŒ**: VIT-20251226-1M-scaling
> **å…³é”®å‘ç°**: RÂ² å¯¹äºçº¿æ€§å½’ä¸€åŒ–ï¼ˆstandard/minmaxï¼‰æ˜¯å°ºåº¦ä¸å˜çš„

---

## ğŸ“Š é—®é¢˜èƒŒæ™¯

åœ¨å¯¹æ¯” ViT ä¸ LightGBM/Ridge ç­‰ä¼ ç»Ÿæ–¹æ³•æ—¶ï¼Œå‘ç°éœ€è¦ç¡®è®¤ RÂ² çš„è®¡ç®—æ–¹å¼æ˜¯å¦ä¸€è‡´ï¼š
- ViT ä½¿ç”¨ `label_norm = 'standard'` æˆ– `'minmax'` å¯¹ log_g è¿›è¡Œå½’ä¸€åŒ–
- LightGBM/Ridge ç›´æ¥åœ¨åŸå§‹ log_g ç©ºé—´è®­ç»ƒå’Œè¯„ä¼°

**é—®é¢˜**: RÂ² æ˜¯åœ¨å½’ä¸€åŒ–ç©ºé—´è¿˜æ˜¯åŸå§‹ç©ºé—´è®¡ç®—ï¼Ÿä¸¤è€…æ˜¯å¦ä¸€è‡´ï¼Ÿ

---

## ğŸ”¬ éªŒè¯å®éªŒ

ä½¿ç”¨ checkpoint `epoch=112-val_mae=0.3766-val_r2=0.7131.ckpt` éªŒè¯ã€‚

### æ•°æ®é…ç½®
```yaml
label_norm: standard
label_stats:
  mean: 2.9975
  std: 1.1683
  min: 1.0000
  max: 5.0000
```

### éªŒè¯ç»“æœ

| ç©ºé—´ | RÂ² | MAE |
|------|-----|-----|
| å½’ä¸€åŒ–ç©ºé—´ | **0.713160** | 0.376579 |
| åŸå§‹ç©ºé—´ (log_g) | **0.713160** | 0.439940 |

---

## ğŸ“ æ•°å­¦è¯æ˜

### RÂ² å¯¹çº¿æ€§å˜æ¢çš„ä¸å˜æ€§

å¯¹äº standard å½’ä¸€åŒ– $y' = \frac{y - \mu}{\sigma}$ï¼Œåå½’ä¸€åŒ– $y = y' \cdot \sigma + \mu$

**RÂ² å…¬å¼**:
$$R^2 = 1 - \frac{SS_{res}}{SS_{tot}} = 1 - \frac{\sum(y - \hat{y})^2}{\sum(y - \bar{y})^2}$$

**åŸå§‹ç©ºé—´**:
- $SS_{res} = \sum(y - \hat{y})^2 = \sum((y'\sigma + \mu) - (\hat{y}'\sigma + \mu))^2 = \sigma^2 \sum(y' - \hat{y}')^2$
- $SS_{tot} = \sum(y - \bar{y})^2 = \sigma^2 \sum(y' - \bar{y}')^2$

**å› æ­¤**:
$$R^2_{orig} = 1 - \frac{\sigma^2 \cdot SS_{res,norm}}{\sigma^2 \cdot SS_{tot,norm}} = 1 - \frac{SS_{res,norm}}{SS_{tot,norm}} = R^2_{norm}$$

**ç»“è®º**: RÂ² å¯¹äºä»»ä½•çº¿æ€§å˜æ¢ $y' = ay + b$ éƒ½æ˜¯ä¸å˜çš„ã€‚

---

## âš ï¸ MAE éœ€è¦è½¬æ¢

MAE **ä¸æ˜¯**å°ºåº¦ä¸å˜çš„ï¼š

$$MAE_{orig} = MAE_{norm} \times \sigma$$

éªŒè¯: $0.3766 \times 1.1683 = 0.4399$ âœ“

### å¯¹æ¯”æŠ¥å‘Šæ—¶éœ€æ³¨æ„

| æŒ‡æ ‡ | ViT æŠ¥å‘Šå€¼ | åŸå§‹ç©ºé—´å€¼ | è½¬æ¢å…¬å¼ |
|------|-----------|-----------|---------|
| RÂ² | 0.7132 | 0.7132 | æ— éœ€è½¬æ¢ |
| MAE | 0.3766 | **0.4399** | Ã— std |

---

## ğŸ“ˆ ä¸å…¶ä»–æ–¹æ³•å¯¹æ¯”

| æ¨¡å‹ | æ•°æ®é‡ | RÂ² | MAE (åŸå§‹ç©ºé—´) |
|------|-------|-----|---------------|
| **ViT (1M, ep112)** | 1M | **0.7132** | **0.4399** |
| LightGBM | 1M | ~0.99 | ~0.05 |
| Ridge | 1M | ~0.85 | ~0.30 |

**æ³¨**: ViT å®éªŒä»åœ¨è¿›è¡Œä¸­ (ep200)ï¼ŒRÂ² æŒç»­æå‡ä¸­ã€‚

---

## âœ… ç»“è®º

1. **RÂ² è®¡ç®—å·²å¯¹é½**: æ— è®ºä½¿ç”¨ standard è¿˜æ˜¯ minmax å½’ä¸€åŒ–ï¼ŒRÂ² åœ¨åŸå§‹ç©ºé—´å’Œå½’ä¸€åŒ–ç©ºé—´æ˜¯ä¸€è‡´çš„
2. **MAE éœ€è¦è½¬æ¢**: å¯¹æ¯”æ—¶éœ€å°† ViT çš„ MAE Ã— std å¾—åˆ°åŸå§‹ç©ºé—´çš„ MAE
3. **ä»£ç å·²æ›´æ–°**: `scripts/train_vit_1m.py` ç°åœ¨åŒæ—¶è®°å½•:
   - `val_r2`: åŸå§‹ç©ºé—´ RÂ²
   - `val_r2_normed`: å½’ä¸€åŒ–ç©ºé—´ RÂ² (å‚è€ƒ)
   - MAE ä»åœ¨å½’ä¸€åŒ–ç©ºé—´ï¼Œå¯¹æ¯”æ—¶éœ€æ‰‹åŠ¨è½¬æ¢

---

## ğŸ“ ä»£ç æ›´æ–°

```python
# æ·»åŠ åå½’ä¸€åŒ–æ–¹æ³•
def denormalize(self, x):
    if self.label_norm == "minmax":
        return x * (self.label_max - self.label_min) + self.label_min
    else:  # standard
        return x * self.label_std + self.label_mean

# éªŒè¯æ—¶åœ¨åŸå§‹ç©ºé—´è®¡ç®— RÂ²
preds_orig = self.denormalize(preds)
labels_orig = self.denormalize(labels)
self.val_r2(preds_orig, labels_orig)
```

---

**ä½œè€…**: Claude (AI Assistant)  
**éªŒè¯**: swei20
