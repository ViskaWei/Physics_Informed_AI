# ğŸ“˜ Global Tower Architecture (GTA) å®éªŒä¼åˆ’
> **Name:** TODO | **ID:** `VIT-20251130-global-01`  
> **Topic:** `global` | **MVP:** MVP-0.0 | **Project:** `VIT`  
> **Author:** Viska Wei | **Date:** 2025-11-30 | **Status:** ğŸ”„
```
ğŸ’¡ å®éªŒç›®çš„  
å†³å®šï¼šå½±å“çš„å†³ç­–
```

---


## ğŸ”— Upstream Links
| Type | Link |
|------|------|
| ğŸ§  Hub | `logg/global/global_hub.md` |
| ğŸ—ºï¸ Roadmap | `logg/global/global_roadmap.md` |

---

---

# âš¡ æ ¸å¿ƒç»“è®ºé€Ÿè§ˆï¼ˆå®éªŒå®Œæˆåå¡«å†™ï¼‰

### ä¸€å¥è¯æ€»ç»“

> **TODOï¼šå®éªŒå®Œæˆåå¡«å†™**

### å¯¹å‡è®¾çš„éªŒè¯

| éªŒè¯é—®é¢˜ | ç»“æœ | ç»“è®º |
|---------|------|------|
| Global ç‰¹å¾ä¿¡æ¯ä¸Šç•Œæœ‰å¤šé«˜ï¼Ÿ | TODO | TODO |
| å“ªç±»å…¨å±€ç‰¹å¾æœ€æœ‰æ•ˆï¼Ÿ | TODO | TODO |
| Global Tower æœ€å° capacityï¼Ÿ | TODO | TODO |

### è®¾è®¡å¯ç¤ºï¼ˆ1-2 æ¡ï¼‰

| å¯ç¤º | å…·ä½“å»ºè®® |
|------|---------|
| TODO | TODO |

### å…³é”®æ•°å­—

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| TODO | TODO |

---

# ğŸ“‘ ç›®å½•

- [0. ğŸ“‹ é—®é¢˜é‡è¿°ä¸æ„ä¹‰æ¾„æ¸…](#0--é—®é¢˜é‡è¿°ä¸æ„ä¹‰æ¾„æ¸…)
- [1. ğŸ¯ ç›®æ ‡](#1--ç›®æ ‡)
- [2. ğŸ§ª å®éªŒè®¾è®¡](#2--å®éªŒè®¾è®¡experiment-design)
- [3. ğŸ“Š å®éªŒå›¾è¡¨](#3--å®éªŒå›¾è¡¨)
- [4. ğŸ’¡ å…³é”®æ´è§](#4--å…³é”®æ´è§key-insights)
- [5. ğŸ“ ç»“è®º](#5--ç»“è®ºconclusion)
- [6. ğŸ“ é™„å½•](#6--é™„å½•)

---

# 0. ğŸ“‹ é—®é¢˜é‡è¿°ä¸æ„ä¹‰æ¾„æ¸…

## 0.1 æ ¸å¿ƒç ”ç©¶é—®é¢˜

> **åœ¨åªå–‚ç»™æ¨¡å‹"ä¸­ä½ç»´çš„ã€å…¨å±€æ€§è´¨çš„ç‰¹å¾"ï¼ˆTeffã€[M/H]ã€å…¨è°±ç»Ÿè®¡é‡ã€ç±»ä¼¼é¢œè‰²/EW çš„ summaryã€å°‘é‡ PCA åˆ†é‡ã€noise levelï¼‰æ—¶ï¼Œ$\log g$ æœ€å¤šèƒ½è¢«è§£é‡Šåˆ°ä»€ä¹ˆç¨‹åº¦ï¼Ÿ**

æ®æ­¤æ¨æ–­ï¼š

> **ä¸€ä¸ªä¸“é—¨åƒè¿™äº›ç‰¹å¾çš„ Global Feature Tower åº”è¯¥é•¿ä»€ä¹ˆæ ·ï¼Œå’Œæœ¬ä½“åƒ full spectrum çš„ Local Towerï¼ˆCNN / Transformerï¼‰åº”è¯¥å¦‚ä½•åˆ†å·¥ï¼Ÿ**

### 0.1.1 ç»Ÿè®¡å­¦å±‚é¢

æŠŠ $\log g$ çœ‹æˆéšæœºå˜é‡ $Y$ï¼ŒæŠŠå„ç§"å…¨å±€ / meta / PCA"ç‰¹å¾çœ‹æˆ $F$ã€‚ç”¨æŸä¸ªæ¨¡å‹æ‹Ÿåˆ $Y \approx f(F)$ï¼Œå¾—åˆ° test $R^2$ï¼š

$$
R^2 \approx 1 - \frac{\mathbb{E}[(Y - \mathbb{E}[Y|F])^2]}{\operatorname{Var}(Y)}
$$

**$R^2$ è¶Šé«˜ï¼Œè¯´æ˜ã€Œåªçœ‹ $F$ï¼Œå°±èƒ½æ¶ˆæ‰å¤šå°‘ $\log g$ çš„ä¸ç¡®å®šæ€§ã€ã€‚**

### 0.1.2 æ’æ˜Ÿç‰©ç†å±‚é¢

$\log g$ çš„ä¿¡æ¯ä¸»è¦æ¥è‡ªï¼š
- **å‹åŠ›å±•å®½ã€çº¿ç¿¼å½¢çŠ¶**ï¼ˆBalmer wingsã€å¼ºé‡‘å±çº¿ã€Ca II ç­‰ï¼‰
- **çº¿æ·± / çº¿å®½ç»„åˆ**ï¼Œä¸ Teffã€[M/H] æœ‰å¼ºè€¦åˆ

è¿™äº›æœ¬è´¨ä¸Šæ˜¯"å¾ˆå¤šçº¿çš„é›†ä½“è¡Œä¸º"ï¼Œä¸å¤ªå¯èƒ½è¢«"å‡ ä¸ªé¢œè‰² + Teff"å®Œå…¨åƒæ‰ã€‚

å¦‚æœå‘ç°"å°‘é‡å…¨å±€ç‰¹å¾å°±èƒ½è§£é‡Šå¤§éƒ¨åˆ† $\log g$ æ–¹å·®"ï¼Œè¯´æ˜ä¸¤ç§å¯èƒ½ï¼š
- **(a)** ç‰©ç†ä¸Š $\log g$ å’Œ Teffã€[M/H] åœ¨åˆæˆ grid é‡Œé«˜åº¦ç›¸å…³ï¼ˆä¾‹å¦‚æ²¿æ¼”åŒ–è½¨é“é‡‡æ ·ï¼‰
- **(b)** å…‰è°±ä¸­çœŸæ­£ç”¨äºåŒºåˆ† $\log g$ çš„ä¿¡æ¯ï¼Œå¯ä»¥è¢«éå¸¸ç²—çš„ summary èšåˆæ‰

### 0.1.3 ä¿¡æ¯ä¸Šç•Œçš„æ„ä¹‰

| ä¸Šç•Œé«˜ä½ | å«ä¹‰ | Local Tower è§’è‰² |
|---------|------|-----------------|
| ä¸Šç•Œé«˜ï¼ˆ$R^2 > 0.9$ï¼‰ | Global ç‰¹å¾å·²åƒæ‰å¤§éƒ¨åˆ†ä¿¡æ¯ | æ®‹å·®ä¿®æ­£å™¨ |
| ä¸Šç•Œä½ï¼ˆ$R^2 < 0.7$ï¼‰ | ä¿¡æ¯åˆ†æ•£åœ¨é«˜ç»´å±€éƒ¨ç»“æ„ä¸­ | ä¸»è¦è´¡çŒ®è€… |

## 0.2 ä¸ºä»€ä¹ˆ"PCA éœ€è¦ ~100â€“200 ç»´"è¯´æ˜æ˜¯ä¸­ç­‰ç»´å­ç©ºé—´ï¼Ÿ

å·²çŸ¥å®éªŒç»“è®ºï¼š
- **å…¨è°± Ridge / LightGBM åœ¨ noise=0 æ—¶ $R^2 \approx 1$**
- **PCA+Ridge è¦ç”¨åˆ° ~100â€“200 ä¸ªåˆ†é‡ï¼Œ$R^2$ æ‰èƒ½é€¼è¿‘ 1ï¼›ç”¨ 5â€“10 ä¸ªè¿œè¿œä¸å¤Ÿ**

è¿™è¯´æ˜ï¼š

| ç»“è®º | å«ä¹‰ |
|------|------|
| $\log g$ åœ¨ flux ç©ºé—´ä¸ŠåŸºæœ¬æ˜¯"çº¿æ€§å¯é€¼è¿‘"çš„ | çº¿æ€§æ¨¡å‹ + è¶³å¤Ÿ PCA åˆ†é‡å¯è¾¾ full-spectrum baseline |
| $\log g$ ä¿¡æ¯ä¸é›†ä¸­åœ¨å°‘æ•°ä¸»æ¨¡æ€ | ä¾èµ–è®¸å¤š**ä¸­ç­‰æ–¹å·®/ä½æ–¹å·®**çš„æ¨¡å¼å åŠ  |
| Global Tower capacity æŒ‡å¼• | è¾“å…¥ç»´åº¦è‡³å°‘å‡ åè‡³ä¸Šç™¾ç»´ |

### å¯¹ Global Tower è®¾è®¡çš„ç›´æ¥å¯ç¤º

| ç»„ä»¶ | å»ºè®®ç»´åº¦ |
|------|---------|
| Input | ~100â€“200 ç»´ï¼ˆPCA + ç»Ÿè®¡é‡ + Teff + noiseï¼‰ |
| Output embedding $h_{\text{global}}$ | ~32â€“128 ç»´ |
| Hidden layers | 64â€“256 ç»´ |

## 0.3 ä¸‰é‡ä»·å€¼åˆ†æ

### ä¿¡æ¯è®ºè§’åº¦
- $R^2(K)$ æ›²çº¿ â‰ˆ ä¿¡æ¯é¥±å’Œæ›²çº¿çš„ proxy
- éšç€ç‰¹å¾ç»´åº¦ $K$ å¢åŠ ï¼šæ›²çº¿å‘Šè¯‰æˆ‘ä»¬ **"å†å¤šåŠ  1 ç»´ global ç‰¹å¾ï¼Œèƒ½æå‡å¤šå°‘è§£é‡Šåº¦ï¼Ÿ"**
- å¯è¿‘ä¼¼ mutual information $I(\log g; F_K)$ çš„å¢é•¿è¶‹åŠ¿

### ç‰©ç†ç›´è§‰è§’åº¦
- ä¸åŒçº¿å¯¹ $\log g$ çš„æ•æ„Ÿæ€§ä¸åŒï¼šBalmer wingsã€é‡‘å±çº¿ã€çº¿çš„æ··åˆã€blanketing ç­‰
- æ¯ç»„çº¿è´¡çŒ® 1â€“2 ç»´"å½¢çŠ¶è‡ªç”±åº¦" â†’ å‡ åç»„çº¿ â†’ $\log g$ ç›¸å…³æœ‰æ•ˆç»´åº¦ $O(100)$

### æ¨¡å‹è®¾è®¡è§’åº¦
| åœºæ™¯ | Global Tower è§’è‰² | Local Tower è§’è‰² |
|------|------------------|-----------------|
| å°‘é‡ç‰¹å¾å³è¾¾ $R^2 > 0.95$ | ä¸»é¢„æµ‹å™¨ | æ®‹å·®ä¿®æ­£å™¨ |
| éœ€è¦ 100+ PCA æ‰æ¥è¿‘ 1 | ä¿¡æ¯å‹ç¼©å™¨ | é«˜é˜¶å±€éƒ¨ pattern å»ºæ¨¡ |

## 0.4 å®éªŒå®šä½

> **è¿™æ˜¯"ä¿¡æ¯ä¸Šç•Œ + ç»“æ„æŒ‡å¯¼"åˆ†æï¼Œè€Œéæœ€ç»ˆå¯éƒ¨ç½² pipeline**

**ä»·å€¼**ï¼š
- ç»™å‡º Global ç‰¹å¾åœ¨ N ç»´æ—¶çš„ä¸Šé™
- PCA ç»´åº¦ vs $R^2$ æ›²çº¿ï¼Œç”¨äºé€‰æ‹© global è¡¨è¾¾çš„ target ç»´åº¦
- æŒ‡å¯¼ Global/Local Tower çš„ capacity å’Œåˆ†å·¥

**å±€é™**ï¼š
- åˆæˆè°± + Oracle [M/H] + ç†æƒ³ noise modelï¼Œä¸çœŸå®è§‚æµ‹å­˜åœ¨ domain gap
- ç»“è®ºåº”ç†è§£ä¸ºï¼š**"çœŸå®ä¸–ç•Œèƒ½åšåˆ°çš„æœ€å¥½æƒ…å†µçš„å‚è€ƒ/æŒ‡å—"**

---

# 1. ğŸ¯ ç›®æ ‡

## 1.1 èƒŒæ™¯ä¸åŠ¨æœº

æœ¬å®éªŒç³»åˆ—æ—¨åœ¨ï¼š
- **é‡åŒ– $\log g$ ä¿¡æ¯åœ¨å…¨å±€ç‰¹å¾ç©ºé—´ä¸­çš„åˆ†å¸ƒç»´åº¦**
- **æŒ‡å¯¼ Global Feature Tower çš„æ¶æ„è®¾è®¡**ï¼ˆè¾“å…¥ç»´åº¦ã€éšå±‚ç»´åº¦ã€è¾“å‡º embedding ç»´åº¦ï¼‰
- **ç¡®å®š Global vs Local Tower çš„åˆ†å·¥ç­–ç•¥**ï¼ˆä¸»å¹²+æ®‹å·® vs è¾…åŠ©å…ˆéªŒï¼‰
- **è¯„ä¼°ä¸åŒç‰¹å¾å®¶æ—å¯¹ $\log g$ é¢„æµ‹çš„è´¡çŒ®**

## 1.2 æ ¸å¿ƒå‡è®¾

> **$\log g$ çš„ä¿¡æ¯ä¸»è¦åˆ†å¸ƒåœ¨ä¸€ä¸ª ~100 ç»´çš„ä¸­ç­‰ç»´åº¦çº¿æ€§å­ç©ºé—´ä¸­ï¼Œé€šè¿‡è®¾è®¡åˆç†çš„ Global Feature Towerï¼ˆPCA + EW + ç»Ÿè®¡é‡ï¼‰ï¼Œå¯ä»¥æ•è· $R^2 \geq 0.95$ çš„ä¿¡æ¯é‡ï¼Œå‰©ä½™ç»†èŠ‚ç”± Local Tower è¡¥å……ã€‚**

å¦‚æœå‡è®¾æˆç«‹ï¼Œæ„å‘³ç€ï¼š
- Global Tower å¯ä½œä¸ºä¸»å¹²é¢„æµ‹å™¨ï¼ŒLocal Tower è´Ÿè´£æ®‹å·®ä¿®æ­£
- è¾“å…¥ç»´åº¦ ~150ã€è¾“å‡º embedding ~64 æ˜¯åˆç†çš„è®¾è®¡èµ·ç‚¹
- åœ¨é«˜å™ªå£°åœºæ™¯ä¸‹ï¼ŒGlobal Tower å¯æä¾›æŠ—å™ªçš„ä½ç»´ prior

å¦‚æœå‡è®¾ä¸æˆç«‹ï¼Œåˆ™éœ€è¦ï¼š
- é‡æ–°è¯„ä¼° Global Tower çš„å¿…è¦æ€§
- è€ƒè™‘è®© Local Tower æ‰¿æ‹…æ›´å¤šä¸»å¯¼æƒ
- è®¾è®¡æ›´å¤æ‚çš„ä¿¡æ¯èåˆç­–ç•¥

## 1.3 éªŒè¯é—®é¢˜

| # | é—®é¢˜ | éªŒè¯ç›®æ ‡ | é¢„æœŸç»“æœ | å®é™…ç»“æœ |
|---|------|---------|---------|---------|
| Q1 | Teff-only èƒ½è¾¾åˆ°å¤šå°‘ $R^2$ï¼Ÿ | ç¡®è®¤ grid æ—  Teff-$\log g$ å¼ºç›¸å…³ | $R^2 \in [0, 0.1]$ â†’ æ— ç›¸å…³ âœ“ | âœ… $R^2 \approx 0$ â†’ **Grid ç‹¬ç«‹é‡‡æ ·æ­£ç¡®** |
| Q2 | Teff + [M/H]\_oracle èƒ½è¾¾åˆ°å¤šå°‘ $R^2$ï¼Ÿ | ç¡®è®¤å…ƒæ•°æ®ä¸æºå¸¦ $\log g$ ä¿¡æ¯ | $R^2 \in [0.0, 0.2]$ | âœ… $R^2 \approx 0$ â†’ **å¿…é¡»ç”¨å…‰è°±** |
| Q3 | åŠ å…¥ EW/é¢œè‰²ç‰¹å¾ï¼ˆF3ï¼‰å $R^2$ æå‡å¤šå°‘ï¼Ÿ | è¯„ä¼°å±€éƒ¨çº¿å‹ summary çš„ä»·å€¼ | æ˜¾è‘—è·³å‡è‡³ $[0.3, 0.7]$ | TODO |
| Q4 | PCA $K=100$ æ—¶èƒ½å¦è¾¾åˆ° $R^2 \geq 0.95$ï¼Ÿ | éªŒè¯ä¸­ç­‰ç»´åº¦å‡è®¾ | $R^2 \in [0.95, 0.99]$ | TODO |
| Q5 | F5 åœ¨é«˜ noise ä¸‹æ¯” full-spectrum æ›´é²æ£’å—ï¼Ÿ | è¯„ä¼° Global ç‰¹å¾çš„æŠ—å™ªèƒ½åŠ› | ä¸‹é™å¹…åº¦æ›´å° | TODO |
| Q6 | å»æ‰ oracle [M/H] å $R^2$ ä¸‹é™å¤šå°‘ï¼Ÿ | é‡åŒ– $\log g$-[M/H] è€¦åˆå¼ºåº¦ï¼ˆéœ€åœ¨ F5 åŸºç¡€ä¸Šæµ‹è¯•ï¼‰ | ä¸‹é™ 0.02â€“0.15 | TODO |
| Q7 | MLP Global Tower æ¯” Ridge æœ‰éçº¿æ€§å¢ç›Šå—ï¼Ÿ | å†³å®š Tower å¤æ‚åº¦ | å¾®å°æˆ–æ— å¢ç›Š | âœ… LightGBM ç¬¬1è½®æ—©åœï¼Œæ— å¢ç›Š |

## 1.4 ç»“è®ºæ‘˜è¦ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰

### 1.4.1 å·²éªŒè¯ç»“è®º

| ç»“è®º | è¯´æ˜ | æ¥æº |
|------|------|------|
| **å…ƒæ•°æ®æ— æ³•é¢„æµ‹ $\log g$** | Teff + [M/H] + è§‚æµ‹æ¡ä»¶ï¼š$R^2 \approx 0$ï¼ˆæ— é¢„æµ‹èƒ½åŠ›ï¼‰ | [F0/F1 Baseline](exp_gta_f0f1_metadata_baseline_20251130.md) |
| **Grid é‡‡æ ·è®¾è®¡æ­£ç¡®** | (Teff, [M/H], $\log g$) ä¸‰è€…ç‹¬ç«‹ï¼Œæ— å‡½æ•°å…³ç³»ï¼ˆ$R^2 \approx 0$ è¯´æ˜æ— ç›¸å…³ï¼‰ | åŒä¸Š |
| **éçº¿æ€§æ¨¡å‹æ— å¢ç›Š** | LightGBM ç¬¬1è½®æ—©åœï¼Œè¯´æ˜å…ƒæ•°æ®ä¸ $\log g$ æ—¢æ— çº¿æ€§ä¹Ÿæ— éçº¿æ€§å…³ç³» | åŒä¸Š |

### 1.4.2 è®¾è®¡å¯ç¤ºï¼ˆå·²ç¡®è®¤ï¼‰

| è®¾è®¡åŸåˆ™ | å…·ä½“å»ºè®® |
|---------|---------|
| **å¿…é¡»ä½¿ç”¨å…‰è°± flux** | å…ƒæ•°æ®ä¸èƒ½æ›¿ä»£å…‰è°±ä¿¡æ¯ |
| **F0/F1 å¯è·³è¿‡** | ç›´æ¥ä» F2ï¼ˆå…¨è°±ç»Ÿè®¡ï¼‰æˆ– F3ï¼ˆEWï¼‰å¼€å§‹ |

> **ä¸€å¥è¯æ€»ç»“**ï¼š$\log g$ ä¿¡æ¯å®Œå…¨ç¼–ç åœ¨å…‰è°± flux ä¸­ï¼ŒTeff/[M/H] ç­‰å…ƒæ•°æ®è´¡çŒ®ä¸ºé›¶ï¼ŒéªŒè¯äº† Global Tower å¿…é¡»åŸºäºå…‰è°±ç‰¹å¾ï¼ˆPCA/EW/ç»Ÿè®¡é‡ï¼‰è€Œéçº¯å…ƒæ•°æ®ã€‚

---

# 2. ğŸ§ª å®éªŒè®¾è®¡ï¼ˆExperiment Designï¼‰

## 2.1 æ•°æ®ï¼ˆDataï¼‰

### åŸºç¡€é…ç½®
- **è®­ç»ƒæ ·æœ¬æ•°**ï¼š32,000ï¼ˆæ­£å¼ï¼‰/ 5,000ï¼ˆSanity checkï¼‰
- **æµ‹è¯•æ ·æœ¬æ•°**ï¼š8,000ï¼ˆæ­£å¼ï¼‰/ 1,000ï¼ˆSanity checkï¼‰
- **ç‰¹å¾ç»´åº¦**ï¼š4096ï¼ˆfull spectrumï¼‰
- **æ ‡ç­¾å‚æ•°**ï¼š$\log g$
- **è¾…åŠ©å‚æ•°**ï¼šTeff, [M/H]\_oracle, noise\_level

### å™ªå£°æ¨¡å‹

$$
\text{noisy\_flux} = \text{flux} + \mathcal{N}(0, \sigma^2)
$$

**Noise levels**: $\sigma \in \{0, 0.1, 0.3, 1.0, 2.0\}$

## 2.2 ç‰¹å¾å®¶æ—è®¾è®¡ï¼ˆç”±å¼±åˆ°å¼ºï¼‰

### F0: Teff-only

| ç‰¹å¾ | è¯´æ˜ |
|------|------|
| Teff | æœ‰æ•ˆæ¸©åº¦åŸå§‹å€¼ |
| $\log(\text{Teff})$ | å¯¹æ•°å˜æ¢ |
| $\text{Teff}^2$ | äºŒæ¬¡é¡¹ |

**ç‰©ç†æ„ä¹‰**ï¼šå®Œå…¨ä¸çœ‹å…‰è°±å½¢çŠ¶ï¼Œä»…ç”¨æœ‰æ•ˆæ¸©åº¦

**é¢„æœŸ $R^2$ (noise=0)**ï¼š
- ç‹¬ç«‹ grid: **[0, 0.1]**
- ç‰©ç†æ˜Ÿæ—åˆ†å¸ƒ: **[0.2, 0.4]**

**å¼‚å¸¸é˜ˆå€¼**ï¼š$R^2 > 0.5$ â†’ æ£€æŸ¥ grid æ˜¯å¦å­˜åœ¨ Teff-$\log g$ å‡½æ•°å…³ç³»

---

### F1: Teff + oracle [M/H]

| ç‰¹å¾ | è¯´æ˜ |
|------|------|
| F0 å…¨éƒ¨ | Teff åŠå…¶å˜æ¢ |
| [M/H]\_oracle | çœŸå®é‡‘å±ä¸°åº¦ |
| Teff Ã— [M/H] | äº¤äº’é¡¹ï¼ˆå¯é€‰ï¼‰ |
| $\log(\text{Teff}) \times$ [M/H] | äº¤äº’é¡¹ï¼ˆå¯é€‰ï¼‰ |

**ç‰©ç†æ„ä¹‰**ï¼šè¯„ä¼° (Teff, [M/H]) äºŒè€…å¯¹ $\log g$ çš„çº¦æŸèƒ½åŠ›

**é¢„æœŸ $R^2$ (noise=0)**ï¼š
- ç‹¬ç«‹ grid: **[0.0, 0.2]**
- ç‰©ç†æ˜Ÿæ—åˆ†å¸ƒ: **[0.3, 0.6]**

**å¼‚å¸¸é˜ˆå€¼**ï¼š$R^2 > 0.9$ â†’ grid å­˜åœ¨å¼ºåé—¨ç›¸å…³ / æ•°æ®æ³„æ¼

---

### F2: F1 + å…¨è°±ç»Ÿè®¡é‡ + ç²—é¢œè‰²

| ç‰¹å¾ | è¯´æ˜ |
|------|------|
| F1 å…¨éƒ¨ | Teff + [M/H] |
| mean(flux) | å…¨è°±å¹³å‡æµé‡ |
| std(flux) | å…¨è°±æµé‡æ ‡å‡†å·® |
| Blue\_mean | è“ç«¯çª—å£ $[\lambda_{b1}, \lambda_{b2}]$ å¹³å‡ flux |
| Red\_mean | çº¢ç«¯çª—å£ $[\lambda_{r1}, \lambda_{r2}]$ å¹³å‡ flux |
| Color\_1 | Blue\_mean - Red\_mean |
| noise\_level | å™ªå£°æ°´å¹³ï¼ˆå¦‚æ··åˆè®­ç»ƒï¼‰ |

**ç‰©ç†æ„ä¹‰**ï¼šè¯„ä¼°"photometry-like"å…¨å±€ç»Ÿè®¡é‡çš„è´¡çŒ®

**é¢„æœŸ $R^2$ (noise=0)**ï¼š
- ç‹¬ç«‹ grid: **[0.1, 0.3]**
- ç‰©ç†æ˜Ÿæ—åˆ†å¸ƒ: **[0.4, 0.7]**

**å¼‚å¸¸é˜ˆå€¼**ï¼š
- F2 â‰ˆ F1 â†’ continuum è¢«å½’ä¸€åŒ–æŠ¹å¹³
- F2 > 0.9 â†’ ç²—é¢œè‰²çª—å£é€‰ä¸­äº†å¼ºæ•æ„Ÿçº¿

---

### F3: F2 + Top-K çº¿å‹ç‰¹å¾ï¼ˆEW/é¢œè‰²ï¼‰

#### ç‰¹å¾æ„é€ æ­¥éª¤

1. **é€‰å– Top-K æ³¢é•¿**ï¼šç”¨å…¨è°± + Ridge/LightGBM å¯¹ $\log g$ è®­ç»ƒï¼ŒæŒ‰ |weight| æˆ– importance æ’åºï¼Œé€‰ Top-Kï¼ˆ$K=10$ æˆ– $20$ï¼‰

2. **å®šä¹‰çª—å£**ï¼š
   - Line window: $[\lambda_i - w_l, \lambda_i + w_l]$ï¼ˆè¦†ç›– Â±2â€“3 åƒç´ ï¼‰
   - Blue continuum: $[\lambda_i - w_{c2}, \lambda_i - w_{c1}]$
   - Red continuum: $[\lambda_i + w_{c1}, \lambda_i + w_{c2}]$

3. **æ„é€ çº¿å‹ç‰¹å¾**ï¼š

$$
\text{EW}_i = \sum_{\lambda \in \text{line}} \left(1 - \frac{F_\lambda}{F_{\text{cont},i}}\right) \Delta\lambda
$$

$$
D_i = 1 - \frac{\min_{\lambda \in \text{line}} F_\lambda}{F_{\text{cont},i}}
$$

$$
C_i = F_{\text{line mean}} - F_{\text{cont mean}}
$$

| ç‰¹å¾ | è¯´æ˜ |
|------|------|
| F2 å…¨éƒ¨ | ä¹‹å‰æ‰€æœ‰ç‰¹å¾ |
| EW\_1, ..., EW\_K | K æ¡çº¿çš„ç­‰å€¼å®½åº¦ |
| D\_1, ..., D\_K | K æ¡çº¿çš„çº¿æ·± |
| C\_1, ..., C\_K | K æ¡çº¿çš„å±€éƒ¨é¢œè‰² |

**æ€»ç‰¹å¾æ•°**ï¼šF2 ç»´åº¦ + K Ã— 2â€“3 â‰ˆ 30â€“60 ç»´

**ç‰©ç†æ„ä¹‰**ï¼šéªŒè¯ Top-K å±€éƒ¨çº¿å‹ summary èƒ½å¦æ˜¾è‘—æå‡ $R^2$

**é¢„æœŸ $R^2$ (noise=0)**ï¼š
- ç‹¬ç«‹ grid: **[0.3, 0.7]**
- ç‰©ç†æ˜Ÿæ—åˆ†å¸ƒ: **[0.6, 0.85]**

**å¼‚å¸¸é˜ˆå€¼**ï¼š
- F3 â‰ˆ F2 â†’ Top-K é€‰å–ä¸ç¨³æˆ– EW è®¡ç®—æœ‰ bug
- F3 â‰¥ 0.9 â†’ $\log g$ ä¿¡æ¯æåº¦é›†ä¸­åœ¨æœ‰é™å‡ ç»„çº¿

---

### F4: F3 + PCA($K_{\text{small}}$)

| ç‰¹å¾ | è¯´æ˜ |
|------|------|
| F3 å…¨éƒ¨ | ä¹‹å‰æ‰€æœ‰ç‰¹å¾ |
| PC\_1, ..., PC\_10 | å‰ 10 ä¸ª PCA åˆ†é‡ |
| æˆ– PC\_1, ..., PC\_20 | å‰ 20 ä¸ª PCA åˆ†é‡ |

**ç‰©ç†æ„ä¹‰**ï¼šåœ¨æ‰‹å·¥ EW/é¢œè‰²ä¹‹å¤–å¼•å…¥å°‘é‡å…¨å±€ shape æ¨¡å¼

**é¢„æœŸ $R^2$ (noise=0)**ï¼š
- ç‹¬ç«‹ grid: **[0.5, 0.8]**
- ç‰©ç†æ˜Ÿæ—åˆ†å¸ƒ: **[0.7, 0.9]**

**å¼‚å¸¸é˜ˆå€¼**ï¼š
- F4 â‰ˆ F3 â†’ å‰ 10â€“20 PCA mode ä¸ $\log g$ ç›¸å…³æ€§æœ‰é™ï¼ˆé‡è¦ç»“è®ºï¼‰
- F4 > 0.95 â†’ ä¸"éœ€è¦ 100â€“200 ç»´"ç»“è®ºå†²çªï¼Œéœ€å¯¹é½ pipeline

---

### F5: F3 + PCA($K_{\text{mid}}$)

| ç‰¹å¾ | è¯´æ˜ |
|------|------|
| F3 å…¨éƒ¨ | ä¹‹å‰æ‰€æœ‰ç‰¹å¾ |
| PC\_1, ..., PC\_K | $K \in \{50, 100, 200\}$ |

**é¢„æœŸ $R^2$ (noise=0)**ï¼š

| K | é¢„æœŸ $R^2$ |
|---|-----------|
| 50 | [0.85, 0.95] |
| 100 | [0.95, 0.99] |
| 200 | â‰ˆ full-spectrum Ridge |

**å¼‚å¸¸é˜ˆå€¼**ï¼š
- K é€’å¢æ—¶ $R^2$ éå•è°ƒ â†’ æ­£åˆ™åŒ–è¶…å‚æ•°æœªé’ˆå¯¹ä¸åŒ K é‡æ–°è°ƒä¼˜
- F5 æ˜æ˜¾åç¦»ä¹‹å‰ PCA å®éªŒç»“è®º â†’ å¯¹é½å®éªŒè®¾å®š

---

### F6: ç°å®ç‰ˆï¼ˆæ—  oracle [M/H]ï¼‰

| ç‰¹å¾ | è¯´æ˜ |
|------|------|
| F4/F5 çš„ä¿®æ”¹ç‰ˆ | å»æ‰ [M/H]\_oracle |
| å¯é€‰ï¼š[M/H]\_est | è§‚æµ‹æ¨æ–­çš„ [M/H]ï¼ˆå¸¦å™ªå£°ï¼‰ |
| å¯é€‰ï¼š$\sigma_{\text{[M/H]}}$ | [M/H] ä¼°è®¡çš„ä¸ç¡®å®šåº¦ |

**ç‰©ç†æ„ä¹‰**ï¼šæ›´æ¥è¿‘çœŸå®è§‚æµ‹åœºæ™¯

**é¢„æœŸ $R^2$ (noise=0)**ï¼š
- æ—  [M/H] ä¿¡æ¯ï¼šæ¯” F5 é™ä½ä¸€æ¡£ï¼Œ**[0.8, 0.95]**
- æœ‰ reasonable [M/H]\_estï¼šç•¥ä½äº F5ï¼Œ**[0.9, 0.98]**

**å¼‚å¸¸é˜ˆå€¼**ï¼š
- F6 â‰ˆ F5 â†’ [M/H] ä¸ç¡®å®šæ€§å¯¹ $\log g$ å½±å“ä¸å¤§
- F6 << F5ï¼ˆå·® > 0.2ï¼‰â†’ $\log g$ ä¸ [M/H] é«˜åº¦è€¦åˆï¼Œéœ€ joint modeling

---

## 2.3 ç‰¹å¾å®¶æ—æ€»è§ˆ

| å®¶æ— | åŒ…å«ç‰¹å¾ | ä¼°è®¡ç»´åº¦ | é¢„æœŸ $R^2$ (ç‹¬ç«‹grid) |
|------|---------|---------|----------------------|
| F0 | Teff å¤šé¡¹å¼ | 3 | [0, 0.1] |
| F1 | F0 + [M/H]\_oracle | 5â€“7 | [0.0, 0.2] |
| F2 | F1 + mean/std/é¢œè‰² | 10â€“15 | [0.1, 0.3] |
| F3 | F2 + Top-K EW/depth | 30â€“60 | [0.3, 0.7] |
| F4 | F3 + PCA(10â€“20) | 40â€“80 | [0.5, 0.8] |
| F5 | F3 + PCA(50â€“200) | 80â€“260 | [0.85, 0.99] |
| F6 | F5 æ—  oracle [M/H] | 80â€“260 | [0.8, 0.95] |

## 2.4 æ¨¡å‹ä¸ç®—æ³•

### Ridge å›å½’ï¼ˆä¸»åŠ›ï¼‰

$$
\hat{y} = X w + b
$$

$$
w = (X^\top X + \alpha I)^{-1} X^\top y
$$

**è¶…å‚æ•°**ï¼š$\alpha \in \{10^{-4}, 10^{-3}, 10^{-2}, 10^{-1}, 1, 10, 100\}$

### MLPï¼ˆéçº¿æ€§æ£€éªŒï¼‰

**ç»“æ„**ï¼š
- Input: $d_{\text{in}}$ ç»´ç‰¹å¾
- Layer1: Linear($d_{\text{in}}$ â†’ 128) + ReLU
- Layer2: Linear(128 â†’ 64) + ReLU  
- Output: Linear(64 â†’ 1)

**è¶…å‚æ•°**ï¼š
- Learning rate: $10^{-3}$
- Weight decay: $10^{-4}$
- Epochs: 100â€“200
- Batch size: 256

### PCA

- åœ¨**è®­ç»ƒé›†**ä¸Š fitï¼Œtransform æµ‹è¯•é›†ï¼ˆé¿å… data leakageï¼‰
- whitened=Falseï¼ˆä¿ç•™æ–¹å·®ä¿¡æ¯ï¼‰
- å¯¹ PCA åˆ†é‡åš standard scaling

## 2.5 è¶…å‚æ•°é…ç½®

| å‚æ•° | èŒƒå›´/å€¼ |
|------|--------|
| $\alpha$ (Ridge) | $\{10^{-4}, ..., 10^2\}$ log-grid |
| PCA ç»´åº¦ | $\{5, 10, 20, 50, 100, 200\}$ |
| noise levels | $\{0, 0.1, 0.3, 1.0, 2.0\}$ |
| Top-K çº¿æ•° | $\{10, 20\}$ |
| EW çª—å£å®½åº¦ $w_l$ | 2â€“3 åƒç´  |
| Continuum çª—å£ | 5â€“10 åƒç´  |

## 2.6 è¯„ä»·æŒ‡æ ‡

| æŒ‡æ ‡ | å…¬å¼ | ç”¨é€” |
|------|------|------|
| $R^2$ | $1 - \frac{\sum(y - \hat{y})^2}{\sum(y - \bar{y})^2}$ | ä¸»è¦è¯„ä»·æŒ‡æ ‡ |
| MAE | $\frac{1}{n}\sum|y - \hat{y}|$ | ç»å¯¹è¯¯å·®å‚è€ƒ |
| RMSE | $\sqrt{\frac{1}{n}\sum(y - \hat{y})^2}$ | ä¸ $R^2$ é…åˆ |

---

# 2.7 MVP å®éªŒè·¯çº¿å›¾

## Phase 0: Sanity Check

### MVP-0.0: Full-spectrum Baseline å¤ç°

| é¡¹ç›® | é…ç½® |
|------|------|
| **ç›®æ ‡** | ç¡®è®¤æ–°å®éªŒè„šæœ¬ä¸‹ full-spectrum baseline æ­£å¸¸ |
| **æ•°æ®** | noise=0, 5k/1k |
| **æ¨¡å‹** | Ridge (log-grid Î±), LightGBM |
| **éªŒæ”¶** | test $R^2 \approx 0.99$â€“1 |
| **æ—©åœ** | $R^2 < 0.95$ â†’ æ£€æŸ¥ pipeline |

**æ’æŸ¥æ¸…å•**ï¼š
- [ ] è¾“å…¥ç»´åº¦æ˜¯å¦æ­£ç¡®ï¼ˆ4096ï¼‰
- [ ] å½’ä¸€åŒ–æ˜¯å¦ä¸æ—§å®éªŒä¸€è‡´
- [ ] train/test æ˜¯å¦æ­£ç¡® shuffle & split
- [ ] target æ˜¯å¦åšäº†é”™è¯¯å˜æ¢

---

## Phase 1: Meta Feature Baseline

### MVP-1.0: F0 Teff-only (noise=0)

| é¡¹ç›® | é…ç½® |
|------|------|
| **ç›®æ ‡** | å›ç­”"åªçŸ¥é“ Teffï¼Œ$\log g$ å¯è§£é‡Šåº¦æœ‰å¤šå°‘ï¼Ÿ" |
| **æ•°æ®** | noise=0, 5k/1k |
| **æ¨¡å‹** | Ridge / ElasticNet |
| **ç‰¹å¾** | Teff, TeffÂ², log(Teff)ï¼ˆæ ‡å‡†åŒ–ï¼‰ |
| **éªŒæ”¶** | ç‹¬ç«‹ grid: $R^2 \in [0, 0.1]$ |
| **å¼‚å¸¸å¤„ç†** | $R^2 > 0.6$ â†’ ç”» Teff vs $\log g$ æ•£ç‚¹å›¾ |

### MVP-1.1: F0 across noise

| é¡¹ç›® | é…ç½® |
|------|------|
| **ç›®æ ‡** | æ£€æŸ¥ noise å¯¹çº¯ meta ç‰¹å¾çš„å½±å“ï¼ˆåº”å‡ ä¹ä¸º 0ï¼‰ |
| **æ•°æ®** | noise âˆˆ {0, 0.3, 1.0, 2.0}, 5k/1k |
| **éªŒæ”¶** | $R^2$ éš noise å‡ ä¹ä¸å˜ |
| **å¼‚å¸¸å¤„ç†** | å˜åŒ–å¤§ â†’ æ£€æŸ¥ Teff æ˜¯å¦ä» noisy å…‰è°±ä¼°è®¡ |

### MVP-2.0: F1 (Teff + [M/H]\_oracle, noise=0)

| é¡¹ç›® | é…ç½® |
|------|------|
| **ç›®æ ‡** | çœ‹"Teff + çœŸ [M/H]"èƒ½è§£é‡Šå¤šå°‘æ–¹å·® |
| **æ•°æ®** | noise=0, 5k/1k |
| **æ¨¡å‹** | Ridgeï¼ˆå«äº¤äº’é¡¹ï¼‰ |
| **éªŒæ”¶** | $R^2$ æ¯” F0 ç•¥é«˜ï¼Œä½† < 0.5â€“0.6 |
| **å¼‚å¸¸å¤„ç†** | $R^2 > 0.9$ â†’ ç”» (Teff, [M/H]) â†’ $\log g$ æŠ•å½± |

---

## Phase 2: Global Statistics

### MVP-3.0: F2 (åŠ  mean/std/ç²—é¢œè‰², noise=0)

| é¡¹ç›® | é…ç½® |
|------|------|
| **ç›®æ ‡** | æ£€æŸ¥ photometry-like stats èƒ½å¦æ˜¾è‘—æå‡ |
| **æ•°æ®** | noise=0, 5k/1k |
| **æ¨¡å‹** | Ridge |
| **éªŒæ”¶** | ç›¸å¯¹ F1 æœ‰ä¸€å®šæå‡ï¼Œä½†ä¸æ¥è¿‘ full-spectrum |
| **å¼‚å¸¸å¤„ç†** | å‡ ä¹æ— æå‡ â†’ continuum è¢«å½’ä¸€åŒ–æ‰ |

### MVP-3.1: F3 (åŠ å…¥ EW/é¢œè‰²çº¿å‹ç‰¹å¾)

| é¡¹ç›® | é…ç½® |
|------|------|
| **ç›®æ ‡** | éªŒè¯ Top-K å±€éƒ¨çº¿å‹ summary èƒ½å¦æ˜¾è‘—æå‡ $R^2$ |
| **æ•°æ®** | noise=0, 5k/1k |
| **æ¨¡å‹** | Ridge + å° MLPï¼ˆå¯¹ç…§ï¼‰ |
| **éªŒæ”¶** | $R^2$ ä» F2 æ°´å¹³æ˜¾è‘—è·³å‡ï¼ˆå¦‚ 0.3â€“0.4 â†’ 0.5â€“0.7ï¼‰ |
| **æ—©åœæ¡ä»¶** | æå‡ < 0.05 â†’ ç”» Î»\_i é™„è¿‘å¹³å‡è°±éš $\log g$ å˜åŒ– |

**â†’ Global Tower æ˜ å°„**ï¼šè‹¥ F3 è¾¾ $R^2 > 0.7$ï¼Œåº”åœ¨ Global Tower ä¸­é¢„ç•™ EW ç‰¹å¾é€šé“

---

## Phase 3: PCA Integration

### MVP-4.0: F4 (F3 + PCA K=10/20, noise=0)

| é¡¹ç›® | é…ç½® |
|------|------|
| **ç›®æ ‡** | çœ‹å°‘é‡ PCA mode æ˜¯å¦è®© $R^2$ æ¥è¿‘ full-spectrum |
| **æ•°æ®** | noise=0, 5k/1k |
| **æ¨¡å‹** | Ridge |
| **æ³¨æ„** | PCA åœ¨ train ä¸Š fitï¼Œå† transform test |
| **éªŒæ”¶** | ç›¸å¯¹ F3 æœ‰æ˜æ˜¾æå‡ï¼Œä½†ä¸ full-spectrum ä»æœ‰å·®è· |

### MVP-4.1: F5 (F3 + PCA K=50/100/200, noise=0)

| é¡¹ç›® | é…ç½® |
|------|------|
| **ç›®æ ‡** | ç³»ç»ŸåŒ– PCA ç»“è®ºï¼Œç”» $R^2(K)$ æ›²çº¿ |
| **æ•°æ®** | noise=0, 32k/8k |
| **æ¨¡å‹** | Ridgeï¼ˆå¯¹æ¯ä¸ª K å•ç‹¬è°ƒ Î±ï¼‰ |
| **éªŒæ”¶** | K=50: ~0.9, K=100: ~0.97, K=200: â‰ˆ full-spectrum |
| **æ—©åœ** | K æå‡æ—¶ $R^2$ ä¸‹é™ â†’ å¢åŠ æ­£åˆ™ |

**â†’ Global Tower æ˜ å°„**ï¼šç¡®å®šè¾“å…¥è§„æ¨¡é¶ç‚¹ï¼ˆPCA(100) + EW + stats + Teff â‰ˆ 150 ç»´ï¼‰

### MVP-4.2: F5 across noise

| é¡¹ç›® | é…ç½® |
|------|------|
| **ç›®æ ‡** | æ¯”è¾ƒ F5 vs full-spectrum åœ¨ä¸åŒ noise ä¸‹çš„é²æ£’æ€§ |
| **æ•°æ®** | æ··åˆä¸åŒ noise levelï¼Œnoise\_level ä½œä¸ºè¾“å…¥ç‰¹å¾ |
| **æ¨¡å‹** | Ridge / å° MLP |
| **éªŒæ”¶** | é«˜ noise (â‰¥1) ä¸‹ F5 ä¸‹é™å¹…åº¦æ¯” full-spectrum æ›´å° |

**â†’ Global Tower å¯å‘**ï¼šè‹¥ F5 æ›´é²æ£’ â†’ Global Tower æä¾›"æŠ—å™ªçš„ä½ç»´ prior"

---

## Phase 4: Realistic Scenario

### MVP-5.0: F6 (æ—  oracle [M/H])

| é¡¹ç›® | é…ç½® |
|------|------|
| **ç›®æ ‡** | è¯„ä¼° oracle vs realistic [M/H] çš„å·®è· |
| **æ•°æ®** | noise=0, 32k/8k |
| **æ¨¡å‹** | Ridge / å° MLP |
| **å˜ä½“** | å®Œå…¨æ—  [M/H] / ä½¿ç”¨ [M/H]\_est |
| **éªŒæ”¶** | $R^2$ æ¯” F5 ç•¥ä½ï¼Œæ›²çº¿å½¢çŠ¶ç›¸ä¼¼ |
| **å¼‚å¸¸å¤„ç†** | å¤§å¹…ä¸‹é™ (>0.2) â†’ $\log g$-[M/H] å¼ºè€¦åˆï¼Œéœ€ joint modeling |

---

## Phase 5: Global Tower Prototyping

### MVP-Global-1: Global Feature Tower å•å¡” vs Ridge

| é¡¹ç›® | é…ç½® |
|------|------|
| **ç›®æ ‡** | æµ‹è¯• MLP Global Tower èƒ½å¦å¸¦æ¥éçº¿æ€§å¢ç›Š |
| **æ•°æ®** | noise=0.3, 32k/8k |
| **æ¨¡å‹å¯¹æ¯”** | Ridge on F5/F6 vs MLP Global Tower |

**Global Tower ç»“æ„**ï¼š
```
Input (d_in â‰ˆ 150)
    â†“
Linear(d_in â†’ 128) + ReLU
    â†“
Linear(128 â†’ 128) + ReLU
    â†“
Linear(128 â†’ 64) â†’ h_global
    â†“
Linear(64 â†’ 1) â†’ log_g prediction
```

| **éªŒæ”¶** | å·®å¼‚å¾ˆå° â†’ $\log g$|F5 åŸºæœ¬æ˜¯çº¿æ€§çš„ |

### MVP-Global-2: Global + Local è”åˆï¼ˆç®€å• concatï¼‰

| é¡¹ç›® | é…ç½® |
|------|------|
| **ç›®æ ‡** | æµ‹è¯• Global+Local concat åœ¨ä¸åŒ noise ä¸‹çš„æ•ˆæœ |
| **æ•°æ®** | noise âˆˆ {0, 0.3, 1.0}, 32k/8k |

**æ¨¡å‹ç»“æ„**ï¼š
```
Local Tower (CNN/Transformer on full spectrum)
    â†“
h_local (dim â‰ˆ 128â€“256)
    â†“
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                          â†“
Global Tower (MLP on F5)    h_global (dim â‰ˆ 64)
    â†“                          â†“
    â””â”€â”€â”€â”€â”€â”€â”€â†’ concat â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
           z = [h_local; h_global]
                â†“
           Linear â†’ log_g
```

**è¯„ä»·**ï¼šä¸‰æ¡ $R^2$ vs noise æ›²çº¿
- only Local
- only Global  
- Local + Global

**éªŒæ”¶**ï¼šé«˜ noise ä¸‹ concat æ˜¾è‘—ä¼˜äº only Local

---

# 2.8 Global Feature Tower è®¾è®¡è‰å›¾

åŸºäºä»¥ä¸Š MVP å®éªŒï¼Œé¢„æœŸæ”¶æ•›åˆ°çš„ Global Tower ç»“æ„ï¼š

## è¾“å…¥ç‰¹å¾è®¾è®¡ ($d_{\text{in}} \approx 150$)

| ç‰¹å¾ç±»å‹ | ç»´åº¦ | è¯´æ˜ |
|---------|------|------|
| Teff å¤šé¡¹å¼ | 3 | Teff, TeffÂ², log(Teff) |
| [M/H]\_est | 1â€“2 | ä¼°è®¡å€¼ + ä¸ç¡®å®šåº¦ï¼ˆå¯é€‰ï¼‰ |
| noise\_level | 1 | æ˜¾å¼ç¼–ç å™ªå£° |
| å…¨å±€ç»Ÿè®¡ | 3â€“6 | mean, std, ç²—é¢œè‰² |
| Top-K EW/depth | 20â€“40 | K æ¡çº¿çš„çº¿å‹ç‰¹å¾ |
| PCA åˆ†é‡ | 64â€“100 | ä¸­ç­‰ç»´åº¦ PCA |

## ç½‘ç»œç»“æ„

```
Input (d_in â‰ˆ 150)
    â†“
Layer1: Linear(150 â†’ 128) + ReLU
    â†“
Layer2: Linear(128 â†’ 128) + ReLU
    â†“
Layer3: Linear(128 â†’ 64) â†’ h_global
    â†“
Head: Linear(64 â†’ 1) â†’ log_g (è®­ç»ƒæ—¶)
```

## ä¸ Local Tower èåˆç­–ç•¥

### ç­–ç•¥ A: ç®€å• Concat

$$
z = [h_{\text{local}}; h_{\text{global}}], \quad \hat{y} = W z + b
$$

### ç­–ç•¥ B: FiLM è°ƒåˆ¶

$$
(\gamma_l, \beta_l) = \text{MLP}(h_{\text{global}})
$$

$$
f_l' = \gamma_l \odot f_l + \beta_l
$$

### ç­–ç•¥ C: ä¸»å¹² + æ®‹å·®

$$
\hat{g}_0 = f_{\text{global}}(F)
$$

$$
\Delta g = f_{\text{local}}(\text{spectrum}, h_{\text{global}})
$$

$$
\hat{g} = \hat{g}_0 + \Delta g
$$

---

# 3. ğŸ“Š å®éªŒå›¾è¡¨

> å®éªŒå®Œæˆåå¡«å†™

### å›¾ 1ï¼šç‰¹å¾å®¶æ— $R^2$ é˜¶æ¢¯å›¾
TODO: `logg/gta/img/feature_family_r2_ladder.png`

**Figure 1. F0â€“F6 ç‰¹å¾å®¶æ—åœ¨ noise=0 ä¸‹çš„ $R^2$ é€’å¢è¶‹åŠ¿**

**å…³é”®è§‚å¯Ÿ**ï¼š
- TODO

---

### å›¾ 2ï¼šPCA ç»´åº¦ vs $R^2$ æ›²çº¿
TODO: `logg/gta/img/pca_dim_vs_r2.png`

**Figure 2. PCA åˆ†é‡æ•° $K$ ä¸ $R^2$ çš„å…³ç³»ï¼Œå¯¹æ¯” full-spectrum baseline**

**å…³é”®è§‚å¯Ÿ**ï¼š
- TODO

---

### å›¾ 3ï¼šNoise é²æ£’æ€§å¯¹æ¯”
TODO: `logg/gta/img/noise_robustness_comparison.png`

**Figure 3. F5 vs full-spectrum åœ¨ä¸åŒ noise level ä¸‹çš„ $R^2$ è¡°å‡æ›²çº¿**

**å…³é”®è§‚å¯Ÿ**ï¼š
- TODO

---

### å›¾ 4ï¼šGlobal + Local èåˆæ•ˆæœ
TODO: `logg/gta/img/global_local_fusion.png`

**Figure 4. Global-only / Local-only / Global+Local ä¸‰ç§é…ç½®çš„ $R^2$ vs noise**

**å…³é”®è§‚å¯Ÿ**ï¼š
- TODO

---

# 4. ğŸ’¡ å…³é”®æ´è§ï¼ˆKey Insightsï¼‰

### 4.1 å®è§‚å±‚æ´è§ï¼ˆç”¨äºæŒ‡å¯¼ Neural Network æ¶æ„è®¾è®¡ï¼‰

- âœ… **å…ƒæ•°æ®ä¸æºå¸¦ $\log g$ ä¿¡æ¯**ï¼šTeffã€[M/H]ã€è§‚æµ‹æ¡ä»¶ â†’ $R^2 \approx 0$ï¼ˆæ— é¢„æµ‹èƒ½åŠ›ï¼‰ï¼Œ$\log g$ å¿…é¡»ä»å…‰è°± flux æå–
- âœ… **Grid é‡‡æ ·è®¾è®¡æ­£ç¡®**ï¼š$R^2 \approx 0$ è¯´æ˜ (Teff, [M/H], $\log g$) ä¸‰è€…ç‹¬ç«‹é‡‡æ ·ï¼Œæ— å‡½æ•°å…³ç³»ï¼ˆè‹¥ $R^2 \approx 1$ åˆ™è¯´æ˜æœ‰é—®é¢˜ï¼‰
- TODO: $\log g$ åœ¨å…‰è°±ç©ºé—´ä¸­çš„æœ‰æ•ˆç»´åº¦æ˜¯å¤šå°‘ï¼Ÿ
- TODO: ä¿¡æ¯æ˜¯é›†ä¸­åœ¨å°‘æ•°å‡ æ¡çº¿ï¼Œè¿˜æ˜¯åˆ†å¸ƒåœ¨ ~100 ç»´çš„"å…¨è°±é‡"ä¸Šï¼Ÿ

### 4.2 æ¨¡å‹å±‚æ´è§ï¼ˆç”¨äºä¼˜åŒ–æ¨¡å‹ï¼‰

- âœ… **çº¿æ€§ vs éçº¿æ€§æ— å·®å¼‚**ï¼ˆåœ¨å…ƒæ•°æ®ä¸Šï¼‰ï¼šLightGBM ç¬¬1è½®æ—©åœï¼Œä¸ OLS $R^2$ ç›¸åŒ â†’ å…ƒæ•°æ®ä¸ $\log g$ æ—¢æ— çº¿æ€§ä¹Ÿæ— éçº¿æ€§å…³ç³»
- TODO: å“ªäº›**å…‰è°±ç‰¹å¾**å¯¹ $\log g$ é¢„æµ‹è´¡çŒ®æœ€å¤§ï¼Ÿ
- TODO: æ­£åˆ™åŒ–ç­–ç•¥å¦‚ä½•éšç‰¹å¾ç»´åº¦è°ƒæ•´ï¼Ÿ

### 4.3 å®éªŒå±‚ç»†èŠ‚æ´è§

- âœ… **OLS ç³»æ•°åˆ†æ**ï¼šT_eff ç³»æ•°ä»… 0.0067ï¼ŒM_H ç³»æ•°ä»… 0.0059ï¼Œå‡å¯å¿½ç•¥ ([è¯¦æƒ…](exp_gta_f0f1_metadata_baseline_20251130.md))
- TODO: Top-K çº¿çš„é€‰å–ç¨³å®šæ€§å¦‚ä½•ï¼Ÿ
- TODO: PCA åœ¨é«˜ noise ä¸‹æ˜¯å¦ä»æœ‰æ•ˆï¼Ÿ

---

# 5. ğŸ“ ç»“è®ºï¼ˆConclusionï¼‰

> å®éªŒå®Œæˆåå¡«å†™

## 5.1 æ ¸å¿ƒå‘ç°

> **TODO: ä¸€å¥è¯æ€»ç»“**

- âŒ åŸå‡è®¾ï¼šTODO
- âœ… å®éªŒç»“æœï¼šTODO

## 5.2 å…³é”®ç»“è®ºï¼ˆ2-4 æ¡ï¼‰

| # | ç»“è®º | è¯æ® |
|---|------|------|
| 1 | **TODO** | TODO |
| 2 | **TODO** | TODO |
| 3 | **TODO** | TODO |

## 5.3 è®¾è®¡å¯ç¤º

### æ¶æ„åŸåˆ™

| åŸåˆ™ | å»ºè®® | åŸå›  |
|------|------|------|
| Global Tower è¾“å…¥ç»´åº¦ | ~150 ç»´ | TODO |
| Global Tower è¾“å‡ºç»´åº¦ | ~64 ç»´ | TODO |
| èåˆç­–ç•¥ | TODO | TODO |

### âš ï¸ å¸¸è§é™·é˜±

| å¸¸è§åšæ³• | å®éªŒè¯æ® |
|----------|----------|
| TODO | TODO |

## 5.4 ç‰©ç†è§£é‡Š

- TODO: ä¸ºä»€ä¹ˆ $\log g$ ä¿¡æ¯åˆ†å¸ƒåœ¨ ~100 ç»´å­ç©ºé—´ï¼Ÿ
- TODO: å“ªäº›ç‰©ç†è¿‡ç¨‹ä¸»å¯¼äº† $\log g$ çš„å¯è¾¨åˆ«æ€§ï¼Ÿ

## 5.5 å…³é”®æ•°å­—é€ŸæŸ¥

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| F0 (Teff-only) $R^2$ | **â‰ˆ0** âœ… |
| F1 (+ [M/H]) $R^2$ | **â‰ˆ0** âœ… |
| F3 (+ EW) $R^2$ | TODO |
| F5 (+ PCA 100) $R^2$ | TODO |
| Full-spectrum baseline | TODO |
| Global Tower æ¨èè¾“å…¥ç»´åº¦ | ~150 |

## 5.6 ä¸‹ä¸€æ­¥å·¥ä½œ

| æ–¹å‘ | å…·ä½“ä»»åŠ¡ |
|------|----------|
| å®éªŒæ‰§è¡Œ | æŒ‰ MVP è·¯çº¿å›¾ä¾æ¬¡å®Œæˆ F0â€“F6 å®éªŒ |
| Global Tower åŸå‹ | å®ç° MLP Global Tower å¹¶ä¸ Ridge å¯¹æ¯” |
| èåˆç­–ç•¥æµ‹è¯• | æ¯”è¾ƒ concat / FiLM / ä¸»å¹²+æ®‹å·® ç­–ç•¥ |
| çœŸå®æ•°æ®éªŒè¯ | åœ¨è§‚æµ‹æ•°æ®ä¸ŠéªŒè¯åˆæˆæ•°æ®ç»“è®ºçš„è¿ç§»æ€§ |

---

# 6. ğŸ“ é™„å½•

## 6.1 å†³ç­–æ ‘ï¼šä¸åŒå®éªŒç»“æœçš„è§£è¯»ä¸åº”å¯¹

### æƒ…å½¢ A: Teff-only / Teff+[M/H] å°±å·²ç» $R^2$ å¾ˆé«˜ (>0.9)

**è¯Šæ–­**ï¼šGrid é‡Œ $\log g$ åŸºæœ¬ç”± (Teff, [M/H]) å†³å®š

**ç‰©ç†å«ä¹‰**ï¼š
- å…‰è°±é‡Œå…³äº $\log g$ çš„ä¿¡æ¯é€šè¿‡"æ˜Ÿæ—ç»“æ„"é—´æ¥ç»™å‡º
- å¯èƒ½ä¸å¤Ÿ realisticï¼ˆçœŸå®å®‡å®™ä¸­åŒ Teff åŒ [M/H] çš„ dwarf/giant åœ¨å…‰è°±é‡Œæœ‰åŒºåˆ«ï¼‰

**Local Tower è§’è‰²**ï¼šæ®‹å·®ä¿®æ­£å™¨ï¼ˆä¿®è¡¥é LTEã€å¾®æ¹æµã€å½’ä¸€åŒ–æ•ˆåº”ï¼‰

**å»ºè®®ç­–ç•¥**ï¼šä¸»å¹²+æ®‹å·®ç»“æ„
$$
\hat{g}_0 = f_{\text{global}}(F), \quad \Delta g = f_{\text{local}}(\cdot), \quad \hat{g} = \hat{g}_0 + \Delta g
$$

---

### æƒ…å½¢ B: å¿…é¡»ä¾èµ– PCA 100â€“200 ç»´æ‰æ¥è¿‘ baseline

**è¯Šæ–­**ï¼š$\log g$ ä¿¡æ¯åˆ†å¸ƒåœ¨ ~100 ç»´å­ç©ºé—´

**å¯¹ Global Tower çš„è¦æ±‚**ï¼š
- è¾“å…¥ç»´åº¦ ~100â€“200
- Hidden dim è‡³å°‘ 64â€“256
- å±‚æ•° 2â€“3 å³å¯

**Local Tower è§’è‰²**ï¼šå­¦ä¹ æç»†å±€éƒ¨ç»“æ„ã€é«˜é˜¶éçº¿æ€§æ•ˆåº”

**å»ºè®®ç­–ç•¥**ï¼šGlobal æä¾› baselineï¼ŒLocal è¡¥æ®‹å·®

---

### æƒ…å½¢ C: åŠ å…¥ EW/é¢œè‰²ç‰¹å¾ï¼ˆF3ï¼‰èƒ½æ˜¾è‘—æå‡

**è¯Šæ–­**ï¼š$\log g$ ä¿¡æ¯ä¸»è¦é€šè¿‡è‹¥å¹²"å…³é”®çº¿/çº¿ç¾¤"ä½“ç°

**å¯¹ Local Tower çš„å¯ç¤º**ï¼š
- åœ¨ Top-K Î» åŒºåŸŸä½¿ç”¨æ›´ç»†çš„ patch åˆ†è¾¨ç‡
- åœ¨ Transformer ä¸­ç»™è¿™äº› Î» æ›´é«˜ attention bias
- å¯å¼€è®¾"line-focused branch"

**Global Tower è®¾è®¡**ï¼šå†…ç½® EW ç‰¹å¾ï¼Œé€šè¿‡ FiLM è°ƒåˆ¶ Local Tower

---

### æƒ…å½¢ D: ç°å®ç‰ˆ F6 ç›¸æ¯” F5 æ˜¾è‘—ä¸‹é™

**è¯Šæ–­**ï¼š$\log g$ ä¸ [M/H] å¼ºè€¦åˆ

**åº”å¯¹ç­–ç•¥**ï¼š
- Joint modeling / latent å˜é‡æ¨¡å‹
- å¤šä»»åŠ¡ç½‘ç»œåŒæ—¶é¢„æµ‹ $\log g$ å’Œ [M/H]
- Global Tower è¾“å…¥ [M/H]\_est + ä¸ç¡®å®šåº¦ + latent correction

---

### æƒ…å½¢ E: F4/F5 åœ¨é«˜ noise ä¸‹æ›´é²æ£’

**è¯Šæ–­**ï¼šä¸­ç­‰ç»´åº¦ PCA+EW èµ·"é™å™ª + å»å†—ä½™"ä½œç”¨

**Global Tower è®¾è®¡**ï¼š
- æ˜¾å¼ç¼–ç  noise\_level
- å­¦ä¹ åœ¨é«˜ noise ä¸‹é™ä½å¯¹é«˜é˜¶ PCA / ç»†çº¿ EW çš„æƒé‡

**FiLM / Gating ç­–ç•¥**ï¼š
$$
g_l = \sigma(\text{MLP}(h_{\text{global}}))
$$
$$
f_l' = g_l \odot f_l
$$

é«˜ noise æ—¶ $g_l$ å‹ä½å™ªå£°æ•æ„Ÿçš„å±€éƒ¨ç‰¹å¾é€šé“

---

## 6.2 æ•°å€¼ç»“æœè¡¨ï¼ˆResultsï¼‰

> å®éªŒå®Œæˆåå¡«å†™

### F0â€“F6 ç‰¹å¾å®¶æ— $R^2$ å¯¹æ¯” (noise=0)

| é…ç½® | $R^2$ | MAE | RMSE | å¤‡æ³¨ |
|------|-------|-----|------|------|
| F0 (Teff-only) | **â‰ˆ0** | 1.006 | 1.168 | âœ… å·²éªŒè¯ |
| F1 (+ [M/H]) | **-0.002** | 1.006 | 1.169 | âœ… å·²éªŒè¯ ([è¯¦æƒ…](exp_gta_f0f1_metadata_baseline_20251130.md)) |
| F2 (+ stats) | TODO | TODO | TODO | |
| F3 (+ EW) | TODO | TODO | TODO | |
| F4 (+ PCA 20) | TODO | TODO | TODO | |
| F5 (+ PCA 100) | TODO | TODO | TODO | |
| F6 (no oracle) | TODO | TODO | TODO | |
| Full-spectrum | TODO | TODO | TODO | baseline |

> **æ³¨**ï¼šF0/F1 ç»“æœæ¥è‡ª [F0/F1 Metadata Baseline å®éªŒ](exp_gta_f0f1_metadata_baseline_20251130.md)ï¼Œä½¿ç”¨ 32k è®­ç»ƒ / 1k æµ‹è¯•

### PCA ç»´åº¦æ‰«æ (noise=0)

| K | $R^2$ | MAE | å¤‡æ³¨ |
|---|-------|-----|------|
| 5 | TODO | TODO | |
| 10 | TODO | TODO | |
| 20 | TODO | TODO | |
| 50 | TODO | TODO | |
| 100 | TODO | TODO | |
| 200 | TODO | TODO | |

### Noise é²æ£’æ€§å¯¹æ¯”

| Noise | F5 $R^2$ | Full-spectrum $R^2$ | å·®å€¼ |
|-------|----------|---------------------|------|
| 0 | TODO | TODO | TODO |
| 0.3 | TODO | TODO | TODO |
| 1.0 | TODO | TODO | TODO |
| 2.0 | TODO | TODO | TODO |

---

## 6.3 å»ºè®®ç»˜å›¾ï¼ˆPlot Suggestionsï¼‰

### 6.3.1 ç‰¹å¾å®¶æ— $R^2$ é˜¶æ¢¯å›¾
- **ç›®çš„**ï¼šå±•ç¤º F0â†’F6 çš„ $R^2$ é€’å¢è¶‹åŠ¿
- **X è½´**ï¼šç‰¹å¾å®¶æ— (F0, F1, ..., F6)
- **Y è½´**ï¼š$R^2$
- **å›¾ä¸Šæ ‡æ³¨**ï¼šæ¯ä¸ªå®¶æ—çš„ä¸»è¦æ–°å¢ç‰¹å¾ã€full-spectrum baseline æ°´å¹³çº¿

### 6.3.2 PCA ç»´åº¦ vs $R^2$ é¥±å’Œæ›²çº¿
- **ç›®çš„**ï¼šé‡åŒ– $\log g$ ä¿¡æ¯çš„æœ‰æ•ˆç»´åº¦
- **X è½´**ï¼šPCA ç»´åº¦ $K$ (log scale)
- **Y è½´**ï¼š$R^2$
- **å›¾ä¸Šæ ‡æ³¨**ï¼š$K=100$ å’Œ $K=200$ å¤„çš„ $R^2$ å€¼ã€full-spectrum baseline

### 6.3.3 Noise é²æ£’æ€§å¯¹æ¯”
- **ç›®çš„**ï¼šæ¯”è¾ƒ F5 vs full-spectrum çš„æŠ—å™ªèƒ½åŠ›
- **X è½´**ï¼šNoise level $\sigma$
- **Y è½´**ï¼š$R^2$
- **å›¾ä¸Šæ›²çº¿**ï¼šF5 (K=100)ã€full-spectrum Ridge

### 6.3.4 Teff vs $\log g$ æ•£ç‚¹å›¾
- **ç›®çš„**ï¼šè¯Šæ–­ grid æ˜¯å¦å­˜åœ¨å¼º Teff-$\log g$ ç›¸å…³
- **X è½´**ï¼šTeff
- **Y è½´**ï¼š$\log g$
- **å›¾ä¸Šæ ‡æ³¨**ï¼šè‹¥å‘ˆçª„å¸¦çŠ¶ï¼Œè¯´æ˜å­˜åœ¨é—®é¢˜

### 6.3.5 Global + Local èåˆæ•ˆæœ
- **ç›®çš„**ï¼šæ¯”è¾ƒä¸åŒèåˆç­–ç•¥çš„æ•ˆæœ
- **X è½´**ï¼šNoise level
- **Y è½´**ï¼š$R^2$
- **å›¾ä¸Šæ›²çº¿**ï¼šGlobal-onlyã€Local-onlyã€Global+Local (concat)

---

## 6.4 ç›¸å…³æ–‡ä»¶

| ç±»å‹ | è·¯å¾„ | çŠ¶æ€ |
|------|------|------|
| å®éªŒä¼åˆ’ | `logg/gta/exp_global_tower_architecture_20251130.md` | å½“å‰æ–‡ä»¶ |
| å›¾è¡¨ç›®å½• | `logg/gta/img/` | |
| **F0/F1 Baseline** | [`exp_gta_f0f1_metadata_baseline_20251130.md`](exp_gta_f0f1_metadata_baseline_20251130.md) | âœ… å·²å®Œæˆ |
| PCA å®éªŒå‚è€ƒ | `logg/pca/exp_pca_linear_regression_20251128.md` | |
| Ridge å®éªŒå‚è€ƒ | `logg/ridge/exp_ridge_alpha_sweep_20251127.md` | |
| Top-K å®éªŒå‚è€ƒ | `logg/noise/exp_topk_feature_selection_lgbm_vs_ridge_20251129.md` | |

---

## 6.5 å®éªŒä»£ç ç»“æ„å»ºè®®

```
experiments/
â”œâ”€â”€ gta/
â”‚   â”œâ”€â”€ config.py              # è¶…å‚æ•°é…ç½®
â”‚   â”œâ”€â”€ features.py            # ç‰¹å¾å·¥ç¨‹ (F0-F6)
â”‚   â”œâ”€â”€ models.py              # Ridge / MLP æ¨¡å‹
â”‚   â”œâ”€â”€ data_loader.py         # æ•°æ®åŠ è½½ä¸é¢„å¤„ç†
â”‚   â”œâ”€â”€ mvp_0_baseline.py      # MVP-0: Full-spectrum baseline
â”‚   â”œâ”€â”€ mvp_1_teff.py          # MVP-1: Teff-only
â”‚   â”œâ”€â”€ mvp_2_meta.py          # MVP-2: Teff + [M/H]
â”‚   â”œâ”€â”€ mvp_3_stats.py         # MVP-3: + ç»Ÿè®¡é‡ + EW
â”‚   â”œâ”€â”€ mvp_4_pca.py           # MVP-4: + PCA
â”‚   â”œâ”€â”€ mvp_5_realistic.py     # MVP-5: ç°å®ç‰ˆ
â”‚   â”œâ”€â”€ mvp_global_tower.py    # Global Tower åŸå‹
â”‚   â””â”€â”€ evaluate.py            # è¯„ä¼°ä¸ç»˜å›¾
```

---

*å®éªŒä¼åˆ’ v1.0 - å¾…æ‰§è¡Œ*

