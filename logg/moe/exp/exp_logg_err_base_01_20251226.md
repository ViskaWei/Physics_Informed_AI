# ğŸ“— LOGG-ERR-BASE-01: Error-Only Leakage Baseline

> **MVP:** 0.1 | **Gate:** Gate-1 (Leakage Audit)
> **Author:** Viska Wei | **Date:** 2025-12-26 | **Status:** âŒ FAIL

---

## ğŸ”— ä¸Šæ¸¸è¿½æº¯

| ç±»å‹ | é“¾æ¥ |
|------|------|
| Hub | `moe_snr_hub.md` Â§DG1 |
| Roadmap | `moe_snr_roadmap.md` MVP-0.1 |
| Session | - |

---

## âš¡ æ ¸å¿ƒç»“è®ºé€Ÿè§ˆ

**ä¸€å¥è¯**: Error vector å­˜åœ¨**ä¸¥é‡æ³„éœ²**ï¼ŒRÂ² = 0.99ï¼Œå‡ ä¹å¯ä»¥å®Œç¾é¢„æµ‹ loggï¼å¿…é¡»å…ˆå»æ³„éœ²æ‰èƒ½ç”¨äº MoE gateã€‚

**å‡è®¾éªŒè¯**:
- âŒ H1: error vector é¢„æµ‹ logg çš„ RÂ² < 0.05 â†’ **å®é™… RÂ² = 0.9896ï¼Œä¸¥é‡è¶…æ ‡**

**å…³é”®æ•°å­—**:
| æŒ‡æ ‡ | å€¼ |
|------|---|
| error-only RÂ² (Ridge best, Î±=0.001) | **0.9896** |
| error-only RÂ² (OLS) | 0.024 |
| Shuffle å RÂ² | -0.98 (å´©æºƒ) |
| Agg-stats RÂ² | 0.068 |
| Top-40 åƒç´ è´¡çŒ®å æ¯” | 14.87% |

---

## ğŸ¯ ç›®æ ‡

é‡åŒ– error vector çš„"æ³„éœ²ç¨‹åº¦"ï¼š
1. å¦‚æœ error-only RÂ² æ¥è¿‘ 0 â†’ error ä¸æºå¸¦å¤©ä½“å‚æ•°ä¿¡æ¯ï¼Œå¯ç›´æ¥ç”¨äº gate
2. å¦‚æœ error-only RÂ² å¾ˆé«˜ â†’ error æºå¸¦æ³„éœ²ä¿¡æ¯ï¼Œéœ€è¦å»æ³„éœ²åå†ç”¨

---

## ğŸ§ª å®éªŒè®¾è®¡

### 2.1 æ•°æ®
- è®­ç»ƒé›†: 10k samples (from mag205_225_lowT_1M)
- æµ‹è¯•é›†: 1k samples
- è¾“å…¥: **error vector ONLY**ï¼ˆ4096 ç»´ï¼‰
- è¾“å‡º: log_g

### 2.2 æ¨¡å‹
- LinearRegression (OLS)
- Ridge (alpha = 0.001, 0.01, 0.1, 1.0, 10.0, 100.0)

### 2.3 Sanity Checks
- Shuffle Test: æ‰“ä¹±æ³¢é•¿å¯¹é½ï¼Œæ£€éªŒæ˜¯å¦ä¾èµ–ä½ç½®ä¿¡æ¯
- Mask-only Test: åªç”¨äºŒå€¼ maskï¼Œæ£€éªŒæ˜¯å¦æ˜¯æ³„éœ²æº
- Aggregate Stats Test: åªç”¨ç»Ÿè®¡é‡ (mean, std, etc.)

---

## ğŸ“Š å®éªŒå›¾è¡¨

### Fig 1: Error-Only RÂ² Across Models
![r2_models](../img/logg_err_base_01_r2_models.png)
**æè¿°**: ç”¨ error vector é¢„æµ‹ logg çš„å„æ¨¡å‹ RÂ²
**å…³é”®è§‚å¯Ÿ**: Ridge (Î±=0.001) è¾¾åˆ° RÂ² = 0.99ï¼ä¸¥é‡æ³„éœ²ï¼OLS å› é«˜ç»´è¿‡æ‹Ÿåˆè¡¨ç°å·®ã€‚

### Fig 2: Feature Importance Spectrum
![importance](../img/logg_err_base_01_importance_spectrum.png)
**æè¿°**: å“ªäº›åƒç´ ï¼ˆæ³¢é•¿ä½ç½®ï¼‰å¯¹é¢„æµ‹ logg è´¡çŒ®æœ€å¤§
**å…³é”®è§‚å¯Ÿ**: Top-40 åƒç´ é›†ä¸­åœ¨ ~3277-3388 å’Œ ~3724-3869 åŒºåŸŸ

### Fig 3: Importance Distribution
![importance_hist](../img/logg_err_base_01_importance_hist.png)
**æè¿°**: ç‰¹å¾é‡è¦æ€§åˆ†å¸ƒ
**å…³é”®è§‚å¯Ÿ**: é•¿å°¾åˆ†å¸ƒï¼Œå¤§éƒ¨åˆ†åƒç´ é‡è¦æ€§ä½ï¼Œå°‘é‡åƒç´ è´¡çŒ®å¤§

### Fig 4: Sanity Check Results
![sanity](../img/logg_err_base_01_sanity_checks.png)
**æè¿°**: ä¸‰ç§ sanity check å¯¹æ¯”
**å…³é”®è§‚å¯Ÿ**: 
- Shuffle åæ€§èƒ½å´©æºƒ (RÂ² = -0.98) â†’ æ¨¡å‹ä¾èµ–æ³¢é•¿å¯¹é½ä¿¡æ¯
- Agg-stats RÂ² = 0.068 â†’ ä¸æ˜¯ç®€å•çš„ç»Ÿè®¡é‡æ³„éœ²ï¼Œæ˜¯åƒç´ çº§ä¿¡æ¯

---

## ğŸ’¡ å…³é”®æ´è§

| # | æ´è§ | è¯æ® | å†³ç­–å½±å“ |
|---|------|------|----------|
| 1 | Error ä¸¥é‡æ³„éœ² logg | RÂ² = 0.99 | å¿…é¡»å»æ³„éœ² |
| 2 | æ³„éœ²æ˜¯æ³¢é•¿å¯¹é½çš„ | Shuffle åå´©æºƒ | ä¸èƒ½ç›´æ¥ç”¨ error åš gate |
| 3 | ä¸æ˜¯ç®€å•ç»Ÿè®¡é‡ | Agg-stats RÂ² = 0.07 | éœ€è¦æ›´å¤æ‚çš„å»æ³„éœ²ç­–ç•¥ |
| 4 | Top åƒç´ é›†ä¸­ç‰¹å®šåŒºåŸŸ | 3277-3388, 3724-3869 | å¯èƒ½ä¸ç‰¹å®šè°±çº¿ç›¸å…³ |

---

## ğŸ“ ç»“è®º

### 5.1 æ ¸å¿ƒå‘ç°
Error vector å‡ ä¹å®Œç¾é¢„æµ‹ logg (RÂ² = 0.99)ï¼Œè¯´æ˜ PFS simulator ç”Ÿæˆçš„ error ä¸å¤©ä½“ç‰©ç†å‚æ•°é«˜åº¦ç›¸å…³ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºï¼š
1. Error ä¸ flux å½¢çŠ¶ç›¸å…³ï¼Œè€Œ flux å½¢çŠ¶ä¸ logg ç›¸å…³
2. ä¸åŒ logg çš„æ’æ˜Ÿåœ¨ç‰¹å®šæ³¢é•¿æœ‰ä¸åŒçš„ä¸ç¡®å®šæ€§
3. Simulator çš„å™ªå£°æ¨¡å‹éšå«äº†ç‰©ç†ä¿¡æ¯

### 5.2 Gate-1 åˆ¤å®š
- [ ] é€šè¿‡ (RÂ² < 0.05) â†’ è¿›å…¥ Gate-2
- [x] âŒ **æœªé€šè¿‡** (RÂ² = 0.99 â‰¥ 0.05) â†’ **è¿›å…¥ MVP-0.2 (å»æ³„éœ²)**

### 5.3 è®¾è®¡å¯ç¤º
1. **ä¸èƒ½ç›´æ¥ç”¨ error vector åš MoE gate input**
2. éœ€è¦å»æ³„éœ²ç­–ç•¥ï¼š
   - S1: åŒå£å¾„å½’ä¸€åŒ–ï¼ˆnormalize error by flux magnitudeï¼‰
   - S2: Template Ã— scaleï¼ˆç”¨æ¨¡æ¿ç¼©æ”¾ï¼‰
   - S3: æ— å¯¹é½ç»Ÿè®¡ï¼ˆåªç”¨ä¸ä¾èµ–æ³¢é•¿ä½ç½®çš„ç»Ÿè®¡é‡ï¼‰

---

## ğŸ“ é™„å½•

### 6.1 æ•°å€¼ç»“æœè¡¨

| Model | Train RÂ² | Test RÂ² | MAE | RMSE |
|-------|----------|---------|-----|------|
| OLS | 0.0267 | 0.0241 | 0.967 | 1.132 |
| Ridge_0.001 | 0.9907 | **0.9896** | 0.088 | 0.117 |
| Ridge_0.01 | 0.9772 | 0.9747 | 0.132 | 0.182 |
| Ridge_0.1 | 0.9313 | 0.9245 | 0.226 | 0.315 |
| Ridge_1.0 | 0.8014 | 0.7884 | 0.396 | 0.527 |
| Ridge_10.0 | 0.5005 | 0.4899 | 0.671 | 0.819 |
| Ridge_100.0 | 0.1305 | 0.1287 | 0.915 | 1.070 |

### 6.2 Sanity Check è¯¦ç»†ç»“æœ

**Shuffle Test**:
- åŸå§‹ RÂ²: 0.7884 (Ridge Î±=1.0)
- æ‰“ä¹±å RÂ²: **-0.98**
- ç»“è®º: æ¨¡å‹ä¸¥é‡ä¾èµ–æ³¢é•¿å¯¹é½ä¿¡æ¯

**Mask-only Test**:
- Mask-only RÂ²: **-1.34**
- ç»“è®º: äºŒå€¼ mask æ— æ³•é¢„æµ‹ logg

**Aggregate Stats Test**:
- Agg-stats RÂ² (10 features): **0.068**
- ç»“è®º: ç»Ÿè®¡é‡åªè´¡çŒ®å°‘é‡ä¿¡æ¯ï¼Œä¸»è¦æ³„éœ²åœ¨åƒç´ çº§

### 6.3 Top-10 é‡è¦åƒç´ 

åƒç´ ç´¢å¼•: [3277, 3278, 3388, 3276, 3868, 3724, 3384, 3869, 3383, 3279]

