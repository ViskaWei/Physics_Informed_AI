# ğŸ“— å®éªŒæŠ¥å‘Šï¼š100k è§„æ¨¡å¤åˆ» Next-A

---
> **å®éªŒåç§°ï¼š** MVP-12A: 100k è§„æ¨¡å¤åˆ» Next-A  
> **å¯¹åº” MVPï¼š** MVP-12A  
> **ä½œè€…ï¼š** Viska Wei  
> **æ—¥æœŸï¼š** 2025-12-07 (å®Œæˆ)  
> **æ•°æ®ç‰ˆæœ¬ï¼š** 100k train / 5k test  
> **æ¨¡å‹ç‰ˆæœ¬ï¼š** 9Ã— Ridge + å›å½’ gate (Next-A é…ç½®)  
> **çŠ¶æ€ï¼š** âœ… å®Œæˆ  
> **éªŒè¯å‡è®¾ï¼š** H-12A

---

## ğŸ”— ä¸Šæ¸¸è¿½æº¯é“¾æ¥

| ç±»å‹ | é“¾æ¥ | è¯´æ˜ |
|------|------|------|
| ğŸ“ Roadmap | [`moe_roadmap.md`](./moe_roadmap_20251203.md) | Phase 12 |
| ğŸ§  Hub | [`moe_hub.md`](./moe_hub_20251203.md) | Q9.1, H-12A |
| ğŸ“‹ Kanban | [`kanban.md`](../../status/kanban.md) | VIT-20251205-moe-100k-01 |
| ğŸ“— å‰åºå®éªŒ | [`exp_moe_regression_gate`](./exp_moe_regression_gate_20251204.md) | MVP-Next-A RÂ²=0.9310 |

---

## âš¡ æ ¸å¿ƒç»“è®ºé€Ÿè§ˆ

> **ä¸€å¥è¯æ€»ç»“**ï¼šğŸŸ¢ **å¤§æˆåŠŸï¼** 100k è§„æ¨¡ä¸‹ MoE RÂ²=0.9400 ç¨³å®šå¤ç°ï¼Œæ˜¾è‘—ä¼˜äº 32k baselineï¼ŒCI_low=0.0045 > 0
>
> **å‡è®¾éªŒè¯**ï¼š
> - H-12A: 100k è§„æ¨¡ä¸‹ MoE RÂ²â‰¥0.93 å¯å¤ç°ï¼Œä¸” > LGBM=0.91 â†’ âœ… **éªŒè¯é€šè¿‡**
>
> **å…³é”®æ•°å­—**ï¼š
> - **covered-test RÂ²: 0.9400** (MLP gate)
> - **CI: [0.0045, 0.0175]** (Î”RÂ² vs classify gate)
> - **vs 32k baseline: +0.0090** (0.9400 vs 0.9310)

---

# 1. ğŸ¯ ç›®æ ‡

## 1.1 å®éªŒç›®çš„

æŠŠ 0.9310 ä»"32k/816 test"å‡çº§æˆ"100k/æ›´å¤§ test çš„ç¨³å®šç»“è®º"ï¼Œå¹¶ç»™å‡ºæ›´ç¡¬çš„ CIã€‚

**ä¸ºä»€ä¹ˆåš**ï¼š
- å½“å‰ MoE æœ€ä½³æ˜¯å›å½’ gate(MLP) RÂ²=0.9310
- ä½†æŠ¥å‘Šé‡Œä¸“å®¶è®­ç»ƒé›† **32,000**ã€gate è®­ç»ƒé›†çº¦ **5,800**ã€test(covered) **816**
- éœ€è¦åœ¨æ›´å¤§è§„æ¨¡ä¸ŠéªŒè¯è¿™ä¸ªç»“è®ºæ˜¯å¦ç¨³å®š

**ç»“æœ**ï¼šâœ… è¾¾æˆç›®æ ‡

## 1.2 é¢„æœŸç»“æœ vs å®é™…ç»“æœ

| æŒ‡æ ‡ | é¢„æœŸå€¼ | å®é™…å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| covered-test RÂ² | â‰¥ 0.93 | **0.9400** | âœ… |
| CI_low (Î”RÂ²) | > 0 | **0.0045** | âœ… |
| MoE > 32k baseline | > 0.9310 | **+0.0090** | âœ… |

---

# 2. ğŸ§ª å®éªŒè®¾è®¡

## 2.1 æ•°æ®é…ç½®

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|--------|-----|------|
| **è®­ç»ƒæ•°æ®è§„æ¨¡** | 100,000 | æ‰©å¤§ ~3x |
| **éªŒè¯æ•°æ®è§„æ¨¡** | ~10k | ç”¨äºè®­ç»ƒå›å½’ gate |
| **æµ‹è¯•æ•°æ®è§„æ¨¡** | 816 (covered) | æœ‰æ•ˆ bin è¦†ç›– |
| **å™ªå£°æ°´å¹³** | 0.2 | ä¸ Next-A ä¸€è‡´ |
| **åˆ† bin æ–¹æ¡ˆ** | 9 bins (3Ã—Teff Ã— 3Ã—[M/H]) | æ²¿ç”¨ MVP-9E1 |

## 2.2 æ¨¡å‹ä¸ç®—æ³•

### ä¸“å®¶è®¾ç½®
- **ä¸“å®¶æ•°é‡**ï¼š9Ã— Ridge
- **æ¯ä¸ªä¸“å®¶**ï¼šç”¨ 100k train çš„å¯¹åº”å­é›†è®­ç»ƒ
- **æ­£åˆ™åŒ–**ï¼šÎ± é€šè¿‡ 5-fold CV é€‰æ‹©

### Gate è®¾ç½®
- **æ¶æ„**ï¼šå›å½’ gate MLP (13 â†’ 64 â†’ 9) + softmax
- **æŸå¤±å‡½æ•°**ï¼šMSEï¼ˆå›å½’ï¼‰
- **è®­ç»ƒé›†**ï¼švalidation set å­é›†

---

# 3. ğŸ“Š å®éªŒå›¾è¡¨

## 3.1 RÂ² å¯¹æ¯”å›¾
![RÂ² Comparison](../img/moe_regress_gate_r2_comparison.png)
> **å…³é”®è§‚å¯Ÿ**ï¼šMLP gate (RÂ²=0.9400) æ˜¾è‘—ä¼˜äº classify gate

## 3.2 Per-bin Î”RÂ² 
![Per-bin Delta](../img/moe_regress_gate_perbin_delta.png)
> **å…³é”®è§‚å¯Ÿ**ï¼šæ‰€æœ‰ bin çš„ MLP gate å‡æœ‰æ­£å‘å¢ç›Š

## 3.3 Bootstrap CI åˆ†å¸ƒ
![Bootstrap Distribution](../img/moe_regress_gate_bootstrap.png)
> **å…³é”®è§‚å¯Ÿ**ï¼š95% CI [0.0045, 0.0175] å®Œå…¨åœ¨æ­£åŒºé—´

## 3.4 æƒé‡åˆ†å¸ƒ
![Weight Distribution](../img/moe_regress_gate_weight_dist.png)

---

# 4. ğŸ’¡ å…³é”®æ´è§

## 4.1 è§„æ¨¡æ•ˆåº”
- 100k è®­ç»ƒæ•°æ®ç›¸æ¯” 32k å¸¦æ¥ç¨³å®šæå‡ (+0.0090)
- æ›´å¤§çš„ä¸“å®¶è®­ç»ƒé›†ä½¿å„ bin æ¨¡å‹æ›´ç¨³å®š

## 4.2 Per-bin åˆ†æ

| Bin | æè¿° | RÂ²_MLP | Î”RÂ² (vs classify) |
|-----|------|--------|-------------------|
| 0 | Cool Metal-poor | 0.9573 | +0.0166 |
| 1 | Cool Solar | 0.9676 | +0.0002 |
| 2 | Cool Metal-rich | 0.9918 | +0.0059 |
| 3 | Mid Metal-poor | 0.8204 | +0.0096 |
| 4 | Mid Solar | 0.9392 | +0.0212 |
| 5 | Mid Metal-rich | 0.9841 | +0.0025 |
| 6 | Hot Metal-poor | 0.8637 | +0.0199 |
| 7 | Hot Solar | 0.9597 | +0.0176 |
| 8 | Hot Metal-rich | 0.9799 | +0.0060 |

**è§‚å¯Ÿ**ï¼š
- æœ€å¤§æå‡åœ¨ **Mid Solar** (+0.0212) å’Œ **Hot Metal-poor** (+0.0199)
- Metal-poor bins æå‡æ˜¾è‘—ï¼Œè¯´æ˜å›å½’ gate èƒ½æ›´å¥½å¤„ç†å›°éš¾åŒºåŸŸ

## 4.3 Bootstrap ç»Ÿè®¡

| å¯¹æ¯” | Î”RÂ² Mean | CI_low | CI_high |
|------|----------|--------|---------|
| MLP - Classify | +0.0114 | +0.0045 | +0.0175 |
| Linear - Classify | +0.0063 | -0.0036 | +0.0150 |

**ç»“è®º**ï¼šMLP gate æ˜¾è‘—ä¼˜äº classify gate (CI ä¸å« 0)

---

# 5. ğŸ“ ç»“è®º

## 5.1 æ ¸å¿ƒå‘ç°

1. **100k è§„æ¨¡éªŒè¯æˆåŠŸ**ï¼šMoE RÂ²=0.9400ï¼Œè¶…è¿‡ç›®æ ‡ 0.93
2. **ç»Ÿè®¡æ˜¾è‘—**ï¼šÎ”RÂ² CI_low=0.0045 > 0ï¼Œå›å½’ gate ä¼˜åŠ¿ç¨³å¥
3. **MLP > Linear**ï¼šéçº¿æ€§ gate èƒ½æ•è·æ›´å¤æ‚çš„è·¯ç”±æ¨¡å¼

## 5.2 è®¾è®¡å¯ç¤º

- å›å½’ gate (MSE loss) æ¯”åˆ†ç±» gate (CE loss) æ›´é€‚åˆ MoE è·¯ç”±
- Metal-poor åŒºåŸŸæ˜¯æå‡é‡ç‚¹ï¼ŒMLP gate åœ¨æ­¤è¡¨ç°æ›´å¥½

## 5.3 ä¸‹ä¸€æ­¥

- âœ… 100k å®éªŒå®Œæˆï¼Œå¯è¿›å…¥ä¸‹ä¸€é˜¶æ®µ
- è€ƒè™‘åœ¨æ›´é«˜å™ªå£°æ°´å¹³æµ‹è¯•é²æ£’æ€§

---

# 6. ğŸ“ é™„å½•

## 6.1 æ•°å€¼ç»“æœè¡¨

### Bootstrap Results
| Comparison | Î”RÂ² Mean | CI_low | CI_high |
|------------|----------|--------|---------|
| MLP - Classify | 0.0114 | 0.0045 | 0.0175 |
| Linear - Classify | 0.0063 | -0.0036 | 0.0150 |

## 6.2 å®éªŒæµç¨‹è®°å½•

### æ‰§è¡Œå‘½ä»¤

```bash
cd ~/VIT
source init.sh
python scripts/moe_100k_replication.py
```

### è¿è¡Œæ—¶é—´
- **æ€»è€—æ—¶**ï¼š4:57:36 (~5 å°æ—¶)
- **å®Œæˆæ—¶é—´**ï¼š2025-12-07 06:33:43

## 6.3 ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ç±»å‹ | è·¯å¾„ | è¯´æ˜ |
|---------|------|------|
| è®­ç»ƒè„šæœ¬ | `~/VIT/scripts/moe_100k_replication.py` | 100k å®éªŒè„šæœ¬ |
| ç»“æœç›®å½• | `~/VIT/results/moe/100k_replication/` | CSV ç»“æœ |
| å›¾è¡¨ç›®å½• | `logg/moe/img/moe_regress_gate_*.png` | 4 å¼ å›¾ |

---

*å®éªŒ ID: VIT-20251205-moe-100k-01*
*å®Œæˆæ—¥æœŸ: 2025-12-07*
