# 📗 实验报告：Feature Mining Bin3/Bin6

---
> **实验名称：** MVP-13: Feature Mining Bin3/Bin6  
> **对应 MVP：** MVP-13  
> **作者：** Viska Wei  
> **日期：** 2025-12-05  
> **数据版本：** 全量  
> **模型版本：** Ridge + 新增窗口特征  
> **状态：** 🔄 立项中  
> **验证假设：** H-13

---

## 🔗 上游追溯链接

| 类型 | 链接 | 说明 |
|------|------|------|
| 📍 Roadmap | [`moe_roadmap.md`](./moe_roadmap_20251203.md) | Phase 13 |
| 🧠 Hub | [`moe_hub.md`](./moe_hub_20251203.md) | Q9.3, H-13 |
| 📋 Kanban | [`kanban.md`](../../status/kanban.md) | VIT-20251205-moe-feature-mining-01 |
| 📗 前序实验 | [`exp_moe_expert_calibration`](./exp_moe_expert_calibration_20251204.md) | H-C 校准失败 |

---

## ⚡ 核心结论速览

> **一句话总结**：⏳ 实验进行中
>
> **假设验证**：
> - H-13: 用 ridge 系数/残差选线添加窗口特征能改善 Bin3/Bin6 → ⏳
>
> **关键数字**：
> - Bin3 ΔR²: ⏳
> - Bin6 ΔR²: ⏳

---

# 1. 🎯 目标

## 1.1 实验目的

只改善 Bin3/Bin6（Metal-poor bins），通过添加新的物理窗口特征。

**为什么做**：
- H-C 校准失败说明 Metal-poor 误差不是简单 bias
- 误差来源是"缺信息/异质性"，不是"线性偏置"
- 需要从特征层面改进，而非后处理校准

**做完能不能停**：
- ✅ 如果 Bin3 或 Bin6 ΔR² ≥ +0.02 → 继续深挖该方向
- ❌ 如果 ΔR² < 0.01 → 立刻止损，转 MVP-15 (LGBM expert)

## 1.2 预期结果

| 指标 | 预期值 | 最低可接受 |
|------|--------|----------|
| Bin3 ΔR² | ≥ +0.02 | ≥ +0.01 |
| Bin6 ΔR² | ≥ +0.02 | ≥ +0.01 |
| 其他 bins | 不下降 | 允许 -0.005 |

---

# 2. 🧪 实验设计

## 2.1 数据配置

| 配置项 | 值 | 说明 |
|--------|-----|------|
| **目标 bins** | Bin3 (Cool Metal-poor), Bin6 (Hot Metal-poor) | Metal-poor 困难区域 |
| **训练数据** | 全量 | - |
| **噪声水平** | 0.2 | 与主线一致 |

## 2.2 方法：选线 + 特征工程

### Step 1: 用 Ridge 系数/残差做"选线"

```
对每个困难 bin (Bin3, Bin6):
├── 分析 ridge expert 的系数分布
├── 找 |系数| 大的波段 → 对 log g 敏感
├── 分析预测残差的波段相关性
└── 找残差与光谱高相关的窗 → 信息未被利用
```

### Step 2: 候选物理窗口

| 窗口类型 | 候选 | 说明 |
|---------|------|------|
| **Ca II 以外的金属线** | Na, Mg, Fe | 可能在 Metal-poor 区域更重要 |
| **H 线** | Hα (6563Å), Hβ (4861Å) | 帮助区分 Teff，在 Metal-poor 中可能更显著 |
| **弱金属线** | Fe II, Ti II | 在 Metal-poor 区域可能更敏感 |

### Step 3: 特征提取

| 特征类型 | 提取方法 | 说明 |
|---------|---------|------|
| **depth** | $1 - \min(f/\hat{c})$ | 线深 |
| **EW** | $\sum_{core}(1 - f/\hat{c})$ | 等效宽度 |
| **shape** | PCA 前 2 维 | 线形状 |

### Step 4: Ablation

**关键**：每次只加一类窗口（比如新增 1 组线），做 ablation，避免"堆一堆不知道谁有用"

```
实验顺序:
1. Baseline: 当前 11 维 gate features
2. + H 线窗口 (Hα)
3. + 弱金属线窗口
4. + 其他金属线 (Na, Mg)
```

## 2.3 超参数配置

| 参数 | 值 | 说明 |
|------|-----|------|
| 专家模型 | Ridge | 保持一致 |
| 新特征数 | 每次 +3~5 维 | 逐步增加 |

## 2.4 评价指标

| 指标 | 公式 | 说明 |
|------|------|------|
| **Bin3 R²** | per-bin | Metal-poor Cool |
| **Bin6 R²** | per-bin | Metal-poor Hot |
| **ΔR²** | 新 - 旧 | 改善幅度 |
| **Ablation Δ** | 每组特征贡献 | 归因 |

---

# 3. 📊 实验图表

> ⏳ 实验进行中，待填充

---

# 4. 💡 关键洞见

> ⏳ 实验进行中，待填充

---

# 5. 📝 结论

> ⏳ 实验进行中，待填充

---

# 6. 📎 附录

## 6.1 数值结果表

> ⏳ 实验进行中，待填充

## 6.2 实验流程记录

### 执行命令

```bash
# TBD
```

### 关键日志

> ⏳ 实验进行中，待填充

## 6.3 相关文件

| 文件类型 | 路径 | 说明 |
|---------|------|------|
| 训练脚本 | `~/VIT/scripts/moe_feature_mining.py` | TBD |
| 结果目录 | `~/VIT/results/moe/feature_mining/` | TBD |
| 图表目录 | `logg/moe/img/` | TBD |

---

*实验 ID: VIT-20251205-moe-feature-mining-01*

