# ğŸ—ºï¸ logg SNR-MoE Roadmap

> **Name:** logg SNR-conditioned MoE | **ID:** `VIT-20251226-logg-snr-moe-roadmap`
> **Topic:** `logg_snr_moe` | **Phase:** 1 | **Project:** `VIT`
> **Author:** Viska Wei | **Date:** 2025-12-26 | **Status:** ğŸ”„

```
ğŸ’¡ å½“å‰é˜¶æ®µç›®æ ‡  
Gateï¼šåœ¨ä¸å¼•å…¥ error-vector ä¿¡æ¯æ³„éœ²çš„å‰æä¸‹ï¼Œç”¨ SNR/è§‚æµ‹è´¨é‡åšå¯è½åœ° MoE/conditionalï¼ŒéªŒè¯æ˜¯å¦èƒ½ç¨³å®šè¶…è¿‡å½“å‰å•æ¨¡å‹ï¼ˆViT 0.71ï¼‰å¹¶é€¼è¿‘ Fisher headroomã€‚
```

---

## ğŸ”— Related Files

| Type                 | File                                         |
| -------------------- | -------------------------------------------- |
| ğŸ§  Hub               | `logg_snr_moe_hub_20251226.md`               |
| ğŸ§  Hub Template      | `hub.md`                                     |
| ğŸ—ºï¸ Roadmap Template | `roadmap.md`                                 |
| ğŸ§  MoE Hub (å‚è€ƒ)      | `moe_hub_20251203.md`                        |
| ğŸ—ºï¸ MoE Roadmap (å‚è€ƒ) | `moe_roadmap_20251203.md`                    |
| ğŸ“˜ Fisher Ceiling    | `exp_scaling_fisher_ceiling_v2_20251224.md`  |
| ğŸ“˜ Fisher Multi-mag  | `exp_scaling_fisher_multi_mag_20251224.md`   |

---

# 1. ğŸš¦ Decision Gates

## 1.1 æˆ˜ç•¥è·¯çº¿ (æ¥è‡ªHub)

| Route | åç§°                                | Hubæ¨è | éªŒè¯Gate          |
| ----- | --------------------------------- | ----- | --------------- |
| A     | error å…¨å‘é‡è¿›æ¨¡å‹                      | ğŸ”´    | Gate-1          |
| B     | whitening/conditional å•æ¨¡å‹         | ğŸŸ¡    | Gate-2 / Gate-4 |
| **M** | **quality-parameter SNR-MoEï¼ˆæ¨èï¼‰** | ğŸŸ¢    | **Gate-1/2/3**  |

## 1.2 Gateå®šä¹‰

### Gate-1: Leakage Audit & Error è¡¨ç¤ºå†»ç»“ âœ… PASS

| é¡¹   | å†…å®¹                                             |
| --- | ---------------------------------------------- |
| éªŒè¯  | error ç‰¹å¾æ˜¯å¦æºå¸¦ logg æ³„éœ²ï¼›æ˜¯å¦èƒ½æ„é€ "åªè¡¨è¾¾è§‚æµ‹è´¨é‡"çš„ error è¡¨ç¤º  |
| MVP | MVP-0.1, MVP-0.2                               |
| è‹¥A  | error-only RÂ² < 0.05ï¼ˆæˆ–æ¥è¿‘ 0ï¼‰â†’ é€šè¿‡ï¼Œè¿›å…¥ Gate-2      |
| è‹¥B  | error-only RÂ² â‰¥ 0.05 â†’ ç»§ç»­å‹ç¼©/å»å¯¹é½ï¼ˆç¦ç”¨æ³¢é•¿å¯¹é½ä¿¡æ¯ï¼‰ï¼Œç›´åˆ°é€šè¿‡ |
| çŠ¶æ€  | âœ… **PASS: S3b_aggregate_stats logg RÂ² = 0.042 < 0.05** |
| ç»“æœ  | 10ä¸ªèšåˆç»Ÿè®¡é‡æˆåŠŸå»æ³„éœ²ï¼Œä¸” SNR RÂ² = 0.995 å®Œç¾ä¿ç•™è´¨é‡ä¿¡æ¯ |

**å»æ³„éœ²ç­–ç•¥éªŒè¯ç»“æœ**

| ç­–ç•¥ | logg RÂ² | SNR RÂ² | çŠ¶æ€ |
|------|---------|--------|------|
| S1 åŒå£å¾„å½’ä¸€åŒ– | 0.788 | 0.974 | âŒ æ— æ•ˆ |
| S2 templateÃ—scale | -0.001 | 0.808 | âœ… å»æ³„éœ²ä½†SNRç•¥ä½ |
| **S3b aggregate_stats** | **0.042** | **0.995** | âœ… **æœ€ä½³** |
| S4 ||error|| only | 0.000 | 0.805 | âœ… å¤‡é€‰ |

**å†»ç»“å®ç°**: `quality_features()` = 10ä¸ªèšåˆç»Ÿè®¡é‡ (mean/std/min/max/median/sum/q25/q75/skew/kurtosis)

---

### Gate-2: Oracle SNR Split Headroom âœ… PASS

| é¡¹   | å†…å®¹                                                    |
| --- | ----------------------------------------------------- |
| éªŒè¯  | "æŒ‰ SNR åˆ†ä¸“å®¶"æ˜¯å¦çœŸçš„æœ‰ headroomï¼ˆoracle è·¯ç”±ï¼‰                  |
| MVP | MVP-1.0                                               |
| è‹¥A  | Oracle SNR-MoE Î”RÂ² â‰¥ 0.02ï¼ˆç›¸å¯¹å•æ¨¡å‹/å…¨å±€ï¼‰â†’ å€¼å¾—åšå¯è½åœ° gate      |
| è‹¥B  | Î”RÂ² < 0.02 â†’ MoE ä¸å¦‚åš whitening/conditionalï¼ˆè·³åˆ° Gate-4ï¼‰ |
| çŠ¶æ€  | âœ… **PASS: Î”RÂ² = +0.05 â‰¥ 0.02**                        |
| ç»“æœ  | Global RÂ²=0.4629, Oracle RÂ²=0.5129, Bin M æå‡æœ€å¤§ +9.6%  |

**SNR bins å»ºè®®ï¼ˆæ¥è‡ª Fisher multi-magï¼‰**ï¼š

* Bin-H: SNR > 7ï¼ˆä¿¡æ¯å¯Œï¼‰
* Bin-M: 4 < SNR â‰¤ 7ï¼ˆä¸´ç•Œï¼‰
* Bin-L: 2 < SNR â‰¤ 4ï¼ˆå›°éš¾ï¼‰
* Bin-X: SNR â‰¤ 2ï¼ˆä¿¡æ¯æ‚¬å´–ï¼šå»ºè®®è¾“å‡ºä¸ç¡®å®šåº¦/å…ˆéªŒä¸»å¯¼ï¼‰ 

---

### Gate-3: Deployable Gate Ï âœ… PASS

| é¡¹   | å†…å®¹                                                          |
| --- | ----------------------------------------------------------- |
| éªŒè¯  | ç”¨"å»æ³„éœ²åçš„ quality features"åš soft routingï¼Œèƒ½ä¿ä½ oracle å¢ç›Šå¤šå°‘     |
| MVP | MVP-2.0, MVP-2.1                                            |
| è‹¥A  | Ï â‰¥ 0.7ï¼ˆæˆ–å¯è½åœ° RÂ² æ¥è¿‘ oracleï¼‰â†’ Route M å¯äº¤ä»˜                     |
| è‹¥B  | Ï < 0.7 â†’ æ”¹ gateï¼ˆå±‚çº§ gate / å›å½’ gate / fallbackï¼‰ï¼Œä»ä¸è¡Œåˆ™è½¬ Gate-4 |
| çŠ¶æ€  | âœ… **PASS: Ï = 1.04 â‰¥ 0.7ï¼ŒDeployed RÂ² = 0.544 è¶…è¶Š Oracle RÂ² = 0.543** |
| ç»“æœ  | Route M å¯äº¤ä»˜ï¼Soft routing ä¼˜äº hard routingï¼ŒGate å‡†ç¡®ç‡ 99.6% |

Ï å®šä¹‰ï¼ˆæ²¿ç”¨ MoE Hubï¼‰ï¼š
[
\rho=\frac{R^2_{deploy}-R^2_{global}}{R^2_{oracle}-R^2_{global}}
]
å‚è€ƒ MoE ä½“ç³»çš„é—¨æ§›ï¼šæœ€ä½å¯ç”¨ 0.5ï¼Œå¾ˆæœ‰æˆ 0.7ã€‚ 

---

### Gate-4: Whitening/Conditional Baseline å¯¹ç…§

| é¡¹   | å†…å®¹                                                         |
| --- | ---------------------------------------------------------- |
| éªŒè¯  | ä¸åš MoEï¼Œä»…ç”¨ error åš whitening/åŠ æƒ/conditional æ˜¯å¦å°±è¶³å¤Ÿ           |
| MVP | MVP-3.0                                                    |
| è‹¥A  | Whitening/Conditional â‰¥ Deployable MoEï¼ˆå·® <0.01ï¼‰â†’ å·¥ç¨‹ä¸Šé€‰æ›´ç®€å•è·¯çº¿ |
| è‹¥B  | Deployable MoE æ˜æ˜¾æ›´å¼º â†’ å›ºåŒ– Route M                           |
| çŠ¶æ€  | â³                                                          |

---

### Gate-5: åŒå¡”èåˆ (Phys + Quality Gate) âš ï¸ MARGINAL

| é¡¹   | å†…å®¹                                                         |
| --- | ---------------------------------------------------------- |
| éªŒè¯  | ç‰©ç† 9-gate å’Œ SNR/quality gate åŒå¡”èåˆèƒ½å¦å åŠ å¢ç›Š                    |
| MVP | MVP-4.0 âš ï¸ å®Œæˆï¼ŒMVP-4.1/4.2 å·²å…³é—­                              |
| è‹¥A  | Î”RÂ² â‰¥ +0.005ï¼ˆç›¸å¯¹å•å¡”æœ€ä¼˜ï¼‰â†’ åŒå¡”æ˜¯æœ€ç»ˆæ¶æ„                              |
| è‹¥B  | Î”RÂ² < +0.005 â†’ é€‰æ‹©æ›´ç®€å•çš„å•å¡”æ–¹æ¡ˆï¼ˆPhys-MoEï¼‰                        |
| çŠ¶æ€  | âš ï¸ **MARGINAL** - Î”RÂ²=+0.0017 < +0.005ï¼Œ**Fallback to Phys-only** |

**ç»“è®º**ï¼š
- åŒå¡” RÂ²=0.603 vs Phys-only RÂ²=0.601ï¼Œå¢ç›Šä»… +0.0017
- æä½ SNR (X bin â‰¤2) æœ‰æ•ˆ +0.011ï¼Œä½†è¢«å…¶ä»– bin æŠµæ¶ˆ
- **æ¨èï¼šFallback to Phys-only Gateï¼Œä¸å¢åŠ å¤æ‚åº¦**

---

## 1.3 æœ¬å‘¨é‡ç‚¹

| ä¼˜å…ˆçº§   | MVP               | Gate   | çŠ¶æ€ |
| ----- | ----------------- | ------ | -- |
| âœ…    | MVP-0.1           | Gate-1 | âœ… âŒ FAIL (RÂ²=0.788) â†’ éœ€è¦å»æ³„éœ² |
| âœ…    | MVP-0.2           | Gate-1 | âœ… PASS (S3b: logg RÂ²=0.042, SNR RÂ²=0.995) |
| âœ…    | MVP-1.0           | Gate-2 | âœ… PASS (Î”RÂ²=+0.05) |
| âœ…    | **MVP-2.0**       | Gate-3 | âœ… **PASS (Ï=1.04, Deployed > Oracle!)** |
| â³    | MVP-3.0 (å¯¹ç…§)     | Gate-4 | å¯é€‰ï¼šRoute M å·²æˆåŠŸï¼Œå¯è·³è¿‡ |
| âš ï¸ âœ… | **MVP-4.0**       | Gate-5 | âš ï¸ MARGINAL: Î”RÂ²=+0.0017 < +0.005ï¼ŒFallback |
| ğŸ—‘ï¸ | MVP-4.1           | Gate-5 | å·²å…³é—­ï¼ˆMVP-4.0 æœªè¾¾é˜ˆå€¼ï¼‰ |
| ğŸ—‘ï¸ | MVP-4.2           | Gate-5 | å·²å…³é—­ï¼ˆMVP-4.0 æœªè¾¾é˜ˆå€¼ï¼‰ |

---

# 2. ğŸ“‹ MVPåˆ—è¡¨

## 2.1 æ€»è§ˆ

| MVP | åç§°                                                        | Phase | Gate   | çŠ¶æ€ | exp_id                | æŠ¥å‘Š |
| --- | --------------------------------------------------------- | ----- | ------ | -- | --------------------- | -- |
| 0.1 | error-only æ³„éœ²åŸºçº¿                                           | 0     | Gate-1 | âœ…  | `LOGG-ERR-BASE-01`    | `exp/exp_logg_err_base_01_20251226.md`  |
| 0.2 | error è¡¨ç¤ºå»æ³„éœ²ï¼ˆtemplateÃ—scale/quantilesï¼‰                     | 0     | Gate-1 | âœ…  | `LOGG-ERR-REPR-01`    | `exp/exp_logg_err_repr_01_20251226.md`  |
| 1.0 | Oracle SNR-binned Expertsï¼ˆçœŸ SNR è·¯ç”±ï¼‰                       | 1     | Gate-2 | âœ…  | `LOGG-SNR-ORACLE-01`  | `exp/exp_logg_snr_oracle_01_20251226.md`  |
| 2.0 | Deployable Gateï¼ˆquality features â†’ SNR binï¼‰+ Soft routing | 2     | Gate-3 | âœ…  | `LOGG-SNR-GATE-01`    | `exp/exp_logg_snr_gate_01_20251226.md`  |
| 2.1 | å›å½’æœ€ä¼˜ gateï¼ˆç›´æ¥å­¦æƒé‡ï¼‰                                          | 2     | Gate-3 | ğŸ—‘ï¸  | `LOGG-SNR-REGGATE-01` | ä¸éœ€è¦ï¼šMVP-2.0 Ï=1.04 å·²è¶…è¶Š Oracle  |
| 3.0 | Whitening/Conditional å¯¹ç…§                                  | 3     | Gate-4 | â³  | `LOGG-WHITEN-01`      | -  |
| **4.0** | **åŒå¡”æœ€å°æ”¹åŠ¨ï¼š9 experts + gate concat [phys,qual]** | 4     | Gate-5 | âš ï¸ âœ… | `LOGG-DUAL-TOWER-01`  | `exp/exp_moe_dual_tower_20251228.md` |
| 4.1 | å› å­åˆ†è§£ï¼šlogit-add / prob-prod                             | 4     | Gate-5 | ğŸ—‘ï¸  | - | å·²å…³é—­ |
| 4.2 | æ¸©åº¦æ§åˆ¶ï¼šquality â†’ Ï„                                        | 4     | Gate-5 | ğŸ—‘ï¸  | - | å·²å…³é—­ |

**çŠ¶æ€**: â³è®¡åˆ’ | ğŸ”´å°±ç»ª | ğŸš€è¿è¡Œ | âœ…å®Œæˆ | âŒå–æ¶ˆ

---

# 3. ğŸ”§ MVPè§„æ ¼

## Phase 0: Leakage Audit

### MVP-0.1: error-only æ³„éœ²åŸºçº¿

| é¡¹  | é…ç½®                                                       |
| -- | -------------------------------------------------------- |
| ç›®æ ‡ | é‡åŒ– error vector çš„â€œæ³„éœ²ç¨‹åº¦â€                                  |
| æ•°æ® | å›ºå®š train/val/testï¼›åªè¾“å…¥ errorï¼ˆä¸è¾“å…¥ fluxï¼‰                    |
| æ¨¡å‹ | Linear/Ridge/LightGBMï¼ˆå¿«é€Ÿï¼‰                                |
| éªŒæ”¶ | è®°å½• error-only çš„ RÂ²ï¼›**ç›®æ ‡æ˜¯æ¥è¿‘ 0**ï¼ˆè‹¥å¾ˆé«˜åˆ™æ³„éœ²ä¸¥é‡ï¼‰                 |
| äº§ç‰© | (1) RÂ²ï¼›(2) feature importance / å“ªäº›åƒç´ è´¡çŒ®æœ€å¤§ï¼ˆå®šä½é‚£ 40 ä¸ªä½ç½®æ˜¯å¦å…³é”®ï¼‰ |

### MVP-0.2: error è¡¨ç¤ºå»æ³„éœ²

| é¡¹  | é…ç½®                                                         |
| -- | ---------------------------------------------------------- |
| ç›®æ ‡ | æ„é€ â€œåªè¡¨è¾¾è§‚æµ‹è´¨é‡â€çš„ error è¡¨ç¤ºï¼Œå¹¶è®© error-only RÂ² ä¸‹é™åˆ° <0.05           |
| æ–¹æ³• | ä¾æ¬¡è¯•ï¼šS1 åŒå£å¾„å½’ä¸€åŒ– â†’ S2 templateÃ—scale â†’ S3 æ— å¯¹é½ç»Ÿè®¡ â†’ S4 æ®‹å·®ä»…åšå¼‚å¸¸æ£€æµ‹ |
| éªŒæ”¶ | error-only RÂ² < 0.05ï¼›åŒæ—¶è¿™äº›ç‰¹å¾èƒ½ç¨³å®šé¢„æµ‹ SNRï¼ˆç”¨äº gateï¼‰              |
| è¾“å‡º | æœ€ç»ˆå†»ç»“ `quality_features()` çš„å®ç°                              |

---

## Phase 1: Oracle Headroom

### MVP-1.0: Oracle SNR-binned Expertsï¼ˆçœŸ SNR è·¯ç”±ï¼‰

| é¡¹  | é…ç½®                                               |
| -- | ------------------------------------------------ |
| ç›®æ ‡ | æµ‹â€œæŒ‰ SNR åˆ†ä¸“å®¶â€åœ¨ç†è®ºä¸Šèƒ½å¸¦æ¥å¤šå°‘æå‡ï¼ˆä¸å— gate è¯¯å·®å½±å“ï¼‰            |
| æ•°æ® | æŒ‰ SNR bins åˆ’åˆ†è®­ç»ƒå­é›†ï¼›æ¯ä¸ª bin è®­ç»ƒä¸€ä¸ª expertï¼ˆåŒæ¶æ„ä¸åŒæƒé‡/æ­£åˆ™ï¼‰ |
| è·¯ç”± | test ç”¨çœŸå® SNR bin è·¯ç”±ï¼ˆoracleï¼‰                      |
| å¯¹ç…§ | Global å•æ¨¡å‹ï¼ˆåŒæ¶æ„ï¼‰                                  |
| éªŒæ”¶ | Oracle Î”RÂ² â‰¥ 0.02ï¼›å¹¶è¾“å‡º per-bin RÂ²ï¼ˆçœ‹æ”¶ç›Šæ¥è‡ªå“ªé‡Œï¼‰        |
| å¤‡æ³¨ | SNR bins å»ºè®®ä½¿ç”¨ Fisher multi-mag çš„ä¸´ç•Œé˜ˆå€¼ï¼ˆ4,2ï¼‰        |

---

## Phase 2: Deployable Gate

### MVP-2.0: qualityâ†’SNR bin gate + soft routing

| é¡¹      | é…ç½®                                                             |
| ------ | -------------------------------------------------------------- |
| ç›®æ ‡     | ç”¨å»æ³„éœ²åçš„ quality features åš gateï¼Œè¯„ä¼°å¯è½åœ°æ•ˆæœ                         |
| Gate   | LogReg/MLPï¼ˆå°æ¨¡å‹ï¼‰é¢„æµ‹ SNR binï¼›è¾“å‡º softmax æƒé‡                        |
| MoE è¾“å‡º | (\hat y = \sum_k p_k \hat y_k)ï¼Œå¹¶åŠ  fallbackï¼ˆmax(p)<Ï„ åˆ™ç”¨ globalï¼‰ |
| éªŒæ”¶     | Ïâ‰¥0.7 æˆ– RÂ² æ¥è¿‘ oracleï¼›å¹¶æŠ¥å‘Š gate æ··æ·†çŸ©é˜µï¼ˆè¾¹ç•Œè¯¯åˆ†ï¼‰                       |

### MVP-2.1: å›å½’æœ€ä¼˜ gateï¼ˆç›´æ¥å­¦æƒé‡ï¼‰

| é¡¹  | é…ç½®                                                            |
| -- | ------------------------------------------------------------- |
| ç›®æ ‡ | ä¸åšåˆ†ç±» gateï¼Œç›´æ¥æœ€å°åŒ– logg MSE å­¦ soft weightsï¼ˆå‚è€ƒ MoE å›å½’ gate æˆåŠŸç»éªŒï¼‰  |
| è¾“å…¥ | åŒæ ·çš„ quality features                                          |
| éªŒæ”¶ | ç›¸å¯¹ MVP-2.0 æœ‰ç¨³å®šå¢ç›Šï¼ˆâ‰¥+0.005 RÂ² æˆ–æå‡ä½ SNR å­é›†ï¼‰                      |

---

## Phase 3: å¯¹ç…§ç»„

### MVP-3.0: Whitening/Conditional

| é¡¹  | é…ç½®                                                            |
| -- | ------------------------------------------------------------- |
| ç›®æ ‡ | éªŒè¯â€œä¸åš MoEâ€æ˜¯å¦ä¹Ÿèƒ½åƒåˆ°ä¸»è¦å¢ç›Š                                          |
| æ–¹æ³• | (A) è¾“å…¥æ”¹ä¸º flux/errorï¼ˆwhiteningï¼‰ï¼›(B) conditionalï¼šæŠŠ SNR æ ‡é‡ä½œä¸ºæ¡ä»¶è¾“å…¥ |
| éªŒæ”¶ | ä¸ Deployable MoE å¯¹ç…§ï¼›è‹¥å·®è· <0.01 åˆ™ä¼˜å…ˆæ›´ç®€å•è·¯çº¿                        |

---

## Phase 4: ğŸ†• åŒå¡”èåˆ

### MVP-4.0: åŒå¡”æœ€å°æ”¹åŠ¨ï¼ˆæ¨èå…ˆåšï¼‰

| é¡¹  | é…ç½®                                                            |
| -- | ------------------------------------------------------------- |
| ç›®æ ‡ | éªŒè¯ phys + qual è”åˆ gate èƒ½å¦è¶…è¿‡å•å¡”                                 |
| Experts | 9Ã— Ridgeï¼ˆæŒ‰ TeffÃ—[M/H] åˆ†è®­ç»ƒï¼Œ**æ²¿ç”¨å·²æœ‰ï¼Œä¸å˜**ï¼‰                     |
| Gate è¾“å…¥ | `[phys_features, quality_features]`ï¼ˆ~20 ç»´ï¼‰                  |
| Gate æ¶æ„ | MLP [32, 16] â†’ 9 logitsï¼ŒSoft routing                        |
| è®­ç»ƒ | **å›å½’æœ€ä¼˜ï¼ˆMSE on final loggï¼‰**ï¼Œä¸æ˜¯åˆ†ç±» CE                          |
| éªŒæ”¶ | Î”RÂ² â‰¥ +0.005 (vs å•å¡”) â†’ ç»§ç»­ï¼›Î”RÂ² < 0 â†’ fallback å•å¡”            |
| åˆ‡ç‰‡ | å¿…é¡»æŒ‰ SNR bins (>7/4-7/2-4/â‰¤2) åˆ†æï¼Œçœ‹ä½ SNR æ˜¯å¦æ”¹å–„                  |

### MVP-4.1: å› å­åˆ†è§£ gate

| é¡¹  | é…ç½®                                                            |
| -- | ------------------------------------------------------------- |
| ç›®æ ‡ | ä¿ç•™åŒ gate å„è‡ªå¯è§£é‡Šæ€§                                              |
| æ–¹æ³• A | **Logit ç›¸åŠ **: $w = \mathrm{softmax}(a + b)$                  |
| æ–¹æ³• B | **æ¦‚ç‡ä¹˜ç§¯**: $w \propto p \odot q$ï¼ˆProduct-of-Expertsï¼‰          |
| éªŒæ”¶ | å¯¹æ¯” MVP-4.0ï¼Œè‹¥å¯è§£é‡Šæ€§æ›´å¥½ä¸”æ€§èƒ½ä¸é™ â†’ é‡‡ç”¨                               |

### MVP-4.2: æ¸©åº¦æ§åˆ¶

| é¡¹  | é…ç½®                                                            |
| -- | ------------------------------------------------------------- |
| ç›®æ ‡ | è®© quality tower æ§åˆ¶ gate çš„"ç½®ä¿¡åº¦/sharpness"                     |
| æ–¹æ³• | quality tower è¾“å‡ºæ¸©åº¦ Ï„(q) â‰¥ 1                                   |
| å…¬å¼ | w = softmax(logits_phys / Ï„(q))                               |
| ç‰©ç†ç›´è§‰ | SNR ä½ â†’ Ï„ å¤§ â†’ æ›´ ensembleï¼›SNR é«˜ â†’ Ï„ å° â†’ æ›´ routing          |
| éªŒæ”¶ | ä½ SNR å­é›† RÂ² æ”¹å–„ â‰¥ +0.01                                       |

---

# 4. ğŸ“Š è¿›åº¦è¿½è¸ª

## 4.1 çœ‹æ¿

```
â³è®¡åˆ’          ğŸ”´å°±ç»ª    ğŸš€è¿è¡Œ    âœ…å®Œæˆ
                                        MVP-0.1 âœ… (RÂ²=0.788, ä¸¥é‡æ³„éœ²)
                                        MVP-0.2 âœ… (S3b: logg RÂ²=0.042, SNR RÂ²=0.995)
                                        MVP-1.0 âœ… (Î”RÂ²=+0.05)
                                        MVP-2.0 âœ… (Ï=1.04, Deployed > Oracle!)
MVP-2.1 ğŸ—‘ï¸ (ä¸éœ€è¦)
MVP-3.0 â³ (å¯é€‰)
â”€â”€â”€â”€ Phase 4: åŒå¡”èåˆ â”€â”€â”€â”€
                                        MVP-4.0 âš ï¸ âœ… (Î”RÂ²=+0.0017 MARGINAL)
MVP-4.1 ğŸ—‘ï¸ (å·²å…³é—­)
MVP-4.2 ğŸ—‘ï¸ (å·²å…³é—­)
```

---

## 4.2 æ ¸å¿ƒç»“è®ºå¿«ç…§

| MVP | ç»“è®º | å…³é”®æ•°å­— |
|-----|------|---------|
| **0.1** | âŒ error ä¸¥é‡æ³„éœ² logg | RÂ²=0.788, Shuffle åå´©æºƒ, å¿…é¡»å»æ³„éœ² |
| **0.2** | âœ… S3b_aggregate_stats å®Œç¾å»æ³„éœ² | logg RÂ²=0.042 < 0.05, SNR RÂ²=0.995 > 0.5 |
| **1.0** | âœ… SNR åˆ†åŸŸæœ‰æ˜¾è‘— headroom | Î”RÂ²=+0.05, Bin M æœ€å¤§ +9.6% |
| **2.0** | âœ… **Deployed è¶…è¶Š Oracle!** | **Ï=1.04 > 1.0, RÂ²=0.544 > Oracle 0.543** |
| **4.0** | âš ï¸ **åŒå¡”å¢ç›Šå¾®å¼±** | **Î”RÂ²=+0.0017 < +0.005, X-bin +0.011** |

### ğŸ† Route M æˆåŠŸï¼å®Œæ•´ Pipeline

```
error (4096-dim)
    â”‚
    â–¼
quality_features() â”€â”€â†’ 10-dim aggregate stats
    â”‚                   (mean, std, min, max, median, 
    â”‚                    sum, q25, q75, skew, kurtosis)
    â–¼
LogReg Gate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ SNR bin probabilities (4-dim)
    â”‚                   (Accuracy: 99.6%)
    â–¼
Soft Routing â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Î£ p_k Ã— expert_k(flux)
    â”‚
    â–¼
logg prediction â”€â”€â”€â”€â”€â”€â†’ RÂ² = 0.544 (vs Global 0.509)
```

### å†»ç»“çš„ quality_features() å®ç°

```python
def quality_features(error: np.ndarray) -> np.ndarray:
    """10 aggregate statistics - de-leaked, SNR-preserving."""
    from scipy import stats
    return np.column_stack([
        np.mean(error, axis=-1),      # 0: mean
        np.std(error, axis=-1),       # 1: std
        np.min(error, axis=-1),       # 2: min
        np.max(error, axis=-1),       # 3: max
        np.median(error, axis=-1),    # 4: median
        np.sum(error, axis=-1),       # 5: sum
        np.percentile(error, 25, axis=-1),  # 6: q25
        np.percentile(error, 75, axis=-1),  # 7: q75
        stats.skew(error, axis=-1),   # 8: skew
        stats.kurtosis(error, axis=-1),     # 9: kurtosis
    ])
```

---

# 5. ğŸ”— è·¨ä»“åº“é›†æˆï¼ˆå¯é€‰ï¼‰

| MVP     | è„šæœ¬                                    | é…ç½®                      | è¾“å‡º                      |
| ------- | ------------------------------------- | ----------------------- | ----------------------- |
| 0.1/0.2 | `scripts/logg_error_leakage_audit.py` | `cfg/logg_snr_moe.yaml` | `results/logg_snr_moe/` |

---

# 6. ğŸ“ é™„å½•ï¼šå¿«é€Ÿ sanity checksï¼ˆå¼ºçƒˆå»ºè®®ä¸€èµ·åšï¼‰

* **Shuffle Test**ï¼šåœ¨åŒä¸€ magnitude/SNR ç»„å†…éšæœºæ‰“ä¹± error å‘é‡ï¼›å¦‚æœæ€§èƒ½å‡ ä¹ä¸å˜ â†’ è¯´æ˜æ¨¡å‹åªç”¨åˆ°äº†â€œæ•´ä½“å°ºåº¦â€ï¼›å¦‚æœå¤§å¹…ä¸‹é™ â†’ è¯´æ˜ç”¨äº†â€œæ³¢é•¿å¯¹é½ç»†èŠ‚â€ï¼ˆé«˜æ³„éœ²é£é™©ï¼‰ã€‚
* **Mask-only Test**ï¼šåªç”¨ mask/ååƒç´ ä½ç½®åšå›å½’ï¼Œæ£€éªŒé‚£ 40/4096 æ˜¯å¦æœ¬è´¨æ˜¯ mask ä¿¡æ¯ã€‚
* **Group-CV**ï¼šæŒ‰ mag æˆ– SNR åˆ†ç»„åš cross-valï¼Œé¿å…æ¨¡å‹åˆ©ç”¨ç‰¹å®šè§‚æµ‹é…ç½®è®°å¿†åŒ–ã€‚

---

## ä½ å¯ä»¥ç«‹åˆ»ç…§ç€åšçš„â€œæœ€çŸ­é—­ç¯â€ï¼ˆä¸çº ç»“ã€æœ€å¿«çŸ¥é“å€¼ä¸å€¼ï¼‰

1. **MVP-0.1**ï¼šerror-only â†’ å¤ç° RÂ²=0.91ï¼Œå¹¶ç”¨ feature importance å®šä½æ˜¯ä¸æ˜¯é‚£ 40 ä¸ªåƒç´ åœ¨â€œé€åˆ†â€ã€‚
2. **MVP-0.2**ï¼šåªä¿ç•™ `scale s`ï¼ˆæ¯”å¦‚ median(error) æˆ– ä¸æ¨¡æ¿çš„æœ€å°äºŒä¹˜ scaleï¼‰ï¼Œå†è·‘ error-onlyï¼›å¦‚æœ RÂ² æ‰åˆ°æ¥è¿‘ 0ï¼Œå°±è¯´æ˜â€œæ³„éœ²ä¸»è¦æ¥è‡ªæ³¢é•¿å¯¹é½ç»†èŠ‚â€ï¼ŒRoute M å¯è¡Œã€‚
3. **MVP-1.0**ï¼šæŒ‰ SNR>7 / 4â€“7 / 2â€“4 / <2 åš oracle åˆ†ä¸“å®¶ï¼Œçœ‹çœ‹ headroom æ¥è‡ªå“ªé‡Œã€‚
4. **MVP-2.0**ï¼šç”¨ `s + å°‘é‡ç²—ç»Ÿè®¡` åš gateï¼Œsoft routingï¼Œç®— Ïï¼Œå†³å®šæ˜¯å¦è¿›å…¥å·¥ç¨‹åŒ–ã€‚
