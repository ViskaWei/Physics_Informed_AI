# ğŸ“˜ Ridge Alpha Sweep & Y-Scaling @ 1k Test (2025-12-24)
> **Name:** Ridge 1k Test Validation | **ID:** `SCALING-20251224-ridge-1ktest-01`  
> **Topic:** `scaling` | **MVP:** MVP-1.0 | **Project:** `VIT`  
> **Author:** Viska Wei | **Date:** 2025-12-24 | **Status:** âœ… Done

---

## âš¡ TL;DR

### Verdict
> Ridge RÂ² = **0.4551** @ 1k test æˆä¸º canonical baselineï¼Œå–ä»£æ—§çš„ 500 test åè®®ã€‚

### Key Numbers
| Metric | Value | Notes |
|--------|-------|-------|
| **Best Ridge RÂ² (1k test)** | 0.4551 | Canonical |
| **Best Î±** | 100,000 | 1M æ•°æ®æœ€ä¼˜ |
| **Y-Scaling Effect** | æ— å½±å“ | RÂ² ä¸å˜ |

### Hypothesis Validation
| Hypothesis | Threshold | Actual | Result |
|------------|-----------|--------|--------|
| Test size å½±å“ | 500 vs 1k | Î”RÂ² = -0.047 | âœ… æ›´å‡†ç¡®ä¼°è®¡ |

---

## ğŸ“ Scope Card

| Field | Value |
|-------|-------|
| **Dataset** | BOSZ 50000, mag205_225_lowT_1M |
| **Train Size** | 1,000,000 (5 shards Ã— 200k) |
| **Test Size** | **1,000** (full test_1k_0) |
| **Test Protocol** | **pre-noised** |
| **Noise Level** | Ïƒ=1.0 |
| **Features** | 4096 (MR arm) |
| **Target** | log_g âˆˆ [1.0, 5.0] |
| **X Scaling** | StandardScaler |
| **Y Scaling** | None (validated no effect) |

---

## âœ… Sanity Checks

| Check | Expected | Actual | Pass |
|-------|----------|--------|------|
| RÂ² èŒƒå›´åˆç† | [0, 1] | 0.4551 | âœ… |
| Î±=100k ä¸ oracle-moe ä¸€è‡´ | Same Î± | Same Î± | âœ… |
| è¿‡æ­£åˆ™åŒ–æ‹ç‚¹å­˜åœ¨ | Î± > 500k ä¸‹é™ | âœ… 0.4360 @ Î±=1M | âœ… |

---
```
ğŸ’¡ å®éªŒç›®çš„  
å†³å®šï¼šå½±å“çš„å†³ç­–
```

---


## ğŸ”— Upstream Links
| Type | Link |
|------|------|
| ğŸ§  Hub | `logg//_hub.md` |
| ğŸ—ºï¸ Roadmap | `logg//_roadmap.md` |

---

## ğŸ¯ æ ¸å¿ƒç»“è®ºé€Ÿè§ˆ

| Metric | Value | å¤‡æ³¨ |
|--------|-------|------|
| **Best Alpha** | 100,000 | 1M æ•°æ®æœ€ä¼˜ |
| **Best RÂ² (1k test)** | **0.4551** | æ ‡å‡†åŸºå‡† |
| Y-Scaling Effect | æ— å½±å“ | RÂ² ä¸å˜ |
| Train Size | 1,000,000 | 5 shards Ã— 200k |
| Test Size | 1,000 | test_1k_0 |

---

## ğŸ“Š å®éªŒ 1: Alpha Sweep (1k test)

### é…ç½®
- **Train**: 1M samples (5 shards)
- **Test**: 1k samples (full test_1k_0, pre-noised)
- **Noise**: Ïƒ=1.0
- **X Scaling**: StandardScaler
- **Y Scaling**: None

### ç»“æœ

| Alpha | Train RÂ² | Test RÂ² | Test MAE |
|------:|:--------:|:-------:|:--------:|
| 100 | 0.4994 | 0.4502 | 0.6592 |
| 1,000 | 0.4994 | 0.4503 | 0.6592 |
| 5,000 | 0.4994 | 0.4505 | 0.6592 |
| 10,000 | 0.4994 | 0.4508 | 0.6592 |
| 50,000 | 0.4991 | 0.4531 | 0.6597 |
| **100,000** | 0.4984 | **0.4551** âœ… | 0.6605 |
| 500,000 | 0.4829 | 0.4543 | 0.6741 |
| 1,000,000 | 0.4554 | 0.4360 | 0.6978 |

### å‘ç°
- æœ€ä¼˜ Î± = 100,000 (ä¸ 500 test ç»“è®ºä¸€è‡´)
- RÂ² å¹³å°åŒºé—´: Î± âˆˆ [100, 100,000]
- è¿‡æ­£åˆ™åŒ–æ‹ç‚¹: Î± > 500,000

---

## ğŸ“Š å®éªŒ 2: Y-Scaling å®éªŒ

### ç›®çš„
æµ‹è¯• MinMaxScaler(y) æ˜¯å¦èƒ½æå‡ RÂ²

### é…ç½®å¯¹æ¯”

| é…ç½® | X Scaling | Y Scaling |
|------|-----------|-----------|
| Baseline | StandardScaler | None |
| å®éªŒ1 | StandardScaler | MinMaxScaler |
| å®éªŒ2 | None | MinMaxScaler |

### ç»“æœ

| é…ç½® | Best Alpha | Best RÂ² |
|------|:----------:|:-------:|
| Baseline: Scale X only | 100,000 | 0.4551 |
| å®éªŒ1: Scale X + Scale y | 100,000 | **0.4551** |
| å®éªŒ2: Scale y only | 1,000 | **0.4551** |

### å…³é”®å‘ç°

1. **RÂ² ä¸å˜**: æ‰€æœ‰é…ç½®è¾¾åˆ°ç›¸åŒçš„æœ€ä½³ RÂ² = 0.4551
2. **åŸå› **: RÂ² å®šä¹‰ä¸º 1 - SS_res/SS_totï¼Œå¯¹ y çš„çº¿æ€§å˜æ¢ä¸å˜
3. **Alpha å˜åŒ–**: ä¸ scale X æ—¶ï¼Œæœ€ä¼˜ Î± ä» 100,000 é™åˆ° 1,000
   - åŸå› : æ­£åˆ™åŒ–æƒ©ç½š ||w||Â² ä¸ X å°ºåº¦ç›¸å…³

---

## ğŸ“ˆ Test Size å½±å“

| Test Size | Best Alpha | RÂ² |
|-----------|:----------:|---:|
| 500 | 100,000 | 0.5017 |
| 1,000 | 100,000 | **0.4551** |

å·®å¼‚ Î”RÂ² = -0.047 æ¥è‡ªæ›´å¤§æµ‹è¯•é›†çš„æ›´å‡†ç¡®ä¼°è®¡ã€‚

---

## âœ… ç»“è®º

1. **Ridge RÂ² å¤©èŠ±æ¿ç¡®è®¤**: ~0.455 @ noise=1, 1M data, 1k test
2. **æœ€ä¼˜ Alpha**: 100,000 (1M æ•°æ®ï¼Œä½¿ç”¨ StandardScaler)
3. **Y-Scaling æ— æ•ˆ**: ä¸æ¨èä½¿ç”¨
4. **æ ‡å‡†æµ‹è¯•åŸºå‡†**: ä½¿ç”¨ 1k test (é 500)

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

| ç±»å‹ | è·¯å¾„ |
|------|------|
| Alpha Sweep Script | `~/VIT/scripts/scaling_ridge_alpha_extended.py` |
| Results | `~/VIT/results/scaling_ridge_alpha/ridge_alpha_sweep.csv` |

---

*Generated: 2025-12-24*

---
## ğŸ“ Data Source Documentation

### Dataset: BOSZ Synthetic Stellar Spectra

| å±æ€§ | å€¼ |
|------|-----|
| **æ•°æ®é›†åç§°** | BOSZ 50000 åˆæˆå…‰è°± |
| **æ•°æ®æ ¹ç›®å½•** | `/datascope/subaru/user/swei20/data/bosz50000/z0/mag205_225_lowT_1M/` |
| **å…‰è°±ç±»å‹** | MR arm (ä¸­åˆ†è¾¨ç‡) |
| **æ³¢é•¿ç»´åº¦** | 4096 features |
| **æ˜Ÿç­‰èŒƒå›´** | mag 20.5-22.5 |
| **æ¸©åº¦èŒƒå›´** | Low T (3750-6000 K) |

### è®­ç»ƒæ•°æ® (5 Shards Ã— 200k = 1M samples)

| Shard | æ ·æœ¬æ•° | æ–‡ä»¶å¤§å° | è·¯å¾„ |
|-------|--------|---------|------|
| 0 | 200,000 | 19 GB | `train_200k_0/dataset.h5` |
| 1 | 200,000 | 19 GB | `train_200k_1/dataset.h5` |
| 2 | 200,000 | 19 GB | `train_200k_2/dataset.h5` |
| 3 | 200,000 | 19 GB | `train_200k_3/dataset.h5` |
| 4 | 200,000 | 19 GB | `train_200k_4/dataset.h5` |
| **Total** | **1,000,000** | **95 GB** | |

### æµ‹è¯•æ•°æ®

| æ–‡ä»¶ | æ ·æœ¬æ•° | æ–‡ä»¶å¤§å° | è·¯å¾„ |
|------|--------|---------|------|
| test_1k_0 | 1,000 | 128 MB | `test_1k_0/dataset.h5` |

### HDF5 æ•°æ®ç»“æ„

```
dataset.h5
â”œâ”€â”€ dataset/
â”‚   â”œâ”€â”€ arrays/
â”‚   â”‚   â”œâ”€â”€ flux/value      # (N, 4096) - åŸå§‹å…‰è°±é€šé‡
â”‚   â”‚   â”œâ”€â”€ error/value     # (N, 4096) - å…‰è°±è¯¯å·®
â”‚   â”‚   â”œâ”€â”€ noisy/value     # (N, 4096) - é¢„åŠ å™ªå…‰è°± (ä»… test)
â”‚   â”‚   â””â”€â”€ mask/value      # (N, 4096) - æ©ç 
â”‚   â””â”€â”€ params/table        # (N,) - å‚æ•°è¡¨
â””â”€â”€ spectrumdataset/
    â”œâ”€â”€ wave                # (4096,) - æ³¢é•¿
    â””â”€â”€ wave_edges          # (4097,) - æ³¢é•¿è¾¹ç•Œ
```

### å‚æ•°èŒƒå›´

| å‚æ•° | æœ€å°å€¼ | æœ€å¤§å€¼ | å•ä½ |
|------|--------|--------|------|
| **log_g** (target) | 1.00 | 5.00 | dex |
| **T_eff** | 3750 | 6000 | K |
| **[M/H]** | -2.50 | 0.75 | dex |

### å™ªå£°æ·»åŠ æ–¹å¼

```python
# Heteroscedastic Gaussian noise
noise = noise_level * error * np.random.randn(*flux.shape)
noisy = flux + noise
noisy = np.clip(noisy, 0, None)  # Clip negative values
```

| noise_level | å«ä¹‰ |
|-------------|------|
| 0.0 | æ— å™ªå£° |
| 0.2 | ä½å™ªå£° |
| 1.0 | æ ‡å‡†å™ªå£° (æœ¬å®éªŒä½¿ç”¨) |
| 2.0 | é«˜å™ªå£° |

### 9-Bin åˆ’åˆ† (MoE)

| Teff è¾¹ç•Œ | [M/H] è¾¹ç•Œ |
|-----------|-----------|
| [3750, 4500, 5250, 6000] | [-2.0, -1.0, 0.0, 0.5] |

```
          [M/H]
          Poor    Solar   Rich
         [-2,-1] [-1,0]  [0,0.5]
Teff     â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
Cool     â”‚ Bin 0 â”‚ Bin 1 â”‚ Bin 2 â”‚  [3750,4500]
[3750,   â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
4500]    â”‚       â”‚       â”‚       â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
Mid      â”‚ Bin 3 â”‚ Bin 4 â”‚ Bin 5 â”‚  [4500,5250]
[4500,   â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
5250]    â”‚       â”‚       â”‚       â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
Hot      â”‚ Bin 6 â”‚ Bin 7 â”‚ Bin 8 â”‚  [5250,6000]
[5250,   â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
6000]
```
