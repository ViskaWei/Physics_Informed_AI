# ğŸ“˜ è®¾è®¡åŸåˆ™æ–‡æ¡£ï¼šWhitening/SNR è¾“å…¥é¢„å¤„ç†ç­–ç•¥

> **Name:** Whitening/SNR Input Design Principles  
> **Topic:** `scaling` | **Project:** `VIT`  
> **Author:** Viska Wei | **Date:** 2025-12-26 | **Status:** âœ… å·²å®Œæˆ
> ```
> ğŸ’¡ æ ¸å¿ƒåŸåˆ™ï¼šä¸åŒæ¨¡å‹å¯¹è¾“å…¥é¢„å¤„ç†çš„éœ€æ±‚å®Œå…¨ä¸åŒ
> ```

---

## ğŸ”— ç›¸å…³å®éªŒ

| Type | Link |
|------|------|
| ğŸ§  Hub | `logg/scaling/scaling_hub.md` |
| ğŸ“Š å®éªŒæŠ¥å‘Š | `exp_scaling_whitening_snr_20251222.md` |
| ğŸ“‡ çŸ¥è¯†å¡ç‰‡ | `card/card_whitening_snr_20251222.md` |
| ğŸ§ª NNåŸºçº¿å®éªŒ | `exp_scaling_nn_baseline_framework_20251224.md` |

---

## ğŸ“Š å®éªŒç»“æœæ€»ç»“

### 1. Ridgeå›å½’ï¼ˆ1M samples, noise=1.0ï¼‰

| è¾“å…¥æ–¹å¼ | RÂ² | Î” vs standardized | è¯´æ˜ |
|---------|-----|-------------------|------|
| **raw** | 0.5077 | -0.0000 | åŸºå‡† |
| **standardized** | 0.5077 | 0.0000 | å½“å‰baseline |
| **snr** (flux/error) | 0.5081 | +0.0004 | å¾®å°æå‡ |
| **snr_centered** ((flux-Î¼)/error) | **0.5222** | **+0.0146** | æœ€ä½³ï¼ˆ+1.5%ï¼‰ |

**ç»“è®º**: Ridgeå¯¹whiteningç›¸å¯¹ä¸æ•æ„Ÿï¼Œ`snr_centered`æœ‰è½»å¾®æå‡ä½†æœªè¾¾æ˜¾è‘—æ€§é˜ˆå€¼ï¼ˆ0.02ï¼‰ã€‚

### 2. LightGBMï¼ˆ100k samples, noise=1.0ï¼‰

| è¾“å…¥æ–¹å¼ | RÂ² | Î” vs standardized | è¯´æ˜ |
|---------|-----|-------------------|------|
| **raw** | **0.5533** | **+0.3567** | â­ æœ€ä½³ï¼ |
| **standardized** | 0.1966 | 0.0000 | åŸºå‡†ï¼ˆå¾ˆå·®ï¼‰ |
| **snr** (flux/error) | 0.0074 | -0.1892 | âŒ å‡ ä¹å¤±æ•ˆ |
| **snr_centered** | 0.0120 | -0.1846 | âŒ å‡ ä¹å¤±æ•ˆ |

**ç»“è®º**: LightGBM**ç»å¯¹ä¸èƒ½**ä½¿ç”¨whiteningæˆ–standardizationï¼Œå¿…é¡»ä½¿ç”¨rawè¾“å…¥ï¼

### 3. ç¥ç»ç½‘ç»œï¼ˆ100k samples, noise=1.0ï¼‰

#### MLPç»“æœ

| è¾“å…¥æ–¹å¼ | æœ€ä½³RÂ² | è¯´æ˜ |
|---------|--------|------|
| **whitening** | 0.12 (éƒ¨åˆ†å¤±è´¥) | å¤šæ•°å®éªŒå¤±è´¥ï¼ˆRÂ²æ¥è¿‘0æˆ–è´Ÿå€¼ï¼‰ |
| **flux_only** | **0.44-0.47** | â­ ç¨³å®šä¸”æ€§èƒ½å¥½ |

#### CNNç»“æœ

| è¾“å…¥æ–¹å¼ | æœ€ä½³RÂ² | è¯´æ˜ |
|---------|--------|------|
| **whitening** | 0.34-0.43 | éƒ¨åˆ†æˆåŠŸï¼ˆéœ€è¦BatchNormï¼‰ä½†å¤šæ•°å¤±è´¥ |
| **flux_only** | **0.41** | â­ æ›´ç¨³å®š |

**ç»“è®º**: NNï¼ˆMLP/CNNï¼‰ä½¿ç”¨`flux_only`æ›´ç¨³å®šï¼›ä½¿ç”¨whiteningæ—¶å®¹æ˜“å‡ºç°è®­ç»ƒä¸ç¨³å®šï¼ˆæ¢¯åº¦é—®é¢˜ï¼‰ã€‚

---

## ğŸ¯ è®¾è®¡åŸåˆ™

### åŸåˆ™1: æ¨¡å‹ç±»å‹å†³å®šè¾“å…¥é¢„å¤„ç†ç­–ç•¥

**æ ¸å¿ƒè§‚ç‚¹**: ä¸åŒæ¨¡å‹å¯¹è¾“å…¥é¢„å¤„ç†çš„éœ€æ±‚å®Œå…¨ç›¸åï¼Œä¸èƒ½ä¸€æ¦‚è€Œè®ºã€‚

| æ¨¡å‹ç±»å‹ | æ¨èè¾“å…¥ | ç¦æ­¢æ“ä½œ | ç†è®ºåŸå›  |
|---------|---------|---------|---------|
| **LightGBM/æ ‘æ¨¡å‹** | `raw flux` | âŒ whitening<br>âŒ standardization | æ ‘æ¨¡å‹å¯¹å°ºåº¦ä¸æ•æ„Ÿï¼Œä½†whiteningä¼šç ´ååˆ†å¸ƒç»“æ„ï¼Œå¯¼è‡´æ€§èƒ½ä¸¥é‡ä¸‹é™ |
| **Ridge/çº¿æ€§æ¨¡å‹** | `standardized` æˆ– `snr_centered` | æ—  | çº¿æ€§æ¨¡å‹èƒ½é€‚åº”å°ºåº¦å˜åŒ–ï¼›whiteningæœ‰è½»å¾®å¸®åŠ© |
| **NN (MLP/CNN)** | `flux_only` + BatchNorm | âš ï¸ whiteningéœ€è°¨æ… | Whiteningå¯¼è‡´æ¢¯åº¦ä¸ç¨³å®šï¼›ä½¿ç”¨BatchNormä»£æ›¿ |

### åŸåˆ™2: Whiteningä¸æ˜¯é“¶å¼¹

**å…³é”®å‘ç°**: `flux/error`ï¼ˆSNRåŒ–ï¼‰åœ¨ç†è®ºä¸Šåˆç†ï¼Œä½†å®é™…æ•ˆæœæœ‰é™ã€‚

**åŸå› åˆ†æ**:
1. **å¯¹Ridge**: è½»å¾®æå‡ï¼ˆ+1.5%ï¼‰ï¼Œä½†æœªè¾¾æ˜¾è‘—æ€§é˜ˆå€¼
2. **å¯¹LightGBM**: ä¸¥é‡æŸå®³ï¼ˆ-98%ï¼‰ï¼Œå®Œå…¨ä¸å¯ç”¨
3. **å¯¹NN**: å¯¼è‡´è®­ç»ƒä¸ç¨³å®šï¼Œå¤šæ•°å®éªŒå¤±è´¥

**å¯ç¤º**: ä¸è¦å‡è®¾whiteningæ€»æ˜¯æœ‰å¸®åŠ©ï¼Œå¿…é¡»é’ˆå¯¹å…·ä½“æ¨¡å‹è¿›è¡ŒéªŒè¯ã€‚

### åŸåˆ™3: æ ‘æ¨¡å‹å¿…é¡»ä¿æŒåŸå§‹åˆ†å¸ƒ

**LightGBMå®éªŒç»“æœ**:
- raw: RÂ² = 0.5533
- standardized: RÂ² = 0.1966ï¼ˆ-36%ï¼‰
- snr: RÂ² = 0.0074ï¼ˆ-98%ï¼‰

**ç†è®ºè§£é‡Š**:
1. æ ‘æ¨¡å‹åŸºäºé˜ˆå€¼åˆ†å‰²ï¼Œå¯¹å•è°ƒå˜æ¢ï¼ˆå¦‚scalingï¼‰ç†è®ºä¸Šä¸æ•æ„Ÿ
2. ä½†whiteningï¼ˆé™¤ä»¥errorï¼‰æ”¹å˜äº†ç‰¹å¾çš„åˆ†å¸ƒå½¢çŠ¶å’Œæ•°å€¼èŒƒå›´
3. å¯èƒ½å¯¼è‡´æœ€ä¼˜åˆ†è£‚ç‚¹å˜åŒ–ï¼Œç ´åæ¨¡å‹å­¦åˆ°çš„æ¨¡å¼
4. StandardizationåŒæ ·ä¼šæ”¹å˜åˆ†å¸ƒï¼Œå½±å“æ ‘æ¨¡å‹æ€§èƒ½

**è®¾è®¡è§„åˆ™**: **æ ‘æ¨¡å‹ä¸€å¾‹ä½¿ç”¨rawè¾“å…¥ï¼Œç¦æ­¢ä»»ä½•å½’ä¸€åŒ–/æ ‡å‡†åŒ–/whiteningæ“ä½œã€‚**

### åŸåˆ™4: çº¿æ€§æ¨¡å‹å¯é€‚åº”æ ‡å‡†åŒ–

**Ridgeå®éªŒç»“æœ**:
- raw: RÂ² = 0.5077
- standardized: RÂ² = 0.5077ï¼ˆå‡ ä¹ç›¸åŒï¼‰
- snr_centered: RÂ² = 0.5222ï¼ˆ+1.5%ï¼‰

**ç†è®ºè§£é‡Š**:
1. çº¿æ€§æ¨¡å‹ï¼ˆRidgeï¼‰é€šè¿‡æƒé‡è°ƒæ•´å¯ä»¥é€‚åº”ä¸åŒçš„ç‰¹å¾å°ºåº¦
2. Standardizationæ”¹å–„æ¡ä»¶æ•°ï¼Œæœ‰åŠ©äºæ•°å€¼ç¨³å®šæ€§
3. `snr_centered`æä¾›éšå¼çš„åŠ æƒä¿¡æ¯ï¼ˆä½ä¿¡å™ªæ¯”åŒºåŸŸæƒé‡é™ä½ï¼‰

**è®¾è®¡è§„åˆ™**: **çº¿æ€§æ¨¡å‹å¯ä»¥ä½¿ç”¨standardizationï¼Œwhiteningå¯èƒ½æœ‰è½»å¾®å¸®åŠ©ï¼ˆéœ€éªŒè¯ï¼‰ã€‚**

### åŸåˆ™5: ç¥ç»ç½‘ç»œéœ€è¦ç¨³å®šçš„æ•°å€¼èŒƒå›´

**NNå®éªŒç»“æœ**:
- MLP + whitening: å¤šæ•°å¤±è´¥ï¼ˆRÂ²â‰ˆ0æˆ–è´Ÿå€¼ï¼‰
- MLP + flux_only: RÂ²â‰ˆ0.44-0.47ï¼ˆç¨³å®šï¼‰
- CNN + whitening: éƒ¨åˆ†æˆåŠŸï¼ˆéœ€BatchNormï¼‰ï¼Œä½†ä¸ç¨³å®š
- CNN + flux_only: RÂ²â‰ˆ0.41ï¼ˆæ›´ç¨³å®šï¼‰

**ç†è®ºè§£é‡Š**:
1. `flux/error`çš„æ•°å€¼èŒƒå›´å¯èƒ½å¾ˆå¤§ï¼ˆerrorå¾ˆå°çš„åœ°æ–¹ä¼šéå¸¸å¤§ï¼‰
2. å¯¼è‡´æ¢¯åº¦çˆ†ç‚¸æˆ–æ¶ˆå¤±ï¼Œè®­ç»ƒä¸ç¨³å®š
3. BatchNormå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£é—®é¢˜ï¼ˆä»CNNç»“æœçœ‹ï¼‰
4. ä½†æ€»ä½“è€Œè¨€ï¼ŒåŸå§‹fluxé…åˆBatchNormæ›´ç¨³å®š

**è®¾è®¡è§„åˆ™**: **NNä¼˜å…ˆä½¿ç”¨raw flux + BatchNormï¼›å¦‚éœ€whiteningï¼Œå¿…é¡»é…åˆå½’ä¸€åŒ–å±‚å¹¶éªŒè¯ç¨³å®šæ€§ã€‚**

---

## ğŸ“‹ å®è·µæŒ‡å—

### å¿«é€Ÿå†³ç­–è¡¨

```
é€‰æ‹©æ¨¡å‹ç±»å‹
    â”‚
    â”œâ”€â†’ LightGBM/æ ‘æ¨¡å‹
    â”‚   â””â”€â†’ âœ… ä½¿ç”¨ raw fluxï¼ˆç¦æ­¢whitening/standardizationï¼‰
    â”‚
    â”œâ”€â†’ Ridge/çº¿æ€§æ¨¡å‹
    â”‚   â””â”€â†’ âœ… ä½¿ç”¨ standardized æˆ– snr_centeredï¼ˆå‡å¯ï¼‰
    â”‚
    â””â”€â†’ NN (MLP/CNN)
        â””â”€â†’ âœ… ä½¿ç”¨ flux_only + BatchNormï¼ˆé¿å…whiteningï¼‰
```

### ä»£ç å®ç°æ£€æŸ¥æ¸…å•

- [ ] **LightGBM**: ç¡®è®¤ä½¿ç”¨raw fluxï¼Œæœªåº”ç”¨StandardScaleræˆ–whitening
- [ ] **Ridge**: ç¡®è®¤ä½¿ç”¨standardizedæˆ–snr_centeredï¼ˆæ ¹æ®éœ€æ±‚é€‰æ‹©ï¼‰
- [ ] **NN**: ç¡®è®¤ä½¿ç”¨flux_only + BatchNorm/LayerNormï¼›å¦‚ä½¿ç”¨whiteningéœ€éªŒè¯ç¨³å®šæ€§
- [ ] **å®éªŒéªŒè¯**: æ–°æ¨¡å‹å¿…é¡»å¯¹æ¯”raw vs whitening vs standardizedçš„æ€§èƒ½

### å¸¸è§é”™è¯¯

1. âŒ **é”™è¯¯**: å¯¹æ‰€æœ‰æ¨¡å‹ç»Ÿä¸€ä½¿ç”¨StandardScaler
   - âœ… **æ­£ç¡®**: æ ¹æ®æ¨¡å‹ç±»å‹é€‰æ‹©é¢„å¤„ç†ç­–ç•¥

2. âŒ **é”™è¯¯**: å‡è®¾whiteningæ€»æ˜¯æœ‰å¸®åŠ©
   - âœ… **æ­£ç¡®**: å¿…é¡»å®éªŒéªŒè¯ï¼Œç‰¹åˆ«æ˜¯å¯¹æ ‘æ¨¡å‹

3. âŒ **é”™è¯¯**: NNä½¿ç”¨whiteningä½†ä¸åŠ å½’ä¸€åŒ–å±‚
   - âœ… **æ­£ç¡®**: ä½¿ç”¨BatchNorm/LayerNormä¿è¯è®­ç»ƒç¨³å®šæ€§

---

## ğŸ”¬ ç†è®ºæ”¯æŒ

### 1. æ ‘æ¨¡å‹ä¸å°ºåº¦ä¸å˜æ€§

**ç†è®º**: å†³ç­–æ ‘åŸºäºé˜ˆå€¼åˆ†å‰²ï¼Œå¯¹ç‰¹å¾çš„å•è°ƒå˜æ¢ï¼ˆå¦‚`f(x) = ax + b`, `a > 0`ï¼‰ç†è®ºä¸Šä¸æ•æ„Ÿã€‚

**ä¸ºä»€ä¹ˆwhiteningä»æœ‰å®³**:
- Whitening (`x' = x / error`) ä¸æ˜¯ç®€å•çš„çº¿æ€§å˜æ¢
- å®ƒæ”¹å˜äº†ä¸åŒæ ·æœ¬é—´ç‰¹å¾çš„ç›¸å¯¹å…³ç³»
- æ”¹å˜äº†ç‰¹å¾çš„åˆ†å¸ƒå½¢çŠ¶å’Œæ•°å€¼èŒƒå›´
- å¯¼è‡´æœ€ä¼˜åˆ†è£‚ç‚¹ä½ç½®æ”¹å˜

### 2. çº¿æ€§æ¨¡å‹ä¸æ¡ä»¶æ•°

**ç†è®º**: çº¿æ€§æ¨¡å‹ `y = Xw + b` çš„æ±‚è§£ä¾èµ–äº `X^T X` çš„æ¡ä»¶æ•°ã€‚

**Standardizationçš„ä½œç”¨**:
- ä½¿æ‰€æœ‰ç‰¹å¾å…·æœ‰ç›¸åŒçš„æ–¹å·®ï¼ˆæ ‡å‡†å·®=1ï¼‰
- æ”¹å–„æ¡ä»¶æ•°ï¼Œæé«˜æ•°å€¼ç¨³å®šæ€§
- ä½†å¯¹é¢„æµ‹æ€§èƒ½å½±å“æœ‰é™ï¼ˆRidgeç»“æœæ˜¾ç¤ºå‡ ä¹ç›¸åŒï¼‰

**Whiteningçš„é¢å¤–ä½œç”¨**:
- `snr_centered` æä¾›äº†éšå¼çš„åŠ æƒä¿¡æ¯
- ä½ä¿¡å™ªæ¯”åŒºåŸŸï¼ˆerrorå¤§ï¼‰çš„ç‰¹å¾å€¼è¢«å‹ç¼©
- ç›¸å½“äºè®©æ¨¡å‹æ›´å…³æ³¨é«˜ä¿¡å™ªæ¯”åŒºåŸŸ

### 3. ç¥ç»ç½‘ç»œçš„æ¢¯åº¦ç¨³å®šæ€§

**ç†è®º**: æ·±åº¦å­¦ä¹ çš„æˆåŠŸä¾èµ–äºç¨³å®šçš„æ¢¯åº¦æµåŠ¨ã€‚

**Whiteningçš„é—®é¢˜**:
- `flux/error` çš„æ•°å€¼èŒƒå›´å¯èƒ½å¾ˆå¤§ï¼ˆå½“errorå¾ˆå°æ—¶ï¼Œæ¯”å€¼å¾ˆå¤§ï¼‰
- å¯¼è‡´æ¢¯åº¦çˆ†ç‚¸æˆ–æ¶ˆå¤±
- ç ´åBatchNormçš„ç»Ÿè®¡å‡è®¾

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨BatchNorm/LayerNormç¨³å®šè®­ç»ƒ
- æˆ–ç›´æ¥ä½¿ç”¨raw fluxï¼Œè®©ç½‘ç»œè‡ªå·±å­¦ä¹ åˆé€‚çš„è¡¨ç¤º

---

## ğŸ“Š å…³é”®æ•°å­—é€ŸæŸ¥

| Metric | Value | Condition | æ¥æº |
|--------|-------|-----------|------|
| **Ridgeæœ€ä½³** | 0.5222 (snr_centered) | 1M, Ïƒ=1 | whiteningå®éªŒ |
| **LightGBMæœ€ä½³** | 0.5533 (raw) | 100k, Ïƒ=1 | whiteningå®éªŒ |
| **LightGBMæ ‡å‡†åŒ–æŸå¤±** | -36% (0.1966 vs 0.5533) | 100k, Ïƒ=1 | whiteningå®éªŒ |
| **LightGBM whiteningæŸå¤±** | -98% (0.0074 vs 0.5533) | 100k, Ïƒ=1 | whiteningå®éªŒ |
| **MLPæœ€ä½³** | 0.44-0.47 (flux_only) | 100k, Ïƒ=1 | NN baselineå®éªŒ |
| **CNNæœ€ä½³** | 0.34-0.43 (whitening+BN) | 100k, Ïƒ=1 | NN baselineå®éªŒ |
| **NN whiteningå¤±è´¥ç‡** | ~70% (RÂ²æ¥è¿‘0) | 100k, Ïƒ=1 | NN baselineå®éªŒ |

---

## âœ… éªŒè¯æ¸…å•

åœ¨ä¸ºæ–°æ¨¡å‹é€‰æ‹©è¾“å…¥é¢„å¤„ç†ç­–ç•¥æ—¶ï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] æ˜¯å¦æ ¹æ®æ¨¡å‹ç±»å‹é€‰æ‹©äº†æ­£ç¡®çš„é¢„å¤„ç†ç­–ç•¥ï¼Ÿ
- [ ] LightGBMæ˜¯å¦ä½¿ç”¨äº†rawè¾“å…¥ï¼ˆæœªåº”ç”¨ä»»ä½•å½’ä¸€åŒ–ï¼‰ï¼Ÿ
- [ ] Ridgeæ˜¯å¦ä½¿ç”¨äº†standardizedæˆ–snr_centeredï¼Ÿ
- [ ] NNæ˜¯å¦ä½¿ç”¨äº†flux_only + BatchNormï¼Ÿ
- [ ] æ˜¯å¦é€šè¿‡å®éªŒéªŒè¯äº†é¢„å¤„ç†ç­–ç•¥çš„æœ‰æ•ˆæ€§ï¼Ÿ
- [ ] æ˜¯å¦å¯¹æ¯”äº†raw vs whitening vs standardizedçš„æ€§èƒ½ï¼Ÿ

---

## ğŸ”— ç›¸å…³èµ„æº

### å®éªŒæ•°æ®

- **Ridge/LightGBMå®éªŒç»“æœ**: `~/VIT/results/scaling_whitening/whitening_results.csv`
- **NNå®éªŒç»“æœ**: `~/VIT/results/scaling_nn_baselines/scaling_nn_results.csv`
- **å®éªŒè„šæœ¬**: `~/VIT/scripts/scaling_whitening_experiment.py`

### ç›¸å…³æ–‡æ¡£

- **å®Œæ•´å®éªŒæŠ¥å‘Š**: `exp_scaling_whitening_snr_20251222.md`
- **çŸ¥è¯†å¡ç‰‡**: `card/card_whitening_snr_20251222.md`
- **NNåŸºçº¿å®éªŒ**: `exp_scaling_nn_baseline_framework_20251224.md`

---

> **æ›´æ–°è®°å½•**:
> - 2025-12-26: åˆ›å»ºè®¾è®¡åŸåˆ™æ–‡æ¡£ï¼Œæ•´åˆRidgeã€LightGBMã€NNçš„å®éªŒç»“æœ

