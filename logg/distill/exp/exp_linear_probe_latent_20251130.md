# ğŸ“˜ BlindSpot Latent Space Linear Probe å®éªŒæŠ¥å‘Š
> **Name:** TODO | **ID:** `VIT-20251130-linear-01`  
> **Topic:** `linear` | **MVP:** MVP-1.1 | **Project:** `VIT`  
> **Author:** Viska Wei | **Date:** 2025-11-30 | **Status:** ğŸ”„
```
ğŸ’¡ å®éªŒç›®çš„  
å†³å®šï¼šå½±å“çš„å†³ç­–
```

---


## ğŸ”— Upstream Links
| Type | Link |
|------|------|
| ğŸ§  Hub | `logg/linear/linear_hub.md` |
| ğŸ—ºï¸ Roadmap | `logg/linear/linear_roadmap.md` |

---

---

## ğŸ”— ä¸Šæ¸¸è¿½æº¯é“¾æ¥ï¼ˆUpstream Linksï¼‰

| å­—æ®µ | å€¼ |
|------|-----|
| **æ¥æºä¼šè¯** | [session_20251130_distill_latent_probe.md](./sessions/session_20251130_distill_latent_probe.md) |
| **é˜Ÿåˆ—å…¥å£** | `status/kanban.md` â†’ `BS-20251130-distill-probe-01` |

---

## ğŸ”— è·¨ä»“åº“å…ƒæ•°æ®ï¼ˆCross-Repo Metadataï¼‰

| å­—æ®µ | å€¼ |
|------|-----|
| **experiment_id** | `BS-20251130-distill-probe-01` |
| **project** | `BlindSpot` |
| **topic** | `distill` |
| **source_repo_path** | `~/BlindSpotDenoiser/evals/` |
| **config_path** | `-` |
| **output_path** | `evals/latent_probe*.pt` |

---

# âš¡ æ ¸å¿ƒç»“è®ºé€Ÿè§ˆï¼ˆä¾› main æå–ï¼‰

### ä¸€å¥è¯æ€»ç»“

> **BlindSpot latent å¼ºç¼–ç  $T_{\text{eff}}$ï¼ˆ$R^2=0.98$ï¼‰å’Œ [M/H]ï¼ˆ$R^2=0.96$ï¼‰ï¼Œå¯¹ $\log g$ åœ¨å¤§æ•°æ®é‡ä¸‹è¾¾åˆ° $R^2=0.28$ï¼ˆLightGBMï¼‰ï¼Œæ•°æ®é‡æ˜¯å…³é”®å› ç´ ã€‚**

### å¯¹å‡è®¾çš„éªŒè¯

| éªŒè¯é—®é¢˜ | ç»“æœ | ç»“è®º |
|---------|------|------|
| Latent æ˜¯å¦çº¿æ€§ç¼–ç  $\log g$ï¼Ÿ | âš ï¸ å¼±çº¿æ€§ï¼Œ$R^2=0.22$ï¼ˆRidgeï¼‰ | éœ€è¦éçº¿æ€§ head |
| LightGBM èƒ½å¦æ”¹å–„ $\log g$ é¢„æµ‹ï¼Ÿ | âœ… æ˜¯ï¼Œ$R^2=0.28$ï¼ˆ+29%ï¼‰ | éçº¿æ€§æ–¹æ³•æœ‰æ•ˆ |
| æ•°æ®é‡æ˜¯å¦å…³é”®ï¼Ÿ | âœ… æ˜¯ï¼Œ1kâ†’100k æ˜¾è‘—æå‡ | å¤§æ•°æ®é‡æ”¹å–„æ³›åŒ– |
| Latent æ˜¯å¦ç¼–ç å…¨å±€å‚æ•°ï¼Ÿ | âœ… æ˜¯ï¼Œ$T_{\text{eff}}$ $R^2=0.98$ | è¡¨ç¤ºå­¦ä¹ æœ‰æ•ˆ |

### è®¾è®¡å¯ç¤ºï¼ˆ1-2 æ¡ï¼‰

| å¯ç¤º | å…·ä½“å»ºè®® |
|------|---------|
| **æ•°æ®é‡ä¼˜å…ˆ** | 100k æ ·æœ¬æ˜¾è‘—æ”¹å–„ LightGBM æ³›åŒ–ï¼Œ1k æ ·æœ¬ LightGBM ä¸¥é‡è¿‡æ‹Ÿåˆ |
| **æ¨¡å‹é€‰æ‹©åˆ†å±‚** | å°æ•°æ®ç”¨ Ridgeï¼ˆç¨³å¥ï¼‰ï¼›å¤§æ•°æ®ç”¨ LightGBMï¼ˆæ€§èƒ½æ›´é«˜ï¼‰ |

### å…³é”®æ•°å­—ï¼ˆ100k Train + 1k Test, LightGBMï¼‰

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| $T_{\text{eff}}$ $R^2$ | **0.9775** |
| [M/H] $R^2$ | **0.9599** |
| $\log g$ $R^2$ | **0.2830** |
| [$\alpha$/M] $R^2$ | **0.1908** |
| [C/M] $R^2$ | **0.1396** |
| Latent ç»´åº¦ | 48 |

---

# ğŸ“‘ ç›®å½•

- [1. ğŸ¯ ç›®æ ‡](#1--ç›®æ ‡)
- [2. ğŸ§ª å®éªŒè®¾è®¡](#2--å®éªŒè®¾è®¡experiment-design)
- [3. ğŸ“Š å®éªŒå›¾è¡¨](#3--å®éªŒå›¾è¡¨)
- [4. ğŸ’¡ å…³é”®æ´è§](#4--å…³é”®æ´è§key-insights)
- [5. ğŸ“ ç»“è®º](#5--ç»“è®ºconclusion)
- [6. ğŸ“ é™„å½•](#6--é™„å½•)

---

# 1. ğŸ¯ ç›®æ ‡

## 1.1 èƒŒæ™¯ä¸åŠ¨æœº

BlindSpot æ˜¯ä¸€ç§åŸºäºç›²ç‚¹ç½‘ç»œ (Blind-spot Network) çš„æ’æ˜Ÿå…‰è°±å»å™ªæ¨¡å‹ã€‚è¯¥æ¨¡å‹åœ¨å»å™ªè¿‡ç¨‹ä¸­å­¦ä¹ äº†å…‰è°±çš„å†…åœ¨è¡¨ç¤º (latent representation)ã€‚

æœ¬å®éªŒå¯¹åº” **Distillation å®éªŒè®¡åˆ’ä¸­çš„ MVP 1.1**ï¼šéªŒè¯ Teacher latent å¯¹ç‰©ç†å‚æ•°çš„ä¿¡æ¯é‡ã€‚

**æ ¸å¿ƒç ”ç©¶é—®é¢˜**ï¼š
> BlindSpot æ¨¡å‹çš„ latent space æ˜¯å¦ç¼–ç äº†æ’æ˜Ÿçš„ç‰©ç†å‚æ•°ä¿¡æ¯ï¼Ÿè¿™äº›ä¿¡æ¯èƒ½å¦é€šè¿‡ç®€å•çš„çº¿æ€§æ¨¡å‹æˆ–éçº¿æ€§æ¨¡å‹æå–å‡ºæ¥ï¼Ÿæ•°æ®é‡å¯¹é¢„æµ‹æ€§èƒ½æœ‰ä½•å½±å“ï¼Ÿ

**å®éªŒç›®æ ‡**ï¼š
1. ä»é¢„è®­ç»ƒçš„ BlindSpot æ¨¡å‹ä¸­æå– latent features
2. ä½¿ç”¨ Linear/Ridge/LightGBM æ¢æµ‹ latent space å¯¹æ’æ˜Ÿç‰©ç†å‚æ•°çš„å¯é¢„æµ‹æ€§
3. è¯„ä¼°æ¨¡å‹å¯¹ä¸åŒç‰©ç†å‚æ•° ($T_{\text{eff}}$, $\log g$, [M/H], [$\alpha$/M], [C/M]) çš„é¢„æµ‹èƒ½åŠ›
4. é‡åŒ–è¯„ä¼°æŒ‡æ ‡ï¼š$R^2$ã€MAEã€RMSE
5. **æ¢ç´¢æ•°æ®é‡ (1k â†’ 32k â†’ 100k) å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“**

## 1.2 æ ¸å¿ƒå‡è®¾

> **BlindSpot Denoiser çš„ latent space ç¼–ç äº†æ’æ˜Ÿçš„ä¸»è¦ç‰©ç†å‚æ•°ï¼Œä¸”é¢„æµ‹æ€§èƒ½éšæ•°æ®é‡å¢åŠ è€Œæå‡ã€‚**

å¦‚æœå‡è®¾æˆç«‹ï¼Œæ„å‘³ç€ï¼š
- Latent è¡¨ç¤ºå¯ä»¥ä½œä¸ºä¸‹æ¸¸ $\log g$ å›å½’ä»»åŠ¡çš„æœ‰æ•ˆç‰¹å¾
- è¶³å¤Ÿçš„æ•°æ®é‡å¯ä»¥å……åˆ†å‘æŒ¥éçº¿æ€§æ¨¡å‹ï¼ˆLightGBMï¼‰çš„ä¼˜åŠ¿
- è’¸é¦æ–¹æ¡ˆï¼ˆTeacher-Studentï¼‰æœ‰åšå®çš„åŸºç¡€

å¦‚æœå‡è®¾ä¸æˆç«‹ï¼Œåˆ™éœ€è¦ï¼š
- è€ƒè™‘æ”¹è¿›æ± åŒ–ç­–ç•¥ï¼ˆattention poolingï¼‰
- é‡æ–°è¯„ä¼° Teacher latent çš„è¡¨ç¤ºè´¨é‡
- æ¢ç´¢å¤šä»»åŠ¡å­¦ä¹ ç­–ç•¥

## 1.3 éªŒè¯é—®é¢˜

| # | é—®é¢˜ | éªŒè¯ç›®æ ‡ | ç»“æœ |
|---|------|---------|------|
| Q1 | Latent + Linear èƒ½å¦é¢„æµ‹ $T_{\text{eff}}$ï¼ˆ$R^2 \geq 0.9$ï¼‰ï¼Ÿ | éªŒè¯å…¨å±€æ¸©åº¦ä¿¡æ¯ç¼–ç  | âœ… $R^2 = 0.9702$ (Ridge) |
| Q2 | Latent + Linear èƒ½å¦é¢„æµ‹ [M/H]ï¼ˆ$R^2 \geq 0.9$ï¼‰ï¼Ÿ | éªŒè¯é‡‘å±ä¸°åº¦ä¿¡æ¯ç¼–ç  | âœ… $R^2 = 0.9444$ (Ridge) |
| Q3 | Latent + Linear èƒ½å¦é¢„æµ‹ $\log g$ï¼ˆ$R^2 \geq 0.5$ï¼‰ï¼Ÿ | éªŒè¯è¡¨é¢é‡åŠ›ä¿¡æ¯ç¼–ç  | âŒ $R^2 = 0.2192$ (Ridge) |
| Q4 | LightGBM èƒ½å¦æ”¹å–„ $\log g$ é¢„æµ‹ï¼Ÿ | éªŒè¯éçº¿æ€§ä¿¡å· | âœ… $R^2 = 0.2830$ (+29%) |
| Q5 | æ•°æ®é‡å¢åŠ èƒ½å¦æ”¹å–„é¢„æµ‹ï¼Ÿ | éªŒè¯æ•°æ®é‡å½±å“ | âœ… $\log g$: 0.18 â†’ 0.28 |
| Q6 | å°æ•°æ®é›† LightGBM æ˜¯å¦è¿‡æ‹Ÿåˆï¼Ÿ | è¯„ä¼°è¿‡æ‹Ÿåˆé£é™© | âš ï¸ 1k æ ·æœ¬ä¸¥é‡è¿‡æ‹Ÿåˆ |

## 1.4 ç»“è®ºæ‘˜è¦

### 1.4.1 å®éªŒç»“è®º

| ç»“è®º | è¯´æ˜ |
|------|------|
| **Latent å¼ºç¼–ç å…¨å±€å‚æ•°** | $T_{\text{eff}}$ï¼ˆ$R^2=0.98$ï¼‰å’Œ [M/H]ï¼ˆ$R^2=0.96$ï¼‰å¯é€šè¿‡çº¿æ€§æ¢æµ‹å™¨é«˜ç²¾åº¦æ¢å¤ |
| **$\log g$ å—ç›Šäºéçº¿æ€§æ–¹æ³•** | LightGBM æ¯” Ridge æå‡ 29%ï¼ˆ$R^2$: 0.22 â†’ 0.28ï¼‰ |
| **æ•°æ®é‡æ˜¯å…³é”®å› ç´ ** | 1k â†’ 100k æ•°æ®é‡ä¸‹ï¼Œ$\log g$ é¢„æµ‹æ˜¾è‘—æ”¹å–„ |
| **å°æ•°æ®é›† LightGBM è¿‡æ‹Ÿåˆ** | 1000 æ ·æœ¬å¯¹ LightGBM ä¸è¶³ï¼ŒRidge æ›´ç¨³å¥ |

### 1.4.2 è®¾è®¡å¯ç¤º

| è®¾è®¡åŸåˆ™ | å…·ä½“å»ºè®® |
|---------|---------|
| **æ•°æ®é‡ä¼˜å…ˆ** | å»ºè®®ä½¿ç”¨ â‰¥32k æ ·æœ¬è®­ç»ƒ LightGBM |
| **æ¨¡å‹é€‰æ‹©ç­–ç•¥** | <10k: Ridgeï¼›10k-50k: LightGBM (ä¿å®ˆå‚æ•°)ï¼›>50k: LightGBM |
| **æ± åŒ–ç­–ç•¥** | Mean pooling ä¸¢å¤±ç©ºé—´ä¿¡æ¯ï¼Œå¯¹ $\log g$ ä¸åˆ©ï¼›è€ƒè™‘ attention pooling |

> **ä¸€å¥è¯æ€»ç»“**ï¼šBlindSpot latent å¼ºç¼–ç æ¸©åº¦å’Œé‡‘å±ä¸°åº¦ï¼Œ$\log g$ åœ¨å¤§æ•°æ®é‡ + LightGBM ä¸‹è¾¾åˆ° $R^2 \approx 0.28$ï¼Œæ•°æ®é‡æ˜¯å…³é”®å› ç´ ã€‚

---

# 2. ğŸ§ª å®éªŒè®¾è®¡ï¼ˆExperiment Designï¼‰

## 2.1 æ•°æ®ï¼ˆDataï¼‰

- **æ•°æ®æ¥æº**ï¼šBOSZ åˆæˆå…‰è°±åº“ (Bohlin et al.)
- **æ•°æ®è§„æ¨¡**ï¼š1k / 32k / 100k ä¸‰ç§è§„æ¨¡
- **ç‰¹å¾ç»´åº¦**ï¼š$L = 4096$ï¼ˆæ³¢é•¿ç‚¹æ•°ï¼‰
- **Latent ç»´åº¦**ï¼š$D = 48$ï¼ˆencoder è¾“å‡ºé€šé“æ•°ï¼‰
- **æ ‡ç­¾å‚æ•°**ï¼š$\log g$, $T_{\text{eff}}$, [M/H], [$\alpha$/M], [C/M]

| æ•°æ®é›† | è·¯å¾„ | æ ·æœ¬æ•° |
|--------|------|--------|
| è®­ç»ƒé›† (100k) | `/datascope/.../train_100k/dataset.h5` | 100,000 |
| éªŒè¯é›† | `/datascope/.../train_1k/dataset.h5` | 1,000 |
| æµ‹è¯•é›† | `/datascope/.../val_1k/dataset.h5` | 1,000 |

**å‚æ•°æ•°å€¼èŒƒå›´**ï¼š

| å‚æ•° | ç¬¦å· | èŒƒå›´ | å•ä½ |
|------|------|------|------|
| æœ‰æ•ˆæ¸©åº¦ | $T_{\text{eff}}$ | [3750, 6000] | K |
| è¡¨é¢é‡åŠ› | $\log g$ | [1.0, 5.0] | dex |
| é‡‘å±ä¸°åº¦ | [M/H] | [-2.5, 0.75] | dex |
| $\alpha$ å¢å¼º | [$\alpha$/M] | [-0.25, 0.5] | dex |
| ç¢³ä¸°åº¦ | [C/M] | [-0.75, 0.5] | dex |

## 2.2 ä½¿ç”¨çš„ç‰¹å¾ç±»å‹

| ç‰¹å¾ç±»å‹ | æè¿° | ç»´åº¦ |
|----------|------|------|
| Teacher latent $z^\star$ | BlindSpot encoder æœ€åä¸€å±‚ + mean pooling | 48 |
| è¾“å…¥ | noisy flux + errorï¼ˆåŒé€šé“ï¼‰ | [2, 4096] |

**Latent æå–é…ç½®**ï¼š
- **æå–å±‚**ï¼š`encoder_last`ï¼ˆæœ€åä¸€å±‚ç¼–ç å™¨ï¼‰
- **æ± åŒ–ç­–ç•¥**ï¼š`mean`ï¼ˆå…¨å±€å¹³å‡æ± åŒ–ï¼‰

## 2.3 æ¨¡å‹ä¸ç®—æ³•ï¼ˆModel & Algorithmï¼‰

### BlindSpot Encoderï¼ˆå†»ç»“ï¼‰

```
è¾“å…¥: [batch, 2, L]  (noisy å…‰è°± + error)
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Encoders (9 å±‚)                â”‚
  â”‚  æ¯å±‚: Conv1D â†’ BatchNorm â†’ ReLU â”‚
  â”‚  è¾“å‡ºé€šé“: 48                    â”‚
  â”‚  ç›²ç‚¹æœºåˆ¶: å·¦å³åˆ†æ”¯ç‹¬ç«‹å·ç§¯      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
  Mean Pooling â†’ Latent: [batch, 48]
```

### è¯„ä¼°æ¨¡å‹

1. **OLS çº¿æ€§å›å½’**ï¼šsklearn `LinearRegression`
2. **Ridge å›å½’**ï¼šsklearn `Ridge(alpha=0.001, normalize=True)`
3. **LightGBM**ï¼š
   - ä¿å®ˆé…ç½®ï¼š`num_leaves=15, n_estimators=50`
   - é»˜è®¤é…ç½®ï¼š`num_leaves=31, n_estimators=100`

### è¯„ä¼°æŒ‡æ ‡

$$
R^2 = 1 - \frac{\sum(y_i - \hat{y}_i)^2}{\sum(y_i - \bar{y})^2}
$$

$$
\text{MAE} = \frac{1}{n}\sum|y_i - \hat{y}_i|
$$

$$
\text{RMSE} = \sqrt{\frac{1}{n}\sum(y_i - \hat{y}_i)^2}
$$

## 2.4 è¶…å‚æ•°ï¼ˆHyperparametersï¼‰

### BlindSpot æ¨¡å‹é…ç½®

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| `num_layers` | 9 | ç¼–ç å™¨å±‚æ•° |
| `embed_dim` | 48 | åµŒå…¥ç»´åº¦ï¼ˆlatent ç»´åº¦ï¼‰ |
| `kernel_size` | 25 | å·ç§¯æ ¸å¤§å° |
| `input_sigma` | true | è¾“å…¥åŒ…å« error é€šé“ |
| `blindspot` | true | å¯ç”¨ç›²ç‚¹æœºåˆ¶ |
| `use_bn` | true | ä½¿ç”¨ Batch Normalization |

### LightGBM é…ç½®å¯¹æ¯”

| é…ç½® | num_leaves | n_estimators | learning_rate | é€‚ç”¨åœºæ™¯ |
|------|------------|--------------|---------------|----------|
| ä¿å®ˆ | 15 | 50 | 0.05 | å°æ•°æ®ï¼ˆ<10kï¼‰ |
| é»˜è®¤ | 31 | 100 | 0.1 | ä¸­ç­‰æ•°æ®ï¼ˆ10k-50kï¼‰ |
| å¤§è§„æ¨¡ | 31 | 1000 | 0.1 | å¤§æ•°æ®ï¼ˆ>50kï¼‰ï¼Œæ˜“è¿‡æ‹Ÿåˆ |

---

# 3. ğŸ“Š å®éªŒå›¾è¡¨

## 3.1 å®éªŒä¸€ï¼šå°æ ·æœ¬åŸºçº¿ (N=1000)

### Figure 1. å°æ ·æœ¬å„æ¨¡å‹å¯¹æ¯”ï¼ˆ800 è®­ç»ƒ / 200 æµ‹è¯•ï¼‰

| å‚æ•° | OLS $R^2$ | LGBM (default) | LGBM (ä¿å®ˆ) | LGBM (1000 trees) | æœ€ä½³ |
|:----:|:------:|:--------------:|:-------------------:|:-----------------:|:----:|
| $T_{\text{eff}}$ | 0.9627 | **0.9701** | 0.9556 | 0.9697 | LGBM |
| [M/H] | 0.9484 | **0.9519** | 0.9338 | 0.9500 | LGBM |
| $\log g$ | **0.2331** | 0.1019 | 0.1769 | 0.0660 | **Linear** |
| [$\alpha$/M] | **0.0674** | -0.0325 | 0.0638 | -0.0769 | **Linear** |
| [C/M] | **0.0639** | -0.2298 | 0.0225 | -0.2919 | **Linear** |

**å…³é”®è§‚å¯Ÿ**ï¼š
- âš ï¸ **1000 æ ·æœ¬å¯¹ LightGBM ä¸è¶³**ï¼š$\log g$ ç­‰ä½ä¿¡å™ªæ¯”å‚æ•°ä¸¥é‡è¿‡æ‹Ÿåˆ
- âœ… **çº¿æ€§æ¨¡å‹åœ¨å°æ•°æ®é›†æ›´ç¨³å¥**ï¼š$\log g$ OLS $R^2=0.23$ > LGBM $R^2=0.10$
- âš ï¸ **å¢åŠ  n_estimators åŠ å‰§è¿‡æ‹Ÿåˆ**ï¼š$\log g$ ä» 0.10 â†’ 0.07

---

## 3.2 å®éªŒäºŒï¼šä¸­ç­‰æ ·æœ¬ (N=32,000)

### Figure 2. 32k æ ·æœ¬å„æ¨¡å‹å¯¹æ¯”ï¼ˆ25,600 è®­ç»ƒ / 6,400 æµ‹è¯•ï¼‰

| å‚æ•° | OLS $R^2$ | Ridge | LGBM (15/50) | LGBM (31/1000) | æœ€ä½³ |
|:----:|:---:|:---------------:|:------------:|:--------------:|:----:|
| $T_{\text{eff}}$ | 0.9700 | 0.9763 | 0.9851 | **0.9886** | LGBM |
| [M/H] | 0.9243 | 0.9322 | 0.9471 | **0.9652** | LGBM |
| $\log g$ | 0.2012 | 0.2512 | 0.3175 | **0.4884** | LGBM |
| [$\alpha$/M] | 0.1175 | 0.1538 | 0.2170 | **0.3056** | LGBM |
| [C/M] | 0.0992 | 0.1136 | **0.1569** | 0.1193 | LGBM (ä¿å®ˆ) |

**å…³é”®è§‚å¯Ÿ**ï¼š
- âœ… **32k æ ·æœ¬æ˜¾è‘—æ”¹å–„ LightGBM æ³›åŒ–**
- âœ… **$\log g$ é¢„æµ‹å¤§å¹…æå‡**: 0.23 â†’ **0.49** (ç¿»å€ï¼)
- âœ… **[$\alpha$/M] é¢„æµ‹æ”¹å–„æ˜æ˜¾**: 0.07 â†’ **0.31**
- âš ï¸ **[C/M] ä¿å®ˆå‚æ•°æ›´å¥½**: è¿‡æ‹Ÿåˆå½±å“ä»å­˜åœ¨

---

## 3.3 å®éªŒä¸‰ï¼šå¤§è§„æ¨¡æ ·æœ¬ + ç‹¬ç«‹æµ‹è¯•é›† (100k Train + 1k Test)

### Figure 3. 100k è®­ç»ƒ + ç‹¬ç«‹æµ‹è¯•é›†ç»“æœ

| å‚æ•° | Ridge ($\alpha$=0.001) | LGBM (15/50) | æœ€ä½³ | æ”¹å–„å¹…åº¦ |
|:----:|:---------------:|:------------:|:----:|:--------:|
| $T_{\text{eff}}$ | 0.9702 | **0.9775** | LGBM | +0.8% |
| [M/H] | 0.9444 | **0.9599** | LGBM | +1.6% |
| $\log g$ | 0.2192 | **0.2830** | LGBM | +29% |
| [$\alpha$/M] | 0.1161 | **0.1908** | LGBM | +64% |
| [C/M] | 0.0988 | **0.1396** | LGBM | +41% |

**å…³é”®è§‚å¯Ÿ**ï¼š
- âœ… **LightGBM å…¨é¢ä¼˜äº Ridge**
- âœ… **$\log g$ æå‡æœ€æ˜¾è‘—**: +29% (0.22 â†’ 0.28)
- âœ… **[$\alpha$/M] ç›¸å¯¹æå‡æœ€å¤§**: +64%

---

## 3.4 æ•°æ®é‡å½±å“åˆ†æ

### Figure 4. LightGBM (ä¿å®ˆå‚æ•°) ä¸åŒæ•°æ®é‡å¯¹æ¯”

| å‚æ•° | 1k Train | 32k Train | 100k Train | æœ€å¤§æå‡ |
|:----:|:--------:|:---------:|:----------:|:--------:|
| $T_{\text{eff}}$ | 0.9556 | 0.9851 | **0.9775** | +2.2% |
| [M/H] | 0.9338 | 0.9471 | **0.9599** | +2.8% |
| $\log g$ | 0.1769 | **0.3175** | 0.2830 | +60% |
| [$\alpha$/M] | 0.0638 | 0.2170 | **0.1908** | +199% |
| [C/M] | 0.0225 | **0.1569** | 0.1396 | +597% |

**å…³é”®è§‚å¯Ÿ**ï¼š
- âœ… **æ•°æ®é‡æ˜¯å…³é”®å› ç´ **ï¼š1k â†’ 32k: $\log g$ +78%
- âœ… **è¿‡æ‹Ÿåˆéšæ•°æ®é‡å‡å°‘**ï¼š100k æ•°æ® Train/Test å·®è·å°
- âš ï¸ **[C/M] é¢„æµ‹ä»ç„¶å›°éš¾**ï¼šæœ€ä½³ $R^2 = 0.16$

---

# 4. ğŸ’¡ å…³é”®æ´è§ï¼ˆKey Insightsï¼‰

## 4.1 å®è§‚å±‚æ´è§ï¼ˆç”¨äºæŒ‡å¯¼è’¸é¦æ¶æ„è®¾è®¡ï¼‰

1. **æ•°æ®é‡æ˜¯å…³é”®å› ç´ **ï¼š
   - 1k â†’ 32kï¼š$\log g$ ä» 0.18 â†’ 0.32 (+78%)
   - LightGBM åœ¨å°æ•°æ®é›†ä¸¥é‡è¿‡æ‹Ÿåˆï¼ŒRidge æ›´ç¨³å¥
   - æ¨èï¼šè‡³å°‘ä½¿ç”¨ 10k+ æ ·æœ¬

2. **æ¨¡å‹é€‰æ‹©ç­–ç•¥åˆ†å±‚**ï¼š
   - **< 10k æ ·æœ¬**ï¼šRidgeï¼ˆç¨³å¥ï¼Œä¸è¿‡æ‹Ÿåˆï¼‰
   - **10k-50k æ ·æœ¬**ï¼šLightGBM (ä¿å®ˆå‚æ•°: leaves=15, trees=50)
   - **> 50k æ ·æœ¬**ï¼šLightGBM (é»˜è®¤å‚æ•°)

3. **å‚æ•°ç¼–ç çš„å±‚æ¬¡ç»“æ„**ï¼š
   - **å…¨å±€å‚æ•°**ï¼ˆ$T_{\text{eff}}$, [M/H]ï¼‰ï¼šå†³å®šå…‰è°±æ•´ä½“å½¢æ€ï¼Œè¢« mean pooling è‰¯å¥½ä¿ç•™
   - **å±€éƒ¨å‚æ•°**ï¼ˆ$\log g$, [$\alpha$/M], [C/M]ï¼‰ï¼šä¾èµ–ç‰¹å®šè°±çº¿ç»†èŠ‚ï¼Œmean pooling ä¸¢å¤±å…³é”®ç©ºé—´ä¿¡æ¯

## 4.2 æ¨¡å‹å±‚æ´è§ï¼ˆç”¨äºä¼˜åŒ– Linear Probeï¼‰

1. **LightGBM vs Linear çš„ Trade-off**ï¼š
   - $T_{\text{eff}}$, [M/H]ï¼šLightGBM ç•¥ä¼˜ï¼ˆ+1-2%ï¼‰ï¼Œçº¿æ€§å·²è¶³å¤Ÿ
   - $\log g$, [$\alpha$/M]ï¼šLightGBM æ˜¾è‘—ä¼˜äºçº¿æ€§ï¼ˆ+29%, +64%ï¼‰
   - éçº¿æ€§ head å¯¹ $\log g$ æœ‰æ˜ç¡®æ”¶ç›Š

2. **è¿‡æ‹Ÿåˆé£é™©ç®¡ç†**ï¼š
   - Train $R^2$ = 1.0 æ˜¯è¿‡æ‹Ÿåˆä¿¡å·ï¼ˆè§ 1k æ ·æœ¬ LGBM 1000 treesï¼‰
   - ä¿å®ˆå‚æ•°ï¼ˆleaves=15, trees=50ï¼‰åœ¨ä¸­å°æ•°æ®é›†æ›´ç¨³å¥

3. **Mean Pooling çš„å±€é™**ï¼š
   - æœ‰æ•ˆå‹ç¼© $[48, L'] \to [48]$
   - ä½†ä¸¢å¤±äº†å¯¹ $\log g$ æ•æ„Ÿçš„**ç©ºé—´ä½ç½®ä¿¡æ¯**ï¼ˆå¦‚ç‰¹å®šè°±çº¿ä½ç½®ï¼‰

## 4.3 å®éªŒå±‚ç»†èŠ‚æ´è§

1. **ç‰©ç†è§£é‡Š**ï¼š
   - $T_{\text{eff}}$ å†³å®šè¿ç»­è°±æ–œç‡ã€Balmer è·³è·ƒã€è°±çº¿å¼ºåº¦æ¯” â†’ å…¨å±€ç‰¹å¾ï¼Œmean pooling ä¿ç•™
   - [M/H] å½±å“æ‰€æœ‰é‡‘å±å¸æ”¶çº¿æ•´ä½“å¼ºåº¦ â†’ å…¨å±€ç‰¹å¾
   - $\log g$ ä¸»è¦é€šè¿‡å‹åŠ›å¢å®½ï¼ˆBalmer wingsã€Ca IIï¼‰ä½“ç° â†’ å±€éƒ¨ç‰¹å¾ï¼Œç©ºé—´ä¿¡æ¯é‡è¦
   - [$\alpha$/M], [C/M] å½±å“ç‰¹å®šå…ƒç´ çº¿ â†’ é«˜åº¦å±€éƒ¨åŒ–

2. **ç‹¬ç«‹æµ‹è¯•é›†çš„é‡è¦æ€§**ï¼š
   - 32k å®éªŒï¼ˆ80/20 splitï¼‰: $\log g$ $R^2 = 0.49$
   - 100k + ç‹¬ç«‹æµ‹è¯•é›†: $\log g$ $R^2 = 0.28$
   - éšæœºåˆ’åˆ†å¯èƒ½é«˜ä¼°æ€§èƒ½ï¼Œç‹¬ç«‹æµ‹è¯•é›†æ›´å¯é 

---

# 5. ğŸ“ ç»“è®ºï¼ˆConclusionï¼‰

## 5.1 æ ¸å¿ƒå‘ç°

> **BlindSpot latent space å¼ºç¼–ç äº† $T_{\text{eff}}$ å’Œ [M/H]ï¼Œå¯¹ $\log g$ åœ¨å¤§æ•°æ®é‡ + LightGBM ä¸‹è¾¾åˆ° $R^2 \approx 0.28$ï¼Œæ•°æ®é‡æ˜¯å…³é”®å› ç´ ã€‚**

- âš ï¸ åŸå‡è®¾ï¼šlatent space å¯¹æ‰€æœ‰ä¸»è¦å‚æ•°éƒ½æœ‰å¼ºçº¿æ€§ç¼–ç 
- âœ… ä¿®æ­£ç»“è®ºï¼šå…¨å±€å‚æ•°çº¿æ€§å¯åˆ†ï¼›$\log g$ éœ€è¦éçº¿æ€§æ–¹æ³• + è¶³å¤Ÿæ•°æ®é‡

## 5.2 å…³é”®ç»“è®ºï¼ˆ3 æ¡ï¼‰

| # | ç»“è®º | è¯æ® |
|---|------|------|
| 1 | **å…¨å±€å‚æ•°çº¿æ€§å¯åˆ†** | $T_{\text{eff}}$: $R^2 = 0.98$; [M/H]: $R^2 = 0.96$ |
| 2 | **$\log g$ å—ç›Šäºéçº¿æ€§æ–¹æ³•** | LightGBM æ¯” Ridge æå‡ 29%ï¼ˆ0.22 â†’ 0.28ï¼‰ |
| 3 | **æ•°æ®é‡æ˜¯å…³é”®å› ç´ ** | 1k â†’ 100k: $\log g$ LightGBM ä» 0.18 â†’ 0.28 |

## 5.3 è®¾è®¡å¯ç¤º

### æ¶æ„åŸåˆ™

| åŸåˆ™ | å»ºè®® | åŸå›  |
|------|------|------|
| **æ•°æ®é‡ä¼˜å…ˆ** | è‡³å°‘ 10k+ æ ·æœ¬ç”¨äº LightGBM | å°æ•°æ®é›† LightGBM ä¸¥é‡è¿‡æ‹Ÿåˆ |
| **æ¨¡å‹é€‰æ‹©åˆ†å±‚** | <10k: Ridgeï¼›â‰¥10k: LightGBM | å¹³è¡¡ç¨³å¥æ€§å’Œæ€§èƒ½ |
| **è€ƒè™‘æ›¿ä»£æ± åŒ–** | å°è¯• attention pooling æˆ– max pooling | ä¿ç•™ç©ºé—´ä¿¡æ¯ç”¨äº $\log g$ |
| **å¤šä»»åŠ¡è¾…åŠ©** | è®­ç»ƒæ—¶åŒæ—¶é¢„æµ‹ $T_{\text{eff}}$, [M/H] | åˆ©ç”¨é«˜ä¿¡å™ªæ¯”å‚æ•°ç¨³å®šè®­ç»ƒ |

### æ¨èé…ç½®

| æ•°æ®é‡ | çº¿æ€§æ¨¡å‹ | éçº¿æ€§æ¨¡å‹ |
|--------|----------|------------|
| < 10k | Ridge (Î±=0.001) | ä¸æ¨è GBDT |
| 10k-50k | Ridge (Î±=0.001) | LGBM (15/50) |
| > 50k | Ridge (Î±=0.001) | LGBM (15/50) |

## 5.4 ç‰©ç†è§£é‡Š

1. **æ¸©åº¦ä¸»å¯¼å…‰è°±æ•´ä½“å½¢æ€**ï¼š
   - è¿ç»­è°±æ–œç‡ï¼ˆé»‘ä½“è¾å°„ï¼‰
   - Balmer è·³è·ƒå¼ºåº¦
   - è°±çº¿å¼ºåº¦æ¯”ï¼ˆç”µç¦»å¹³è¡¡ï¼‰
   - â†’ Mean pooling è‡ªç„¶ä¿ç•™è¿™äº›å…¨å±€ç‰¹å¾

2. **é‡‘å±ä¸°åº¦æ˜¯å…¨å±€ç¼©æ”¾å› å­**ï¼š
   - å½±å“å‡ ä¹æ‰€æœ‰é‡‘å±å¸æ”¶çº¿çš„å¼ºåº¦
   - â†’ åŒæ ·è¢« mean pooling è‰¯å¥½ä¿ç•™

3. **è¡¨é¢é‡åŠ›ä¾èµ–å±€éƒ¨å‹åŠ›æ•ˆåº”**ï¼š
   - ä¸»è¦é€šè¿‡ç‰¹å®šè°±çº¿çš„å‹åŠ›å¢å®½ï¼ˆBalmer wingsã€Ca II tripletï¼‰ä½“ç°
   - â†’ Mean pooling ä¸¢å¤±è¿™äº›ç©ºé—´ä¿¡æ¯

## 5.5 å…³é”®æ•°å­—é€ŸæŸ¥ï¼ˆ100k Train + 1k Test, LightGBMï¼‰

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| $T_{\text{eff}}$ Test $R^2$ | **0.9775** |
| [M/H] Test $R^2$ | **0.9599** |
| $\log g$ Test $R^2$ | **0.2830** |
| [$\alpha$/M] Test $R^2$ | **0.1908** |
| [C/M] Test $R^2$ | **0.1396** |
| $T_{\text{eff}}$ MAE | 74.11 K |
| [M/H] MAE | 0.141 dex |
| $\log g$ MAE | 0.847 dex |
| Latent ç»´åº¦ | 48 |
| è®­ç»ƒæ ·æœ¬é‡ | 100,000 |
| æµ‹è¯•æ ·æœ¬é‡ | 1,000 |

## 5.6 ä¸‹ä¸€æ­¥å·¥ä½œ

| æ–¹å‘ | å…·ä½“ä»»åŠ¡ | ä¼˜å…ˆçº§ |
|------|----------|--------|
| **æ± åŒ–ç­–ç•¥** | å®éªŒ max pooling / attention pooling | â­â­â­ |
| **å¤šå±‚ç‰¹å¾èåˆ** | ç»“åˆ encoder_mid å’Œ encoder_last | â­â­ |
| **å¤šä»»åŠ¡å­¦ä¹ ** | åŒæ—¶é¢„æµ‹å¤šä¸ªå‚æ•° | â­â­ |
| **æ›´å¤§æ•°æ®é‡** | ä½¿ç”¨å®Œæ•´ 100k è®­ç»ƒ + æ›´å¤§æµ‹è¯•é›† | â­ |

---

# 6. ğŸ“ é™„å½•

## 6.1 æ•°å€¼ç»“æœè¡¨ï¼ˆResultsï¼‰

### 6.1.1 å®éªŒä¸€ï¼šå°æ ·æœ¬ (N=1000) OLS ç»“æœ

| å‚æ•° | Train $R^2$ | Test $R^2$ | Test MAE | Test RMSE |
|:----:|:--------:|:-------:|:--------:|:---------:|
| $T_{\text{eff}}$ | 0.9772 | **0.9627** | 89.56 K | 123.17 K |
| [M/H] | 0.9535 | **0.9484** | 0.170 | 0.214 |
| $\log g$ | 0.2608 | **0.2331** | 0.868 | 1.026 |
| [$\alpha$/M] | 0.1982 | **0.0674** | 0.170 | 0.209 |
| [C/M] | 0.2012 | **0.0639** | 0.275 | 0.333 |

### 6.1.2 å®éªŒäºŒï¼š32k Ridge ç»“æœ

| å‚æ•° | Train $R^2$ | Test $R^2$ | Test MAE | Test RMSE |
|:----:|:--------:|:-------:|:--------:|:---------:|
| $T_{\text{eff}}$ | 0.9762 | **0.9763** | 91.76 K | 120.73 K |
| [M/H] | 0.9282 | **0.9322** | 0.186 | 0.246 |
| $\log g$ | 0.2451 | **0.2512** | 0.831 | 1.005 |
| [$\alpha$/M] | 0.1554 | **0.1538** | 0.182 | 0.217 |
| [C/M] | 0.1211 | **0.1136** | 0.293 | 0.347 |

### 6.1.3 å®éªŒäºŒï¼š32k LightGBM (31/1000) ç»“æœ

| å‚æ•° | Train $R^2$ | Test $R^2$ | Test MAE | Test RMSE |
|:----:|:--------:|:-------:|:--------:|:---------:|
| $T_{\text{eff}}$ | 0.9976 | **0.9886** | 55.82 K | 83.65 K |
| [M/H] | 0.9924 | **0.9652** | 0.128 | 0.177 |
| $\log g$ | 0.8614 | **0.4884** | 0.649 | 0.831 |
| [$\alpha$/M] | 0.8017 | **0.3056** | 0.161 | 0.197 |
| [C/M] | 0.7377 | **0.1193** | 0.284 | 0.346 |

### 6.1.4 å®éªŒä¸‰ï¼š100k + ç‹¬ç«‹æµ‹è¯•é›† LightGBM (15/50) ç»“æœ

| å‚æ•° | Train $R^2$ | Test $R^2$ | Test MAE | Test RMSE | é¢„æµ‹èƒ½åŠ› |
|:----:|:--------:|:-------:|:--------:|:---------:|:--------:|
| $T_{\text{eff}}$ | 0.9856 | **0.9775** | 74.11 K | 100.15 K | â­â­â­ ä¼˜ç§€ |
| [M/H] | 0.9469 | **0.9599** | 0.141 | 0.189 | â­â­â­ ä¼˜ç§€ |
| $\log g$ | 0.3244 | **0.2830** | 0.847 | 1.011 | â­ è¾ƒå¼± |
| [$\alpha$/M] | 0.2332 | **0.1908** | 0.182 | 0.216 | â­ è¾ƒå¼± |
| [C/M] | 0.1743 | **0.1396** | 0.296 | 0.350 | âŒ å¾ˆå¼± |

## 6.2 ç›¸å…³æ–‡ä»¶

| ç±»å‹ | è·¯å¾„ |
|------|------|
| åŸå§‹æŠ¥å‘Š | `/home/swei20/Physics_Informed_AI/raw_blindspot/linear_probe_report.md` |
| æ¨¡å‹é…ç½® | `evals/m215l9e48k25s1bn1d1ep5000.yaml` |
| æ¨¡å‹æƒé‡ | `evals/m215l9e48k25s1bn1d1ep5000.ckpt` |
| Latent ç‰¹å¾ (1k) | `evals/latent_probe.pt` |
| Latent ç‰¹å¾ (32k) | `evals/latent_probe_32k.pt` |
| Latent ç‰¹å¾ (100k train) | `evals/latent_probe_train_100k.pt` |
| Latent ç‰¹å¾ (1k test) | `evals/latent_probe_test_1k.pt` |
| ç‰¹å¾æå–è„šæœ¬ | `experiments/eval_latent_logg.py` |
| è¯„ä¼°è„šæœ¬ | `experiments/linear_probe_eval.py` |

## 6.3 å‘½ä»¤è®°å½•

### Latent ç‰¹å¾æå–

```bash
# 100k è®­ç»ƒé›†
python experiments/eval_latent_logg.py \
    --config configs/blindspot_100k.yaml \
    --ckpt evals/m215l9e48k25s1bn1d1ep5000.ckpt \
    --stage train --batch-size 256 --test-fraction 0.0 \
    --save-results evals/latent_probe_train_100k.pt

# 1k ç‹¬ç«‹æµ‹è¯•é›†
python experiments/eval_latent_logg.py \
    --config configs/blindspot_100k.yaml \
    --ckpt evals/m215l9e48k25s1bn1d1ep5000.ckpt \
    --stage test --batch-size 256 --test-fraction 0.0 \
    --save-results evals/latent_probe_test_1k.pt
```

### æ¨¡å‹è¯„ä¼°

```bash
# Ridge
python experiments/linear_probe_eval.py --model linear --alpha 0.001 --normalize \
    --probe-file evals/latent_probe_train_100k.pt \
    --test-probe-file evals/latent_probe_test_1k.pt

# LightGBM (ä¿å®ˆ)
python experiments/linear_probe_eval.py --model lgbm \
    --lgbm-num-leaves 15 --lgbm-n-estimators 50 \
    --probe-file evals/latent_probe_train_100k.pt \
    --test-probe-file evals/latent_probe_test_1k.pt
```

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-11-30*  
*æ›´æ–°æ—¶é—´: 2025-12-01*  
*å¯¹åº”è’¸é¦å®éªŒè®¡åˆ’: MVP 1.1*
