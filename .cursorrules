# Physics Informed AI - Project Rules

## 📁 Project Structure Memory

This is a physics-informed AI experiment logging repository. When working in this project:

### Report Output Location
All experiment reports MUST be saved to: `/home/swei20/Physics_Informed_AI/logg/`

### Directory Structure
```
logg/
├── [topic]/                    # 各主题实验目录
│   ├── [topic]_hub_*.md        # 🆕 智库导航（问题树、假设金字塔、洞见汇合）
│   ├── [topic]_roadmap_*.md    # 🆕 实验追踪（MVP 列表、进度、跨仓库集成）
│   ├── exp_*.md                # 子实验报告
│   ├── card_*.md               # 知识卡片
│   ├── sessions/               # GPT 会话归档
│   │   └── session_*.md
│   └── img/                    # 图表
│
├── gta/            # Global Tower Architecture 实验
├── cnn/            # CNN 实验 (dilated kernel, etc.)
├── distill/        # 知识蒸馏 / Latent 实验
├── swin/           # Swin Transformer 实验
├── NN/             # 神经网络基础实验
├── noise/          # 噪声相关实验
├── pca/            # PCA 降维实验
├── ridge/          # Ridge 回归实验
├── lightgbm/       # LightGBM 实验
├── moe/            # Mixture of Experts 实验
└── train/          # 训练策略实验

status/
├── kanban.md       # 实验看板（核心任务追踪）
├── next_steps.md   # 下一步计划
└── archive_queue.md # 归档队列

_backend/template/
├── hub.md            # 🆕 智库导航模板（问题树、假设、洞见汇合）
├── roadmap.md        # 🆕 实验追踪模板（MVP 列表、进度）
├── exp.md            # 子实验报告模板（包含流程 + 结果）
├── coding_prompt.md  # 实验 Coding Prompt 模板
├── session.md        # GPT 会话归档模板
├── kanban.md         # 看板模板
├── next.md           # 每日计划模板
└── knowledge_card.md # 知识卡片模板
```

### File Naming Convention
- **Hub files (智库)**: `[topic]_hub_[YYYYMMDD].md`
- **Roadmap files (追踪)**: `[topic]_roadmap_[YYYYMMDD].md`
- **Experiment reports**: `exp_[topic_name]_[YYYYMMDD].md`（包含流程 + 结果）
- **Image files**: `[descriptive_name].png` in the corresponding `img/` subfolder

Examples:
- `logg/moe/moe_hub_20251203.md` (智库导航)
- `logg/moe/moe_roadmap_20251203.md` (实验追踪)
- `logg/gta/exp_gta_baseline_20251130.md` (Experiment report)
- `logg/noise/exp_topk_feature_selection_20251129.md`

### Report Templates (⚠️ MANDATORY)

**根据文档类型选择对应的模板**：

---

#### 🧠 智库导航（Hub）🆕

**模板文件**: `_backend/template/hub.md`

**适用场景**：
- 管理研究问题的层级结构（问题树）
- 维护假设金字塔（宏观→中观→微观）
- 汇合多个实验的单点发现成高层结论
- 战略导航：决定下一步方向

**必需章节**：
1. **Header**: 主题名称、作者、创建日期、状态
2. **🔗 相关文件**: 链接到 roadmap、exp、card
3. **1. 🌲 核心问题树**: 问题分解、问题边界
4. **2. 🔺 假设金字塔**: L1宏观→L2中观→L3微观假设
5. **3. 💡 洞见汇合站**: 多实验单点发现→汇合结论
6. **4. 🧭 战略导航**: 高信心/待验证/风险/已关闭方向
7. **5. 📐 设计原则库**: 已确认原则、关键数字速查
8. **6. 📎 附录**: 物理背景、术语表、变更日志

**⚠️ hub.md 职责边界**：
- ✅ 做：问题梳理、假设管理、洞见汇合、战略导航、设计原则
- ❌ 不做：实验执行追踪（→ roadmap.md）、日常 backlog（→ kanban.md）

---

#### 🗺️ 实验追踪（Roadmap）🆕

**模板文件**: `_backend/template/roadmap.md`

**适用场景**：
- 规划和追踪 MVP 实验进度
- 管理 Phase 和依赖关系
- 跨仓库实验集成
- 记录数值结果

**必需章节**：
1. **Header**: 主题名称、作者、当前 Phase
2. **🔗 相关文件**: 链接到 hub、kanban、exp
3. **1. 🎯 Phase 总览**: Phase 列表、依赖图、决策点
4. **2. 📋 MVP 实验列表**: 总览表、配置速查
5. **3. 🔧 MVP 详细设计**: 每个 MVP 的规格
6. **4. 📊 进度追踪**: 看板视图、核心结论快照、时间线
7. **5. 🔗 跨仓库集成**: experiment_id 索引、仓库关联
8. **6. 📎 附录**: 数值结果汇总、文件索引、变更日志

**⚠️ roadmap.md 职责边界**：
- ✅ 做：MVP 规格、执行追踪、进度看板、跨仓库集成、数值结果
- ❌ 不做：假设管理（→ hub.md）、洞见汇合（→ hub.md）、战略导航（→ hub.md）

**Hub 与 Roadmap 的分工**：
- Hub = 「我们知道了什么？下一步该往哪走？」（战略）
- Roadmap = 「我们计划跑哪些实验？进度如何？」（执行）

---

#### 📗 子实验报告（Sub-Experiment Report）

**模板文件**: `_backend/template/exp.md`

**适用场景**：
- 执行单个 MVP 实验
- 记录实验的**流程**（怎么做）和**结果**（是什么）
- 为 main.md 提供详细数据支撑

**设计原则**：**前 300 行能快速了解实验最重要的信息**

**必需章节**：
1. **Header**: 实验名称、对应 MVP、作者、日期、数据版本、模型版本、状态
2. **🔗 上游追溯链接**: 来源会话、队列入口（链接到 session 和 kanban）
3. **⚡ 核心结论速览**: 一句话总结、假设验证、设计启示、关键数字（供 main 提取）
4. **1. 🎯 目标**: 实验目的、预期结果
5. **2. 🧪 实验设计**: 数据、模型与算法、超参数配置、评价指标
6. **3. 📊 实验图表**: 每张图配有标题、描述和关键观察
7. **4. 💡 关键洞见**: 宏观层、模型层、实验层细节洞见
8. **5. 📝 结论**: 核心发现、关键结论、设计启示、物理解释、关键数字速查、下一步工作
9. **6. 📎 附录**: 数值结果表、**实验流程记录**、相关文件、实验日志

**⚠️ 实验流程记录（放在附录 §6.2）**：
- 记录执行命令、配置路径、关键日志
- 记录调试过程和解决方案
- 便于复现和追溯

---

#### 🤖 实验 Coding Prompt（Coding Prompt）🆕

**模板文件**: `_backend/template/coding_prompt.md`

**适用场景**：
- 在 session 脑暴后选择实验执行时
- 需要生成给 Cursor / Coding Agent 的完整 prompt
- 明确实验规格、图表要求、交付物

**必需内容**：
1. **实验 ID 与元数据**: experiment_id, mvp_source, date
2. **实验设定**: 数据配置、模型配置、训练配置
3. **要画的图**: 图表类型、坐标轴、保存路径
4. **最终交付物**: 
   - 实验报告：`logg/[topic]/exp_[name]_YYYYMMDD.md`（**按 exp.md 模板，包含流程 + 结果**）
   - 图表文件：`logg/[topic]/img/`
5. **报告抄送位置**:
   - `status/kanban.md` → 更新状态为 Done
   - `logg/[topic]/[topic]_roadmap.md` → §2.1 添加实验条目
   - `logg/[topic]/[topic]_hub.md` → §3 添加洞见（如有重要发现）

**⚠️ Prompt 必须强调**：
1. **前 300 行是核心信息**：⚡核心结论速览 + 目标 + 设计 + 图表 + 洞见
2. **实验流程放附录**：执行命令、日志、调试记录 → 写入 exp.md §6.2
3. **按 exp.md 模板输出**：所有章节都要填写完整

---

#### 💬 GPT 会话归档（Session Archive）

**模板文件**: `_backend/template/session.md`

**适用场景**：
- 和 GPT 进行设计讨论 / 实验规划后
- 讨论出了多个实验想法需要结构化
- 把 GPT 的建议转成可执行任务

**必需章节**：
1. **Header**: 会话 ID、日期、参与者、关联 main
2. **1. 起点**: 问题 & 动机、GPT 对话摘录
3. **2. MVP 候选列表**: 从对话中结构化出的实验候选
4. **3. 选择要执行的实验**: 决策 + experiment_id 分配
5. **4. Prompt 草稿区**: 用于让 Cursor/GPT 跑实验的 prompt
6. **5. 会话后 TODO**: 归档后的后续任务

**核心价值**：
- 把「脑暴 + GPT 对话」结构化成 MVP、假设、可执行实验
- 从任何 exp.md 可追溯到当时的 GPT 讨论上下文

---

#### 📌 实验看板（Kanban）

**模板文件**: `_backend/template/kanban.md`
**实例文件**: `status/kanban.md`

**适用场景**：
- 从一堆 idea 里挑出要跑的实验
- 跟踪实验状态（TODO → Running → Done → Archived）
- 作为日常实验执行的中控台

**核心状态**：
- 💡 **Inbox**: 待结构化的 idea
- ⏳ **TODO**: 已分配 experiment_id，待启动
- 🚀 **Running**: 正在运行
- ✅ **Done**: 完成待写 exp.md
- 📚 **Archived**: 已归档

---

#### Formatting Requirements (通用格式要求):
- Use proper LaTeX syntax for math: `$R^2$`, `$\alpha$`, `$$...$$` for block formulas
- Use `$\log g$` or `log\_g` for variable names with underscores
- Tables should use standard Markdown format
- Mark missing info with `TODO`
- Use ❌/✅ for hypothesis verification results
- Include physical/scientific explanations where applicable

#### Before Submitting a Report, Verify:
- [ ] 选择了正确的模板（main vs exp）
- [ ] 所有必需章节都已填写
- [ ] LaTeX formulas render correctly
- [ ] Figures have descriptions and observations
- [ ] Verification questions have results filled in
- [ ] Conclusions include design implications
- [ ] （如果是 exp）核心结论速览已填写，便于同步到 main

### Author
- Default author: Viska Wei

## 🔬 Domain Context

This project focuses on:
- Stellar parameter prediction (log g, Teff, etc.) from spectra
- Linear regression baselines (Ridge, PCA)
- Feature selection (Top-K wavelength, importance analysis)
- Noise modeling and robustness
- Neural network architecture guidance

### Common Metrics
- R² (coefficient of determination)
- MAE (mean absolute error)
- RMSE (root mean squared error)
- Feature importance stability

### Typical Experimental Variables
- Noise levels (σ): 0.0, 0.1, 0.5, 1.0
- PCA dimensions: 5, 10, 50, 100, 200, 500
- Ridge alpha: 0.001 to 100
- Top-K features: 10, 50, 100, 200

## 📝 Writing Style
- Professional academic writing
- Concise and quantitative
- Use ❌/✅ for hypothesis verification
- Include physical explanations where applicable

---

## ❓ 进度查看 (Status Check)

### 触发词
- `?` / `？` / `status` / `进度` / `状态`

### 执行内容
当用户输入 `?` 时，整理并展示当前进度：

1. **📊 实验索引摘要** (`experiments_index/index.csv`)
   - 总实验数
   - 按 project 分组统计
   - 最近完成的 3 个实验

2. **📋 待办任务** (`status/next_steps.md`)
   - P0 高优先级任务
   - P1 中优先级任务

3. **📦 归档队列** (`status/archive_queue.md`)
   - 待归档文件数量
   - 前 3 个待归档项

4. **📝 最近更新** (`logg/`)
   - 最近 3 个修改的文档

### 输出格式示例
```
📊 实验追踪系统进度

═══════════════════════════════════════
📈 实验索引 (experiments_index/index.csv)
───────────────────────────────────────
总计: 15 个实验
├─ VIT: 10 个 (6 completed, 4 running)
└─ BlindSpot: 5 个 (3 completed, 2 running)

最近完成:
• VIT-20251201-cnn-01 (R2=0.992)
• BS-20251201-latent-01 (R2=0.598)

═══════════════════════════════════════
📋 待办任务 (status/next_steps.md)
───────────────────────────────────────
🔴 P0 (2):
  [ ] 完成 CNN 实验文档
  [ ] 补录 VIT 历史实验

🟡 P1 (3):
  [ ] 建立 BlindSpot 半自动流程
  ...

═══════════════════════════════════════
📦 归档队列 (3 个待归档)
───────────────────────────────────────
1. raw/MVP_EXPERIMENTS_FULL_REPORT.md → logg/gta/
2. raw/logg_from_encoder_experiment_report.md → logg/distill/
3. raw/mvp_implementation_summary.md → logg/NN/

═══════════════════════════════════════
📝 最近更新
───────────────────────────────────────
• logg/cnn/cnn_main_20251201.md (2h ago)
• logg/distill/exp_encoder_nn_logg_20251201.md (3h ago)
• logg/gta/exp_global_feature_tower_mlp_20251201.md (5h ago)

💡 快捷操作: sync | a | n | report
```

---

## 🚀 快速归档系统 (Quick Archive System)

### 触发词（极简）
当用户输入以下任意内容时，执行归档流程：
- `a` / `A` / `归档` / `archive`
- `a 1` / `归档 1` - 归档第 N 个
- `a all` / `归档 all` - 全部归档
- `s` / `归档状态` - 查看队列

---

## 🆕 新建实验计划 / 立项 (New Experiment)

### 触发词
- `n` / `N` / `new` / `新建` / `立项`
- 后面跟着实验的思考/计划/coding prompt

### 工作流程

#### Step 1: 解析用户输入
从用户的描述中提取：
- **实验主题** → 决定目标文件夹 (logg/[topic]/)
- **研究问题** → §1.1 实验目的
- **验证假设** → 链接到 hub.md 的假设（如果是新假设则创建）
- **实验设计思路** → §2 实验设计
- **预期结果** → §1.2 预期结果

#### Step 2: 创建/更新 hub.md（如果涉及新问题/假设）

**检查是否需要更新 hub**：
- 如果实验涉及**新的研究问题** → 添加到 hub.md §1 核心问题树
- 如果实验验证**新的假设** → 添加到 hub.md §2 假设金字塔（L3 微观假设）
- 如果是已有假设的延续实验 → 只更新 roadmap，不改 hub

**hub.md 更新内容**：
```markdown
## §1.2 问题分解（如有新问题）
├── Q新: [新问题] → ⏳ 待验证 [MVP-X.X]

## §2.3 L3 微观假设（如有新假设）
| H新.新 | [可验证假设] | H上层 | [验证标准] | ⏳ | - |
```

#### Step 3: 创建 exp.md（只填写实验前部分）

**✅ 填写的章节**：
- Header（实验名称、日期、状态=🔄进行中、**验证假设 H编号**）
- 🔗 上游链接（链接到 hub.md 的假设）
- §1 目标（实验目的、预期结果）
- §2 实验设计（数据、特征、模型、超参数、评价指标）

**⏳ 留空的章节**（等实验完成后填写）：
- ⚡ 核心结论速览
- §3 实验图表
- §4 关键洞见
- §5 结论
- §6.1 数值结果表

#### Step 4: 更新 roadmap.md
在对应的 `[topic]_roadmap.md` 中添加：

**§2.1 实验总览**：
```
| MVP-X.X | [实验名称] | Phase | ⏳ | [experiment_id] | [链接](./exp_xxx.md) |
```

**§3 MVP 详细设计**（如需要）：
```markdown
### MVP-X.X: [实验名称]
| 项目 | 配置 |
|------|------|
| **目标** | [一句话目标] |
| **验证假设** | H编号 |
| **数据** | [数据配置] |
| **模型** | [模型配置] |
| **验收标准** | [预期结果范围] |
```

### 文件命名
```
用户: n 测试不同 dilation rate 对 CNN 的影响
↓
创建: logg/cnn/exp_cnn_dilation_rate_20251204.md
更新: logg/cnn/cnn_roadmap.md §2.1, §3
更新: logg/cnn/cnn_hub.md §2.3（如果是新假设）
```

### 后续流程
```
n [实验计划]
     │
     ├─ 新假设？ → 更新 hub.md §1/§2
     │
     ├─ 创建 exp.md 框架
     │
     └─ 更新 roadmap.md §2.1, §3
           ↓
        跑实验
           ↓
        a 归档 → 填充 exp.md §3-6
           ↓
        更新 hub.md §3 洞见汇合站（如有重要发现）
```

### 示例 1：延续已有假设
```
用户: n 测试 MLP 隐藏层数量对 log g 预测的影响，
      验证假设 H1.2（非线性能带来提升）

AI: 📝 立项：延续已有假设 H1.2...

    ✅ 已创建: logg/NN/exp_mlp_hidden_layers_20251204.md
       - §1 目标: 测试隐藏层数量影响
       - §2 实验设计: 1/2/3/4 层, 256 units
       - 验证假设: H1.2
    
    ✅ 已更新: logg/NN/NN_roadmap.md
       - §2.1 添加 MVP-2.3
       - §3 添加详细设计
    
    ℹ️ hub.md 无需更新（H1.2 已存在）
    
    💡 实验完成后输入 `a` 归档
```

### 示例 2：新假设/新问题
```
用户: n 新想法：尝试用 attention 替代 pooling，
      假设：attention 能动态选择重要波段

AI: 📝 立项：检测到新假设...

    ✅ 已更新: logg/NN/NN_hub.md
       - §1.2 问题树添加: Q2.3 attention vs pooling
       - §2.3 添加假设: H2.3.1 attention 能动态选择波段
    
    ✅ 已创建: logg/NN/exp_attention_pooling_20251204.md
       - §1 目标: 对比 attention vs pooling
       - 验证假设: H2.3.1
    
    ✅ 已更新: logg/NN/NN_roadmap.md
       - §2.1 添加 MVP-3.1
       - §3 添加详细设计
    
    💡 实验完成后输入 `a` 归档
```

### 示例 3：全新主题（需要创建 hub + roadmap）
```
用户: n 开始研究 diffusion model 用于光谱去噪

AI: 📝 立项：检测到新主题 diffusion...

    🆕 已创建: logg/diffusion/diffusion_hub_20251204.md
       - §1 核心问题树: diffusion 能否用于光谱去噪？
       - §2 假设金字塔: H1 diffusion 适合光谱数据
    
    🆕 已创建: logg/diffusion/diffusion_roadmap_20251204.md
       - §1 Phase 总览: Phase 0 Baseline
       - §2.1 MVP 列表: MVP-0.0 baseline
    
    ✅ 已创建: logg/diffusion/exp_diffusion_baseline_20251204.md
       - §1 目标: 建立 baseline
       - 验证假设: H1.1
    
    💡 新主题已初始化！
```

### ⚠️ 立项注意事项（重要！）
- ❌ **不生成任何代码**（Python、Shell、配置文件等）
- ❌ 不执行实验
- ❌ 不创建训练脚本
- ✅ **只创建/更新文档文件**（.md）
- ✅ 产出：exp.md 框架 + hub.md 更新 + roadmap.md 更新

### 立项检查清单
- [ ] 确定是**新假设**还是**已有假设的延续**
- [ ] 如果是新假设，先更新 hub.md
- [ ] 创建 exp.md，填写目标和设计
- [ ] 更新 roadmap.md 的 MVP 列表和详细设计
- [ ] 为 exp.md 添加假设链接（便于追溯）
- [ ] ⚠️ 确认没有生成任何代码文件

---

## 📝 更新文档 (Update)

### 触发词
- `u` / `U` / `update` / `更新`
- 后面跟着要补充的信息/想法/发现

### 工作流程

#### Step 1: 智能匹配目标文件
根据用户输入的内容，自动匹配最相关的文件：
- 关键词匹配 → 找到对应 `logg/[topic]/` 目录
- 内容类型判断 → 决定更新 exp.md 还是 main.md
- 如果找不到匹配 → 按 `n` 流程创建新文件

#### Step 2: 找到合适的章节位置
| 内容类型 | 目标位置 |
|---------|---------|
| 新发现/洞见 | exp.md §4 关键洞见 或 **hub.md §3 洞见汇合站** |
| 设计建议 | exp.md §5.3 设计启示 或 **hub.md §5 设计原则库** |
| 数值结果 | exp.md §6.1 或 **roadmap.md §6.1 数值结果表** |
| 假设验证 | **hub.md §2 假设金字塔** |
| 战略方向 | **hub.md §4 战略导航** |
| 下一步计划 | exp.md §5.6 或 next_steps.md |
| MVP 进度 | **roadmap.md §4 进度追踪** |
| 通用笔记 | 相关文件的附录或新建笔记 |

#### Step 3: 更新文件
- 在合适位置插入/追加新内容
- 保持格式一致
- 更新"最后更新"时间戳

### 示例
```
用户: u CNN 实验发现 dilation=2 时感受野刚好覆盖典型吸收线宽度，
      这可能是性能最优的物理原因

AI: 📝 更新文档...
    🔍 匹配到: logg/cnn/exp_cnn_dilated_kernel_sweep_20251201.md
    ✅ 已添加到 §4.1 宏观层洞见:
       "dilation=2 时感受野覆盖典型吸收线宽度，物理解释性能最优"
    ✅ 已添加到 §5.4 物理解释
```

```
用户: u ridge 实验发现：alpha=10 效果最好

AI: 📝 更新文档...
    🔍 匹配到: logg/ridge/ridge_hub.md
    ✅ 已添加到 §3 洞见汇合站:
       "alpha=10 效果最好"
    ✅ 已添加到 §5 设计原则库
```

```
用户: u 新想法：尝试用 attention 机制替代 pooling

AI: 📝 未找到直接匹配的文件
    🆕 按 `n` 流程创建: logg/NN/exp_attention_pooling_20251201.md
```

### 匹配优先级
1. **精确匹配**：用户提到具体实验名/文件名
2. **主题匹配**：关键词匹配 topic (cnn, ridge, pca...)
3. **最近编辑**：同主题下最近修改的文件
4. **创建新文件**：无匹配时

### ⚠️ 核心理解：归档 ≠ 移动文件

**归档的真正含义是：根据 raw 文件的内容，按 exp.md 模板重新撰写结构化报告**

- ❌ 不是：简单复制/移动文件
- ✅ 而是：阅读原始文件 → 提取关键信息 → 按 exp.md 模板重写报告

### 归档流程

#### Step 1: 检查归档队列
```
读取: status/archive_queue.md
```

#### Step 2: 撰写实验报告（核心步骤）
1. **仔细阅读**源文件 (raw/ 中的原始实验结果)
2. **按 template/exp.md 模板**撰写结构化报告（前 300 行是核心信息）：
   - 提取核心结论 → ⚡核心结论速览（一句话 + 关键数字）
   - 提取实验设计 → §2 实验设计
   - 提取图表说明 → §3 实验图表
   - 提取洞见分析 → §4 关键洞见
   - 提取设计建议 → §5.3 设计启示
   - 总结关键数字 → §5.5 关键数字速查
   - 提取数值结果 → §6.1 数值结果表（附录）
   - 提取执行流程 → §6.2 实验流程记录（附录）
3. **保存报告**到 `logg/[topic]/exp_[name]_YYYYMMDD.md`

#### Step 3: 更新 roadmap.md 和 hub.md
   - roadmap.md §2.1 实验总览 中添加新实验条目
   - roadmap.md §4.2 核心结论快照 中添加条目
   - hub.md §3 洞见汇合站 中添加新洞见（如有）

#### Step 3: 归档后检查（必须执行）
完成报告后，必须进行以下检查：

**📋 信息完整性检查清单**：
- [ ] 核心结论是否提取？（一句话总结）
- [ ] 最佳配置/参数是否记录？
- [ ] 关键数值结果是否完整？（R², MAE, RMSE 等）
- [ ] 实验设计细节是否清晰？
- [ ] 设计启示/建议是否总结？
- [ ] 与原文对比，是否有遗漏的重要发现？

#### Step 4: 移动原始文件到 processed
确认无遗漏后，**移动已归档的 raw 源文件到 processed 目录**：
```
移动: raw/[已归档文件].md → processed/raw/[已归档文件].md
更新: status/archive_queue.md（移至已归档区域）
```

### 报告命名规则
```
源文件: raw/CNN_DILATED_EXPERIMENTS_FULL_REPORT.md
↓
归档到: logg/cnn/exp_cnn_dilated_experiments_20251201.md
同步到: logg/cnn/cnn_roadmap.md + cnn_hub.md
移动源: raw/... → processed/raw/... ✓
```

### 原始报告目录
| 源目录 | 说明 |
|--------|------|
| `raw/` | 所有待归档的原始实验结果 |

**归档目标自动推断**：根据文件名关键词判断归档到哪个 logg 子目录：
- `cnn`, `dilated`, `conv` → `logg/cnn/`
- `mlp`, `nn`, `residual` → `logg/NN/`
- `ridge`, `topk` → `logg/ridge/`
- `pca` → `logg/pca/`
- `distill`, `latent`, `probe`, `pool` → `logg/distill/`
- `train`, `val` → `logg/train/`
- `gta`, `global` → `logg/gta/`

### 关键提取项清单
从原始报告中**必须提取**以下信息到 exp.md：

| 提取项 | 目标位置 | 重要性 |
|--------|----------|--------|
| 核心结论一句话 | §核心结论速览 | 🔴 必须 |
| 假设验证结果 | §核心结论速览 | 🔴 必须 |
| 最佳配置/参数 | §5.5 关键数字速查 | 🔴 必须 |
| 完整数值结果 | §6.1 数值结果表 | 🔴 必须 |
| 实验设计细节 | §2 实验设计 | 🟡 重要 |
| 关键图表说明 | §3 实验图表 | 🟡 重要 |
| 设计建议/启示 | §5.3 设计启示 | 🟡 重要 |
| 物理解释 | §5.4 物理解释 | 🟢 可选 |

### 示例对话
```
用户: a
AI: 📋 当前归档队列 (11个):
    1. raw_vit/CNN_DILATED_EXPERIMENTS_FULL_REPORT.md → logg/cnn/
    2. raw_vit/NN_RESULTS_SUMMARY.md → logg/NN/
    ...
    要归档哪个？(输入序号或 "all")

用户: 1
AI: 📖 正在阅读原始报告...
    ✍️ 按 exp.md 模板撰写实验报告...
    ✅ 已创建: logg/cnn/exp_cnn_dilated_experiments_20251201.md
    ✅ 已更新: logg/cnn/cnn_roadmap.md §2.1
    ✅ 已更新: logg/cnn/cnn_hub.md §3 洞见汇合站
    
    📋 信息完整性检查:
    - [x] 核心结论: "Dilated CNN 在 K=3 时达到最佳 R²=0.987"
    - [x] 最佳配置: dilation=2, kernel=5, layers=3
    - [x] 数值结果: 完整记录 12 组实验
    - [x] 设计启示: 2 条建议已提取
    
    📦 已移动源文件: raw_vit/... → processed/raw_vit/...
    ✅ 归档完成！
```

---

## 🌐 跨仓库实验管理 (Cross-Repo Experiment Management)

### 仓库架构

```
~/VIT/                      # 训练仓库 - 跑实验
~/BlindSpotDenoiser/        # 训练仓库 - 去噪/latent 实验
~/SpecDiffusion/            # 训练仓库 - diffusion 实验
~/Physics_Informed_AI/      # 知识中心 - 唯一的知识沉淀出口
```

### ⚠️ 跨仓库写入规则（重要！）

**问题**：Cursor 在跨仓库写入时会弹出确认框，打断工作流。

**解决方案**：从代码仓库写入知识中心时，必须使用终端命令写入！

```bash
# ✅ 正确方式：使用终端命令
KNOWLEDGE_CENTER="/home/swei20/Physics_Informed_AI"

# 方法 1: cat + heredoc（推荐）
cat << 'EOF' > "$KNOWLEDGE_CENTER/logg/[topic]/exp_xxx.md"
[报告内容]
EOF

# 方法 2: 复制文件
cp ./local_report.md "$KNOWLEDGE_CENTER/logg/[topic]/"

# 方法 3: echo 追加
echo "| experiment_id | topic | date |" >> "$KNOWLEDGE_CENTER/status/kanban.md"
```

```
❌ 禁止：使用 IDE 编辑功能直接跨仓库写入（会触发确认弹窗）
✅ 必须：使用终端命令（cat/cp/echo/tee）写入到知识中心
```

### 核心目录结构

```
Physics_Informed_AI/
├── experiments_index/      # 📊 跨仓库实验索引
│   ├── index.csv           # 主索引文件
│   ├── index.json          # JSON 格式（脚本友好）
│   └── README.md
├── status/
│   ├── archive_queue.md    # 归档队列
│   └── next_steps.md       # 🆕 跨仓库待办清单
├── reports/                # 🆕 自动汇报系统
│   ├── last_report.json
│   ├── history.csv
│   └── drafts/
├── template/
│   ├── main.md
│   ├── exp.md
│   ├── next.md
│   └── knowledge_card.md   # 🆕 浓缩知识卡片模板
└── scripts/
    ├── register_experiment.py    # 🆕 实验登记
    ├── scan_vit_experiments.py   # 🆕 VIT 扫描
    ├── scan_blindspot_experiments.py  # 🆕 BlindSpot 扫描
    ├── generate_report.py        # 🆕 报告生成
    └── sync_experiments.sh       # 🆕 一键同步
```

### Experiment ID 命名规范

```
[PROJECT]-[YYYYMMDD]-[topic]-[序号]
```

**示例**:
- `VIT-20251201-cnn-dilated-01`
- `VIT-20251201-swin-attention-01`
- `BS-20251201-latent-probe-01`

---

## 🔄 同步实验 (Sync Experiments)

### 触发词
- `sync` / `同步` / `scan`

### 工作流程

```bash
# 一键同步所有仓库
./scripts/sync_experiments.sh

# 仅预览，不实际登记
./scripts/sync_experiments.sh --dry-run

# 只同步某个日期之后的
./scripts/sync_experiments.sh --since "2025-11-28"
```

### 示例对话
```
用户: sync

AI: 🔄 同步实验...
    📁 扫描 VIT 仓库...
    ✨ 发现 5 个新实验
    
    📁 扫描 BlindSpotDenoiser 仓库...
    ✨ 发现 2 个新实验
    
    ✅ 已更新: experiments_index/index.csv
    📊 共 7 个新实验已登记
```

---

## 📝 登记实验 (Register Experiment)

### 触发词
- `reg` / `register` / `登记`

### 命令格式
```bash
python scripts/register_experiment.py \
    --experiment_id "VIT-20251201-cnn-dilated-01" \
    --project VIT \
    --topic cnn \
    --status completed \
    --metrics_summary "R2=0.987, MAE=0.031"
```

### 示例对话
```
用户: reg VIT cnn 实验完成，R2=0.992

AI: 📝 登记实验...
    ✅ 已登记: VIT-20251201-cnn-01
       project: VIT
       topic: cnn
       status: completed
       metrics: R2=0.992
    
    📊 已更新: experiments_index/index.csv
    💡 下一步: 创建 logg/cnn/exp_xxx.md 文档
```

---

## 📊 生成报告 (Generate Report)

### 触发词
- `report` / `汇报` / `脑暴报告`
- `report new` - 强制生成新报告（即使无更新）

### 报告文件结构

```
reports/
├── report_history.md           # 📋 报告历史 + 实验快照
└── drafts/
    └── gpt_brainstorm_YYYYMMDD_HHMM.md  # 带时间戳的报告
```

### 工作流程

```
用户: report
    │
    ├─ 1. 读取 reports/report_history.md 的「上次快照」
    │
    ├─ 2. 对比 status/kanban.md 的 Archived 列表
    │
    ├─ 有新实验？
    │   ├─ ✅ 是 → 生成新报告 gpt_brainstorm_YYYYMMDD_HHMM.md
    │   │         更新 report_history.md 快照
    │   │
    │   └─ ❌ 否 → 提示「无新实验」
    │             返回上次报告位置
    │
    └─ 3. 输出报告路径，提示复制给 GPT
```

### 示例对话（有新实验）

```
用户: report

AI: 📊 检查实验更新...
    🔍 上次报告: 2025-12-01 16:00 (包含 8 个实验)
    ✨ 发现 2 个新实验:
       - VIT-20251201-gta-fusion-01
       - BS-20251201-distill-finetune-01
    
    📝 生成新报告...
    ✅ 已生成: reports/drafts/gpt_brainstorm_20251201_1830.md
    
    💡 使用方法: 复制全文到 ChatGPT/Claude 进行深度讨论
```

### 示例对话（无新实验）

```
用户: report

AI: 📊 检查实验更新...
    🔍 上次报告: 2025-12-01 16:00 (包含 8 个实验)
    ⚠️ 自上次报告后没有新归档的实验
    
    📁 上次报告位置:
       reports/drafts/gpt_brainstorm_20251201_1600.md
    
    💡 如需强制生成新报告，请使用 `report new`
```

### 报告内容

| 章节 | 说明 |
|------|------|
| 核心结论汇总 | 按 topic 分组的实验总结 |
| 性能对比矩阵 | 跨实验横向对比 |
| 已验证假设 | 假设验证状态 |
| 待解答问题 | 优先级排序的问题 |
| 洞见与模式 | 跨实验规律 |
| 给 GPT 的思考提示 | 引导 GPT 深度分析 |

### 模板位置
`_backend/template/gpt_brainstorm.md`

---

## 📇 知识卡片 (Knowledge Card)

### 触发词
- `card` / `卡片` / `kc`

### 用途
比 exp.md 更短的知识条目，用于快速提炼实验发现。

### 模板
`template/knowledge_card.md`

### 示例对话
```
用户: card CNN dilation 实验结论

AI: 📇 创建知识卡片...
    ✅ 已创建: logg/cnn/kc_cnn_dilation_20251201.md
    
    内容预览:
    🎯 问题: dilation rate 对 CNN 性能的影响
    📊 关键结果: dilation=2 最优，R²=0.992
    💡 洞见: 感受野匹配吸收线宽度
    ➡️ 下一步: 测试 multi-scale dilation
```

---

## 📌 下一步计划 (Next Steps)

### 触发词
- `next` / `下一步` / `计划` - 查看/生成下一步计划
- `todo` / `待办` - 管理待办任务

### 文件位置
`status/next_steps.md`

---

### 🔍 查看下一步 (`next`)

```
用户: next

AI: 📋 当前下一步计划:
    
    🔴 P0 — 高优先级 (2):
    1. [ ] 补录 VIT 历史实验到 index.csv
    2. [ ] 完成 CNN 实验文档
    
    🟡 P1 — 中优先级 (2):
    1. [ ] 为 CNN dilated 实验写 knowledge card
    2. [ ] 建立 BlindSpot 半自动流程
    
    💡 操作: next add | next done | next plan
```

---

### ➕ 添加任务 (`next add`)

```
用户: next add P0 完成 Swin attention 实验分析

AI: ✅ 已添加到 P0:
    - [ ] 完成 Swin attention 实验分析
    
    📝 已更新: status/next_steps.md
```

```
用户: next add P1 测试更大的 alpha 范围

AI: ✅ 已添加到 P1:
    - [ ] 测试更大的 alpha 范围
```

---

### ✅ 完成任务 (`next done`)

```
用户: next done 1

AI: ✅ 任务已完成:
    - [x] 补录 VIT 历史实验到 index.csv
    
    📦 已移至「已完成」区域
```

```
用户: next done "CNN 实验文档"

AI: ✅ 任务已完成:
    - [x] 完成 CNN 实验文档
```

---

### 🧠 智能计划 (`next plan`)

**触发词**: `next plan` / `计划下一步` / `建议`

**作用**: 基于最近实验结果，AI 智能推荐下一步计划

```
用户: next plan

AI: 🧠 分析最近实验结果...
    
    📊 最近完成的实验:
    - VIT-20251201-cnn-dilated-01 (R²=0.992)
    - BS-20251201-latent-probe-01 (R²=0.598)
    
    📝 最近更新的文档:
    - logg/cnn/exp_cnn_dilated_kernel_sweep_20251201.md
    - logg/distill/exp_latent_extraction_logg_20251201.md
    
    💡 建议的下一步计划:
    
    🔴 P0 (建议):
    1. CNN dilation=2 效果最优，建议：
       → 测试 multi-scale dilation (1,2,4 组合)
    2. Latent probe R²=0.598 偏低，建议：
       → 尝试非线性 probe (MLP) 或增加 latent 维度
    
    🟡 P1 (建议):
    1. 写 CNN dilation 实验的 knowledge card
    2. 对比 VIT CNN vs BlindSpot Latent 的信息量
    
    是否添加到 next_steps.md？(y/n/选择序号)
```

```
用户: y

AI: ✅ 已添加 4 个建议任务到 next_steps.md
```

---

### 📊 从实验结果生成计划 (`next from`)

```
用户: next from logg/cnn/exp_cnn_dilated_kernel_sweep_20251201.md

AI: 📖 分析实验报告...
    
    📌 实验结论:
    - dilation=2 达到最佳 R²=0.992
    - 感受野匹配吸收线宽度
    
    💡 建议的下一步:
    
    1. 🔴 P0: 测试 dilation=2 在不同噪声水平下的鲁棒性
    2. 🟡 P1: 尝试 multi-scale dilation 架构
    3. 🟡 P1: 与 Swin Transformer 的 attention 机制对比
    
    是否添加？(y/n)
```

---

### 工作流程

```
1. 完成实验
      ↓
2. next plan - AI 分析并建议下一步
      ↓
3. next add - 添加认可的任务
      ↓
4. 执行实验
      ↓
5. next done - 标记完成
      ↓
6. 循环...
```

---

### 快捷操作汇总

| 命令 | 作用 |
|------|------|
| `next` | 查看当前计划 |
| `next add P0/P1 [描述]` | 添加任务 |
| `next done [序号/描述]` | 完成任务 |
| `next plan` | AI 智能推荐 |
| `next from [文件]` | 从实验报告生成 |
| `next clear done` | 清理已完成任务 |

---

## 🔗 跨仓库工作流总结

### 完整工作流

```
1. 在 VIT/BlindSpot 跑实验
   ↓
2. sync - 同步实验到 index.csv
   ↓
3. reg - 补充 metrics 信息（可选）
   ↓
4. n - 创建 exp.md 框架
   ↓
5. a - 归档结果到 exp.md
   ↓
6. card - 提炼知识卡片（可选）
   ↓
7. report - 生成周报
```

### 快捷命令对照表

| 命令 | 作用 | 文件 |
|------|------|------|
| `sync` | 同步实验索引 | `experiments_index/index.csv` |
| `reg` | 登记单个实验 | `experiments_index/index.csv` |
| `n` | 新建实验计划 | `logg/[topic]/exp_*.md` |
| `a` | 归档实验结果 | `logg/[topic]/exp_*.md` |
| `u` | 更新文档 | 智能匹配 |
| `p` | 生成 Coding Prompt 🆕 | `_backend/template/coding_prompt.md` |
| `merge` | 合并相似实验 🆕 | `logg/[topic]/exp_[topic]_consolidated_*.md` |
| `card` | 创建知识卡片 | `logg/[topic]/kc_*.md` |
| `todo` | 管理待办 | `status/next_steps.md` |
| `report` | 生成报告 | `reports/drafts/` |
| `session` | GPT 会话归档 | `logg/[topic]/sessions/` |
| `kb` | 实验看板 | `status/kanban.md` |

---

## 🔀 合并实验 (Merge Experiments) 🆕

### 触发词
- `merge` / `合并` / `整合`
- `merge [描述]` - 根据描述智能匹配并合并相关实验

### 用途
**把多个相似目的的子实验合并成一份综合报告**

解决的问题：
- 多次子实验的结论碎片化，难以形成全局视角
- 需要跨 noise level / 跨参数段 / 跨模型的综合对比
- 为汇报/分享生成统一可复现的 summary

### 模板
`_backend/template/consolidated.md`

### 工作流程

```
用户: merge [描述]
    │
    ├─ 1. 解析描述，提取关键词
    │      - topic 关键词 → 确定 logg/[topic]/ 目录
    │      - 合并维度 → noise_level / lr / data_size / model_type
    │
    ├─ 2. 扫描目录，匹配相关实验
    │      - 读取 logg/[topic]/exp_*.md 文件
    │      - 根据文件名/内容匹配描述
    │      - 列出候选文件供用户确认
    │
    ├─ 3. 提取各实验的关键信息
    │      - ⚡ 核心结论速览
    │      - §5.5 关键数字速查
    │      - §6.1 数值结果表
    │      - 最佳配置/参数
    │
    ├─ 4. 按 consolidated.md 模板生成综合报告
    │      - §3 Core Findings: 汇总关键洞见
    │      - §4 Detailed Comparison: 跨实验对比表
    │      - §5 Failed Experiments: 失败实验教训
    │      - §6 Recommended Best Setting: SOTA 配置
    │
    └─ 5. 输出到 logg/[topic]/exp_[topic]_consolidated_YYYYMMDD.md
```

### 示例对话

#### 示例 1：合并 LightGBM 噪声实验

```
用户: merge 在不同noise_level下best lightgbm config

AI: 🔀 合并实验...

    🔍 解析描述:
    - Topic: lightgbm
    - 合并维度: noise_level
    - 目标: best config
    
    📁 扫描 logg/lightgbm/...
    ✨ 找到 5 个相关实验:
    
    | # | File | Noise Levels | Key Result |
    |---|------|--------------|------------|
    | 1 | exp_lightgbm_noise_sweep_lr_20251204.md | 0.1-1.0 | lr=0.1 恒定最优 |
    | 2 | exp_lightgbm_100k_noise_sweep_20251205.md | 0.1-2.0 | 100k 超越 32k |
    | 3 | exp_lightgbm_100k_tree_limit_20251207.md | 0-1.0 | n=2500 推荐 |
    | 4 | exp_lightgbm_hyperparam_sweep_20251129.md | noiseless | baseline |
    | 5 | exp_lightgbm_summary_20251205.md | 汇总 | 参考 |
    
    选择要合并的实验 (输入序号，如 1,2,3 或 all):
```

```
用户: 1,2,3

AI: 📖 读取实验报告...
    
    ✍️ 生成综合报告...
    
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    📊 核心发现预览
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    
    ⭐ 一句话总结:
    "noise ≤ 0.5 时 lr=0.05 最优，noise > 0.5 时 lr=0.1 更稳健；
     100k 数据需要 n_estimators=2500+，增益随噪声增大"
    
    📊 跨 Noise Level 最佳配置:
    | Noise σ | Best R² | Best lr | n_estimators | Source |
    |---------|---------|---------|--------------|--------|
    | 0.0 | 0.999 | 0.05 | 5000 | exp_tree_limit |
    | 0.1 | 0.972 | 0.05 | 2218 | exp_tree_limit |
    | 0.2 | 0.932 | 0.05 | 3608 | exp_tree_limit |
    | 0.5 | 0.757 | 0.05 | 3855 | exp_tree_limit |
    | 1.0 | 0.558 | 0.05 | 2140 | exp_tree_limit |
    
    🧭 推荐 SOTA 配置:
    - lr=0.05, n_estimators=2500, num_leaves=31
    
    ✅ 已保存: logg/lightgbm/exp_lightgbm_consolidated_20251209.md
    
    💡 报告包含 8 个章节，详见文件
```

#### 示例 2：合并特定参数 sweep

```
用户: merge lightgbm learning rate sweep 结果

AI: 🔀 合并实验...
    
    🔍 解析描述:
    - Topic: lightgbm
    - 合并维度: learning_rate
    
    📁 找到 2 个相关实验:
    | # | File | lr Range |
    |---|------|----------|
    | 1 | exp_lightgbm_noise_sweep_lr_20251204.md | 0.02, 0.05, 0.1 |
    | 2 | exp_lightgbm_100k_noise_sweep_20251205.md | 0.05, 0.1, 0.3 |
    
    选择要合并的实验 (1,2 或 all):
```

### 匹配规则

#### 关键词 → Topic 映射

| 关键词 | Topic 目录 |
|--------|-----------|
| `lightgbm`, `lgb`, `gbm` | `logg/lightgbm/` |
| `cnn`, `dilated`, `conv` | `logg/cnn/` |
| `ridge`, `linear` | `logg/ridge/` |
| `pca`, `降维` | `logg/pca/` |
| `moe`, `mixture` | `logg/moe/` |
| `nn`, `mlp`, `neural` | `logg/NN/` |

#### 合并维度识别

| 描述关键词 | 合并维度 |
|-----------|---------|
| `noise`, `噪声`, `σ` | 跨 noise_level |
| `lr`, `learning rate` | 跨 learning_rate |
| `tree`, `n_estimators` | 跨模型容量 |
| `data`, `100k`, `32k` | 跨数据量 |
| `config`, `best` | 最佳配置汇总 |

### 输出位置
```
logg/[topic]/exp_[topic]_consolidated_YYYYMMDD.md
```

例如：
- `logg/lightgbm/exp_lightgbm_consolidated_20251209.md`
- `logg/cnn/exp_cnn_noise_consolidated_20251209.md`

### 与其他命令的关系

```
多个 exp.md 完成
    │
    ├─ [merge] → consolidated.md (综合报告)
    │
    ├─ [card] → knowledge_card.md (单点知识提炼)
    │
    └─ [report] → gpt_brainstorm.md (给 GPT 的报告)
```

### 合并报告必须包含的章节

| 章节 | 内容 | 重要性 |
|------|------|--------|
| §1 Purpose | 为什么合并、核心问题 | 🔴 必须 |
| §2 Included Experiments | 被合并的实验列表 | 🔴 必须 |
| §3 Core Findings | 关键洞见 bulletpoints | 🔴 必须 |
| §4 Detailed Comparison | 跨维度对比表 | 🔴 必须 |
| §5 Failed Experiments | 失败实验 + 教训 | 🟡 重要 |
| §6 Recommended Best Setting | SOTA 配置 + 代码 | 🔴 必须 |
| §7 Visual Summary | 关键图表引用 | 🟡 重要 |
| §8 Appendix | 完整数值表、时间线 | 🟢 可选 |

---

## 🤖 生成 Coding Prompt (Generate Coding Prompt) 🆕

### 触发词
- `p` / `P` / `prompt` / `生成prompt`
- `p [experiment_id]` - 为指定实验生成 prompt

### 用途
**在 session 脑暴后，将选中的 MVP 转化为可执行的 Coding Prompt**

解决的问题：
- 每次手写实验 prompt 太繁琐
- 忘记指定图表要求、交付物、抄送位置
- 两份报告（process + exp）的产出不清晰

### 模板
`_backend/template/coding_prompt.md`

### 工作流程

```
session.md (选中 MVP)
    ↓
p [experiment_id]  →  生成 coding_prompt
    ↓
复制给 Cursor / Coding Agent
    ↓
执行实验
    ↓
产出: exp.md
    ↓
更新 kanban + roadmap.md + hub.md (洞见)
```

### Prompt 必须包含的内容

| 内容 | 说明 |
|------|------|
| **experiment_id** | 实验唯一标识 |
| **实验设定** | 数据、模型、训练配置 |
| **要画的图** | 图表类型、坐标轴、保存路径 |
| **交付物** | exp.md（按模板，含流程 + 结果）+ 图表 |
| **抄送位置** | kanban.md、main.md |

### 示例对话

```
用户: p VIT-20251203-moe-piecewise-01

AI: 🤖 生成 Coding Prompt...

    ✅ 已生成实验 prompt:
    
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    📋 实验规格
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    experiment_id: VIT-20251203-moe-piecewise-01
    MVP: MVP-1.1
    仓库: ~/VIT
    
    📊 要画的图:
    1. 分段 Ridge 拟合曲线
    2. 各段 R² 对比柱状图
    3. 残差分布图
    
    📦 交付物:
    - 实验报告: logg/moe/exp_moe_piecewise_20251203.md
      ⚠️ 按 exp.md 模板输出，必须包含 §3 实验流程
    - 图表: logg/moe/img/
    
    📬 抄送位置:
    - status/kanban.md → Done
    - logg/moe/moe_roadmap.md §2.1
    - logg/moe/moe_hub.md §3 (如有重要洞见)
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    
    💡 复制以上内容给 Cursor 执行实验
```

### 与 session.md 的关系

```
session.md §3 选择要执行的实验
    ↓
确定 experiment_id
    ↓
p [experiment_id]  →  生成完整 prompt
    ↓
session.md §4 Prompt 草稿区 可以保存生成的 prompt
```

---

## 💬 GPT 会话归档 (Session Archive)

### 触发词
- `session` / `会话` / `gpt`
- `session new [topic]` - 创建新会话
- `session list` - 列出最近会话
- `session [topic]` - 查看/编辑特定 topic 的会话

### 用途
**把 GPT 脑暴对话 → 结构化成可执行实验**

解决的问题：
- idea/GPT 对话只存在于聊天记录，难以回溯
- 从 idea → 可执行 MVP → experiment_id 这一段全靠脑补

### 模板
`_backend/template/session.md`

### 工作流程

```
GPT 讨论结束
    ↓
session new [topic]  →  创建 session_YYYYMMDD_[topic].md
    ↓
GPT 按模板重构对话内容
    ↓
从 session 中选择要执行的 MVP
    ↓
生成 experiment_id，填入 kanban
```

### 示例对话

```
用户: session new gta-fusion

AI: 💬 创建 GPT 会话归档...
    ✅ 已创建: logg/gta/sessions/session_20251201_gta_fusion.md
    
    📝 请用以下模板归档本次 GPT 对话:
    - §1 起点：问题 & 动机
    - §2 MVP 候选列表
    - §3 选择要执行的实验
    - §4 Prompt 草稿区
    
    💡 归档后记得把选中的 experiment_id 填入 kanban
```

```
用户: session list

AI: 📋 最近的 GPT 会话:
    
    logg/gta/sessions/
    ├── session_20251201_gta_fusion.md (今天)
    └── session_20251130_gta_baseline.md (昨天)
    
    logg/cnn/sessions/
    └── session_20251201_cnn_dilated.md (今天)
```

### Session 文件结构

```
logg/[topic]/sessions/
├── session_20251201_[subtopic].md   # 会话归档
├── session_20251130_[subtopic].md
└── ...
```

### 与其他文件的关系

| 来源 | 去向 | 说明 |
|------|------|------|
| GPT 对话 | → session.md | 归档讨论内容 |
| session.md | → kanban.md | 选中的 MVP 转为 experiment_id |
| session.md | → exp.md | exp 链接回 session 作为来源追溯 |

---

## 📌 实验看板 (Experiment Kanban)

### 触发词
- `kb` / `kanban` / `看板`
- `kb add [experiment_id]` - 添加实验到 TODO
- `kb move [id] [状态]` - 移动实验状态
- `kb status` - 查看当前看板

### 用途
**从 idea 里挑出要跑的实验，跟踪状态**

### 文件位置
`status/kanban.md`

### 看板状态流

```
💡 Inbox → ⏳ TODO → 🚀 Running → ✅ Done → 📚 Archived
```

### 示例对话

```
用户: kb

AI: 📌 实验看板 (status/kanban.md)
    
    📊 状态统计:
    ├─ 💡 Inbox: 3
    ├─ ⏳ TODO: 2
    ├─ 🚀 Running: 0
    ├─ ✅ Done: 0
    └─ 📚 Archived: 8
    
    ⏳ TODO (待跑):
    | experiment_id | topic | 优先级 |
    |---------------|-------|--------|
    | VIT-20251201-gta-fusion-01 | gta | 🔴 P0 |
    | BS-20251201-latent-gta-01 | distill | 🔴 P0 |
    
    💡 操作: kb add | kb move | kb start
```

```
用户: kb start VIT-20251201-gta-fusion-01

AI: 🚀 启动实验...
    ✅ 已移动到 Running:
       experiment_id: VIT-20251201-gta-fusion-01
       开始时间: 2025-12-01 15:30
    
    📝 请记录运行路径: ~/VIT/lightning_logs/version_X
```

```
用户: kb done VIT-20251201-gta-fusion-01 R2=0.95

AI: ✅ 实验完成!
    已移动到 Done:
    - experiment_id: VIT-20251201-gta-fusion-01
    - 主指标: R²=0.95
    - 状态: ⏳ 待写 exp.md
    
    💡 下一步: 使用 `a` 命令归档到 exp.md
```

### 快捷操作

| 命令 | 作用 |
|------|------|
| `kb` | 查看看板状态 |
| `kb add [id]` | 添加实验到 TODO |
| `kb start [id]` | 移动到 Running |
| `kb done [id] [metrics]` | 移动到 Done |
| `kb archive [id]` | 移动到 Archived |
| `kb idea [描述]` | 添加到 Inbox |

### 与其他系统的集成

```
session.md (选中的 MVP)
    ↓ [kb add]
kanban.md TODO
    ↓ [kb start]
kanban.md Running
    ↓ [kb done]
kanban.md Done
    ↓ [a 归档]
kanban.md Archived + exp.md
```

---

## 🔄 七层闭环系统架构（更新版）

### 层级总览

```
┌─────────────────────────────────────────────────────────────┐
│ Layer 1: 💬 Idea & GPT 会话层                                │
│          sessions/session_*.md                              │
│          把脑暴 + GPT 对话 → 结构化 MVP                       │
├─────────────────────────────────────────────────────────────┤
│ Layer 2a: 🧠 智库导航层 (Hub) 🆕                             │
│          logg/[topic]/[topic]_hub.md                        │
│          问题树、假设金字塔、洞见汇合、战略导航                │
├─────────────────────────────────────────────────────────────┤
│ Layer 2b: 🗺️ 实验追踪层 (Roadmap) 🆕                         │
│          logg/[topic]/[topic]_roadmap.md                    │
│          MVP 列表、进度追踪、跨仓库集成、数值结果              │
├─────────────────────────────────────────────────────────────┤
│ Layer 3: 📌 实验队列/看板层                                  │
│          status/kanban.md                                   │
│          从 idea 挑选 → 分配 ID → 跟踪状态                   │
├─────────────────────────────────────────────────────────────┤
│ Layer 4: 📗 单实验层                                         │
│          logg/[topic]/exp_*.md                              │
│          前300行=核心信息，附录=流程+完整数据                  │
├─────────────────────────────────────────────────────────────┤
│ Layer 5: 📇 知识卡片层                                       │
│          logg/[topic]/card_*.md                             │
│          把成熟结果浓缩成 1 页                               │
├─────────────────────────────────────────────────────────────┤
│ Layer 6: 📅 日常节奏层                                       │
│          status/next_steps.md + next.md                     │
│          昨日回顾 + 今日计划                                 │
└─────────────────────────────────────────────────────────────┘
```

### 信息流（更新版）

```
GPT 讨论 (Layer 1)
    │
    ├─ [session new] → sessions/session_*.md
    │
    ▼
规划实验 (Layer 2b)
    │
    ├─ 更新 roadmap.md 的 MVP 列表
    │
    ▼
选择 MVP (Layer 3)
    │
    ├─ [kb add] → kanban.md TODO
    ├─ [p] → 生成 coding_prompt
    │
    ▼
执行实验 (Layer 4)
    │
    ├─ [kb start] → kanban.md Running
    ├─ [执行 coding_prompt] → 按 exp.md 模板产出报告
    ├─ [实验完成] → kanban.md Done
    ├─ [a 归档] → exp.md
    │
    ▼
汇合洞见 (Layer 2a) 🆕
    │
    ├─ 单点发现 → hub.md §3 洞见汇合站
    ├─ 假设验证 → hub.md §2 假设金字塔
    ├─ 战略决策 → hub.md §4 战略导航
    │
    ▼
提炼结论 (Layer 5)
    │
    ├─ [card] → knowledge_card.md
    ├─ 设计原则 → hub.md §5 设计原则库
    │
    ▼
规划下一步 (Layer 6)
    │
    ├─ [next plan] → next_steps.md
    │
    ▼
喂给 GPT 深度思考
    │
    └─ 产生新的 sessions/，闭环 ↑
```

### 各层分工

| 层级 | 文件 | 职责 | 更新频率 |
|------|------|------|---------|
| Layer 1 | sessions/*.md | GPT 对话归档 | 每次深度讨论后 |
| **Layer 2a** | **hub.md** | **问题树、假设、洞见汇合、战略** | 每批 MVP 完成后 |
| **Layer 2b** | **roadmap.md** | **MVP 规格、进度、数值结果** | 每个 MVP 状态变更时 |
| Layer 3 | kanban.md + coding_prompt | 实验队列 + 执行 prompt | 每天多次 |
| Layer 4 | exp.md | 前300行=核心洞见，附录=流程+数据 | 每个实验完成后 |
| Layer 5 | card.md | 成熟结论提炼 | 重要结论稳定后 |
| Layer 6 | next_steps.md | 今日/明日计划 | 每天 |

### Hub vs Roadmap 职责边界（重要）🆕

**hub.md（智库）做**：
- ✅ 问题树：层级化的问题结构
- ✅ 假设金字塔：宏观→中观→微观
- ✅ 洞见汇合：多实验单点发现→综合结论
- ✅ 战略导航：推荐下一步方向
- ✅ 设计原则：可复用的原则和关键数字

**roadmap.md（追踪）做**：
- ✅ Phase 规划和依赖图
- ✅ MVP 实验列表和详细设计
- ✅ 进度追踪（看板视图、时间线）
- ✅ 跨仓库集成（experiment_id）
- ✅ 数值结果汇总表

**核心区别**：
- Hub = 「我们知道了什么？下一步该往哪走？」（**战略**）
- Roadmap = 「我们计划跑哪些实验？进度如何？」（**执行**）

