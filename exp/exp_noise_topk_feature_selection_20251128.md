# ğŸ“˜ å™ªå£°é²æ£’æ€§ä¸ Top-K ç‰¹å¾é€‰æ‹©å®éªŒæŠ¥å‘Š

---
> **å®éªŒåç§°ï¼š** Noise Robustness & Top-K Feature Selection for log_g Prediction  
> **ä½œè€…ï¼š** Viska Wei  
> **æ—¥æœŸï¼š** 2025-11-28  
> **æ•°æ®ç‰ˆæœ¬ï¼š** VIT Synthetic Spectra (4096-D)  
> **æ¨¡å‹ç‰ˆæœ¬ï¼š** LightGBM / Ridge / LinearRegression  

---

# 1. ğŸ¯ ç›®æ ‡

## 1.1 èƒŒæ™¯ä¸åŠ¨æœº

- åœ¨æ’æ˜Ÿå…‰è°± $\log g$ é¢„æµ‹ä»»åŠ¡ä¸­ï¼Œè§‚æµ‹å™ªå£°æ˜¯å½±å“æ¨¡å‹æ€§èƒ½çš„å…³é”®å› ç´ 
- å½“å™ªå£°æ°´å¹³å‡é«˜æ—¶ï¼Œå…¨å…‰è°± (4096 ç»´) è¾“å…¥å¯èƒ½å¼•å…¥è¿‡å¤šå™ªå£°ä¿¡æ¯ï¼Œå¯¼è‡´æ¨¡å‹è¿‡æ‹Ÿåˆå™ªå£°è€Œéç‰©ç†ä¿¡å·
- æœ¬ç ”ç©¶æ—¨åœ¨ï¼š
  - é‡åŒ–ä¸åŒå™ªå£°æ°´å¹³ä¸‹æ¨¡å‹æ€§èƒ½çš„é€€åŒ–è§„å¾‹
  - éªŒè¯ Top-K ç‰¹å¾é€‰æ‹©æ˜¯å¦èƒ½æå‡é«˜å™ªå£°åœºæ™¯ä¸‹çš„é¢„æµ‹æ€§èƒ½
  - ä¸ºç¥ç»ç½‘ç»œæ¶æ„è®¾è®¡æä¾›ç‰¹å¾é€‰æ‹©ç­–ç•¥æŒ‡å¯¼

## 1.2 æ ¸å¿ƒå‡è®¾

- **å‡è®¾ 1**ï¼šåœ¨é«˜å™ªå£°åœºæ™¯ä¸‹ï¼Œåªä½¿ç”¨éƒ¨åˆ†ã€Œé‡è¦å…‰è°±ç‚¹/patch (Top-K)ã€å¯èƒ½ä¼˜äºä½¿ç”¨å…¨éƒ¨ 4096 ç‰¹å¾
- **å‡è®¾ 2**ï¼šé«˜å™ªå£°è®­ç»ƒ (noise-augmented training) èƒ½æå‡æ¨¡å‹å¯¹å™ªå£°çš„é²æ£’æ€§
- **å‡è®¾ 3**ï¼šè§‚æµ‹è¯¯å·® $\sigma$ æœ¬èº«å¯èƒ½ç¼–ç äº†æ’æ˜Ÿç‰©ç†ä¿¡æ¯

## 1.3 éªŒè¯é—®é¢˜

- Top-K ç‰¹å¾é€‰æ‹©åœ¨ä½•ç§å™ªå£°æ°´å¹³ä¸‹å¼€å§‹ä¼˜äºå…¨å…‰è°±ï¼Ÿ
- æœ€ä¼˜çš„ $K$ å€¼æ˜¯å¤šå°‘ï¼Ÿæ˜¯å¦éšå™ªå£°æ°´å¹³å˜åŒ–ï¼Ÿ
- é«˜å™ªå£°è®­ç»ƒä¸ Top-K ç‰¹å¾é€‰æ‹©å“ªä¸ªç­–ç•¥æ›´æœ‰æ•ˆï¼Ÿ
- Error $\sigma$ ä½œä¸ºè¾“å…¥ç‰¹å¾èƒ½å¦é¢„æµ‹ $\log g$ï¼Ÿ

---

# 2. ğŸ§ª å®éªŒè®¾è®¡ï¼ˆExperiment Designï¼‰

## 2.1 æ•°æ®ï¼ˆDataï¼‰

- **è®­ç»ƒæ ·æœ¬æ•°ï¼š** 32,000
- **æµ‹è¯•æ ·æœ¬æ•°ï¼š** 8,000
- **ç‰¹å¾ç»´åº¦ï¼š** 4096 (åˆæˆå…‰è°±æ³¢é•¿ç‚¹)
- **æ ‡ç­¾å‚æ•°ï¼š** $\log g$
- **å™ªå£°æ¨¡å‹ï¼š** åŒæ–¹å·®é«˜æ–¯å™ªå£°

$$
\text{noisy\_flux} = \text{flux} + \mathcal{N}(0, \sigma^2)
$$

- **å™ªå£°æ°´å¹³èŒƒå›´ï¼š** $\sigma \in \{0, 10^{-4}, 0.001, 0.01, 0.02, 0.05, 0.1, 0.2, 0.5, 1.0, 2.0\}$

## 2.2 ä½¿ç”¨çš„ç‰¹å¾ç±»å‹

| ç‰¹å¾ç±»å‹ | æè¿° | ç»´åº¦ |
|---------|------|------|
| Full Spectrum | å…¨éƒ¨æ³¢é•¿ç‚¹ | 4096 |
| Top-K Pixels | åŸºäºé‡è¦æ€§æ’åºé€‰æ‹©å‰ K ä¸ªåƒç´  | K âˆˆ {50, 100, 200, 500, 1000, 2000, 3280} |
| Patch-based | æ»‘åŠ¨çª—å£ patch é€‰æ‹© (P=patch\_size, S=stride) | å¯å˜ |
| Error-only | ä»…ä½¿ç”¨è§‚æµ‹è¯¯å·® $\sigma$ | 4096 |

## 2.3 æ¨¡å‹ä¸ç®—æ³•ï¼ˆModel & Algorithmï¼‰

### çº¿æ€§å›å½’ (OLS)

$$
\hat{y} = X w + b
$$

### å²­å›å½’ (Ridge)

$$
w = (X^\top X + \alpha I)^{-1} X^\top y
$$

### LightGBM

- æ¢¯åº¦æå‡å†³ç­–æ ‘
- num\_estimators: 1000
- å…¶ä»–å‚æ•°: é»˜è®¤é…ç½®

### ç‰¹å¾é‡è¦æ€§è®¡ç®—

- Ridge: åŸºäºç³»æ•°ç»å¯¹å€¼ $|w_i|$
- LightGBM: åŸºäºç‰¹å¾åˆ†è£‚å¢ç›Š

## 2.4 è¶…å‚æ•°ï¼ˆHyperparametersï¼‰

| å‚æ•° | å€¼ / èŒƒå›´ |
|------|----------|
| Ridge $\alpha$ | 0.001, 0.01, 0.1, 1.0, 100 |
| Top-K $K$ | 50, 100, 200, 500, 1000, 2000, 3280 |
| Patch size $P$ | 4, 5, 8, 16, 20, 32 |
| Stride $S$ | 2, 4, 5, 8, 16, 32 |
| LightGBM estimators | 1000 |
| è®­ç»ƒå™ªå£°æ°´å¹³ | 0.0, 0.1, 0.5, 1.0, 1.2, 2.0 |

---

# 3. ğŸ“Š å®éªŒç»“æœè¡¨ï¼ˆResultsï¼‰

## 3.1 Full Spectrum Baselines - æŒ‰å™ªå£°æ°´å¹³

### OLS (æ— æ­£åˆ™åŒ–)

| noise\_level | $R^2$ | MAE | RMSE | notes |
|-------------|-------|-----|------|-------|
| 0.0 | **0.9694** | 0.0380 | 0.0511 | OLS baseline |
| 0.01 | 0.9684 | 0.0377 | 0.0519 | |
| 0.02 | 0.9653 | 0.0396 | 0.0544 | |
| 0.05 | 0.9500 | 0.0475 | 0.0653 | |
| 0.1 | 0.9007 | 0.0673 | 0.0920 | |
| 0.2 | 0.8108 | 0.0960 | 0.1270 | |
| 0.5 | 0.6075 | 0.1397 | 0.1829 | |
| 1.0 | 0.3851 | 0.1776 | 0.2290 | |
| 2.0 | 0.1312 | 0.2214 | 0.2722 | |

### Ridge ($\alpha=100$)

| noise\_level | $R^2$ | MAE | RMSE | notes |
|-------------|-------|-----|------|-------|
| 0.0 | 0.7943 | 0.1014 | 0.1324 | Ridge baseline |
| 0.05 | 0.7897 | 0.1027 | 0.1339 | |
| 0.1 | 0.7802 | 0.1051 | 0.1369 | |
| 0.2 | 0.7546 | 0.1117 | 0.1446 | |
| 0.5 | 0.6493 | 0.1357 | 0.1729 | |
| 1.0 | **0.4507** | 0.1730 | 0.2164 | Best Ridge @ N=1.0 |
| 2.0 | 0.1709 | 0.2184 | 0.2659 | |

### LightGBM (Full Spectrum)

| noise\_level | $R^2$ | MAE | RMSE | notes |
|-------------|-------|-----|------|-------|
| 0.0 | **0.9981** | 0.0082 | 0.0128 | LightGBM baseline |
| 0.01 | 0.9902 | 0.0182 | 0.0289 | |
| 0.05 | 0.9807 | 0.0276 | 0.0406 | |
| 0.1 | 0.9616 | 0.0397 | 0.0572 | |
| 0.2 | 0.9045 | 0.0634 | 0.0902 | |
| 0.5 | 0.7393 | 0.1134 | 0.1491 | |
| 1.0 | **0.5361** | 0.1579 | 0.1989 | |
| 2.0 | 0.2679 | 0.2081 | 0.2498 | |

## 3.2 Top-K Pixel Selection (Ridge, importance from nz=1.0)

### Test @ N=0.0

| K | n\_features | coverage | $R^2$ | MAE | RMSE |
|---|-------------|----------|-------|-----|------|
| 50 | 50 | 1.2% | 0.5247 | 0.1693 | 0.2013 |
| 100 | 100 | 2.4% | 0.6114 | 0.1492 | 0.1820 |
| 200 | 200 | 4.9% | 0.7150 | 0.1234 | 0.1559 |
| 500 | 500 | 12.2% | 0.7527 | 0.1129 | 0.1452 |
| 1000 | 1000 | 24.4% | **0.7670** | 0.1087 | 0.1409 |
| 2000 | 2000 | 48.8% | 0.7807 | 0.1049 | 0.1367 |

### Test @ N=0.5

| K | n\_features | coverage | $R^2$ | MAE | RMSE |
|---|-------------|----------|-------|-----|------|
| 50 | 50 | 1.2% | 0.4537 | 0.1792 | 0.2158 |
| 100 | 100 | 2.4% | 0.5302 | 0.1637 | 0.2001 |
| 200 | 200 | 4.9% | 0.5978 | 0.1490 | 0.1852 |
| 500 | 500 | 12.2% | 0.6473 | 0.1386 | 0.1734 |
| **1000** | 1000 | 24.4% | **0.6593** | 0.1354 | 0.1704 |
| 2000 | 2000 | 48.8% | 0.6544 | 0.1358 | 0.1716 |

### Test @ N=1.0 â­ Key Results

| K | n\_features | coverage | $R^2$ | MAE | RMSE | $\Delta R^2$ vs Full |
|---|-------------|----------|-------|-----|------|---------------------|
| 50 | 50 | 1.2% | 0.2093 | 0.2085 | 0.2596 | +0.450 |
| 100 | 100 | 2.4% | 0.2614 | 0.1992 | 0.2509 | +0.502 |
| 200 | 200 | 4.9% | 0.2515 | 0.1977 | 0.2526 | +0.492 |
| 500 | 500 | 12.2% | 0.3285 | 0.1845 | 0.2393 | +0.569 |
| **1000** | **1000** | **24.4%** | **0.3398** | **0.1827** | **0.2372** | **+0.581** |
| 2000 | 2000 | 48.8% | 0.2794 | 0.1898 | 0.2479 | +0.520 |

> ğŸ† **Best Top-K: K=1000 @ N=1.0 achieves $R^2=0.34$, +0.58 vs Full Spectrum Ridge ($R^2=-0.24$)**

### Test @ N=2.0

| K | n\_features | coverage | $R^2$ | MAE | RMSE |
|---|-------------|----------|-------|-----|------|
| 50 | 50 | 1.2% | -0.7992 | 0.3023 | 0.3916 |
| 100 | 100 | 2.4% | -0.8392 | 0.3030 | 0.3960 |
| 500 | 500 | 12.2% | -0.9491 | 0.2990 | 0.4076 |
| 1000 | 1000 | 24.4% | -0.9343 | 0.2980 | 0.4061 |
| 2000 | 2000 | 48.8% | -1.2170 | 0.3183 | 0.4347 |

## 3.3 LightGBM Top-K vs Full Spectrum Comparison

| test\_noise | full $R^2$ | top-k $R^2$ | $\Delta R^2$ | K | feats | selection |
|-------------|------------|-------------|--------------|---|-------|-----------|
| 0.0 | 0.9982 | 0.9981 | -0.00012 | 512 | 4096 | patch |
| 0.1 | 0.9616 | 0.9616 | 0.00000 | 512 | 4096 | patch |
| 0.2 | 0.9045 | 0.9047 | +0.00018 | 500 | 4000 | patch |
| 0.5 | 0.7393 | 0.7417 | +0.00248 | 1000 | 4000 | patch |
| 1.0 | 0.5361 | 0.5373 | +0.00120 | 1000 | 4000 | patch |
| 2.0 | 0.2679 | 0.2696 | +0.00170 | 3280 | 3280 | pixel |

## 3.4 é«˜å™ªå£°è®­ç»ƒ (nz=1.2)

### Full Spectrum

| train\_noise | test\_noise | $R^2$ | MAE | RMSE | notes |
|-------------|-------------|-------|-----|------|-------|
| 1.2 | 0.0 | 0.6000 | 0.1533 | 0.1859 | |
| 1.2 | 0.5 | 0.5670 | 0.1579 | 0.1927 | |
| **1.2** | **1.0** | **0.4710** | 0.1742 | 0.2126 | ğŸ† **BEST @ N=1.0** |
| 1.2 | 2.0 | 0.0830 | 0.2168 | 0.2760 | Still positive! |

## 3.5 Error-Only Features ($\sigma$ as input)

| model | $\alpha$ | $R^2$ | MAE | RMSE | notes |
|-------|----------|-------|-----|------|-------|
| Ridge | 0.001 | **0.9103** | 0.0632 | 0.0874 | ğŸ”¥ Error predicts $\log g$! |
| Ridge | 0.01 | 0.7576 | 0.1111 | 0.1438 | |
| Ridge | 0.1 | 0.4023 | 0.1929 | 0.2257 | |
| Ridge | 1.0 | 0.0917 | 0.2400 | 0.2783 | |
| Ridge | 100 | -0.0009 | 0.2509 | 0.2921 | Over-regularized |

## 3.6 PCA + Linear Regression

| n\_components | regularization | $\alpha$ | $R^2$ | MAE | RMSE |
|---------------|---------------|----------|-------|-----|------|
| 50 | Ridge | 0.001 | 0.9754 | 0.0335 | 0.0458 |
| 100 | Ridge | 0.001 | 0.9936 | 0.0160 | 0.0234 |
| 200 | Ridge | 0.0001 | **0.9985** | 0.0075 | 0.0114 |
| 500 | Ridge | 0.0001 | 0.9995 | 0.0042 | 0.0065 |
| 1000 | Ridge | 0.0001 | 0.9995 | 0.0042 | 0.0064 |

## 3.7 Summary: Best $R^2$ at Each Noise Level

| Noise Level | Best Method | Best $R^2$ | Notes |
|-------------|-------------|------------|-------|
| **0.0** | LightGBM Full | **0.998** | Baseline best |
| **0.1** | LightGBM Full | **0.962** | Still excellent |
| **0.5** | LightGBM Full | **0.739** | Moderate degradation |
| **1.0** | Ridge nz1.2 Full | **0.471** | High-noise training wins |
| **2.0** | LightGBM Full | **0.268** | All methods struggle |

---

# 4. ğŸ’¡ å…³é”®æ´è§ï¼ˆKey Insightsï¼‰

## 4.1 å®è§‚å±‚æ´è§ï¼ˆç”¨äºæŒ‡å¯¼ Neural Network æ¶æ„è®¾è®¡ï¼‰

1. **Top-K ç‰¹å¾é€‰æ‹©åœ¨é«˜å™ªå£°ä¸‹æ˜¾è‘—æœ‰æ•ˆ**
   - Ridge æ¨¡å‹åœ¨ $N=1.0$ æ—¶ï¼šTop-K ($K=1000$) çš„ $R^2=0.34$ vs Full Spectrum çš„ $R^2=-0.24$ï¼Œæå‡ $\Delta R^2=+0.58$
   - ä½† LightGBM çš„æå‡å¾ˆå°ï¼ˆ$\Delta R^2 < 0.003$ï¼‰ï¼Œè¯´æ˜éçº¿æ€§æ¨¡å‹æœ¬èº«å…·æœ‰éšå¼ç‰¹å¾é€‰æ‹©èƒ½åŠ›

2. **æœ€ä¼˜ $K$ éšå™ªå£°æ°´å¹³å˜åŒ–**
   - $N=0.0$: $K \approx 2000$ (48.8% coverage)
   - $N=0.5 \sim 1.0$: $K \approx 1000$ (24.4% coverage) â€” **Sweet Spot**
   - ç¥ç»ç½‘ç»œå¯è€ƒè™‘åŠ¨æ€è°ƒæ•´ attention æƒé‡

3. **Error $\sigma$ ç¼–ç äº†æ’æ˜Ÿç‰©ç†ä¿¡æ¯**
   - ä»…ä½¿ç”¨ error ç‰¹å¾å¯è¾¾åˆ° $R^2=0.91$
   - å»ºè®® NN è¾“å…¥è®¾è®¡: $X = [\text{flux}, \sigma]$ æˆ– $\text{SNR} = \text{flux}/\sigma$

## 4.2 æ¨¡å‹å±‚æ´è§ï¼ˆç”¨äºä¼˜åŒ–æ¨¡å‹ï¼‰

1. **é«˜å™ªå£°è®­ç»ƒ (noise-augmented training) æœ€æœ‰æ•ˆ**
   - Ridge + nz1.2 training åœ¨ $N=1.0$ æµ‹è¯•æ—¶è¾¾åˆ° $R^2=0.47$ï¼Œè¶…è¿‡ Top-K çš„ $R^2=0.34$
   - å»ºè®®è®­ç»ƒå™ªå£°ç•¥é«˜äºç›®æ ‡å™ªå£°ï¼š$\text{train\_noise} \approx 1.2 \times \text{target\_noise}$

2. **LightGBM åœ¨æ‰€æœ‰å™ªå£°æ°´å¹³ä¸‹éƒ½æœ€ä¼˜**
   - ä½† Top-K å®éªŒåªåœ¨ Ridge ä¸Šè¿›è¡Œ
   - éœ€è¦è¡¥å…… Top-K + LightGBM ç»„åˆå®éªŒ

3. **Ridge $\alpha=100$ åœ¨é«˜å™ªå£°ä¸‹è¿‡åº¦æ­£åˆ™åŒ–**
   - å¯¼è‡´ $R^2 \approx 0$ ç”šè‡³ä¸ºè´Ÿ
   - éœ€è¦æ ¹æ®å™ªå£°æ°´å¹³è°ƒæ•´ $\alpha$

## 4.3 å®éªŒå±‚ç»†èŠ‚æ´è§

1. **Random subset ä½œä¸ºå¯¹ç…§å®Œå…¨å¤±è´¥**
   - LightGBM random masks: $R^2 \in \{-0.138, 0.157, -0.676, -1.255\}$ for noise $\{0, 0.1, 0.2, 0.5\}$
   - è¯æ˜ Top-K çš„é‡è¦æ€§æ’åºæ˜¯å…³é”®

2. **Patch-based ç•¥é€Šäº Pixel-based**
   - Patch (P=5, K=411): $R^2=0.25$ @ N=1.0
   - Top-K Pixels (K=1000): $R^2=0.34$ @ N=1.0

3. **æç«¯å™ªå£° ($N \geq 2.0$) æ— æœ‰æ•ˆæ–¹æ³•**
   - æ‰€æœ‰æ¨¡å‹ $R^2 < 0.27$ï¼Œéœ€è¦æ›´å…ˆè¿›çš„é™å™ªç­–ç•¥

---

# 5. ğŸ“‰ å»ºè®®ç»˜å›¾ï¼ˆPlot Suggestionsï¼‰

## 5.1 å™ªå£°é€€åŒ–æ›²çº¿

- X è½´: å™ªå£°æ°´å¹³ $\sigma \in [0, 2.0]$
- Y è½´: $R^2$
- å¤šæ¡æ›²çº¿: OLS / Ridge / LightGBM (Full Spectrum)
- ç›®çš„: å±•ç¤ºä¸åŒæ¨¡å‹å¯¹å™ªå£°çš„æ•æ„Ÿæ€§

## 5.2 Top-K vs Full Spectrum å¯¹æ¯”å›¾

- X è½´: $K$ å€¼ (50 â†’ 4096)
- Y è½´: $R^2$
- å¤šæ¡æ›²çº¿: ä¸åŒå™ªå£°æ°´å¹³ ($N=0, 0.5, 1.0, 2.0$)
- æ ‡æ³¨ Sweet Spot $K \approx 1000$

## 5.3 $\Delta R^2$ (Top-K - Full) vs å™ªå£°æ°´å¹³

- X è½´: å™ªå£°æ°´å¹³
- Y è½´: $\Delta R^2$
- æ ‡æ³¨ break-even point: $N \approx 0.5$

## 5.4 é«˜å™ªå£°è®­ç»ƒæ•ˆæœå¯¹æ¯”

- Bar chart: ä¸åŒè®­ç»ƒç­–ç•¥åœ¨ $N=1.0$ æµ‹è¯•æ—¶çš„ $R^2$
- ç­–ç•¥: nz0 train / nz1.0 train / nz1.2 train / Top-K

## 5.5 Error-only é¢„æµ‹èƒ½åŠ›

- Scatter plot: Error-predicted $\log g$ vs True $\log g$
- æ ‡æ³¨ $R^2=0.91$

---

# 6. ğŸ“ ç»“è®ºï¼ˆConclusionï¼‰

## 6.1 æ ¸å¿ƒå‘ç°

> **Top-K ç‰¹å¾é€‰æ‹© ($K \approx 1000$, 24.4% coverage) åœ¨é«˜å™ªå£° ($N \geq 0.5$) ä¸‹æ˜¾è‘—ä¼˜äºå…¨å…‰è°±è¾“å…¥ï¼Œä½†é«˜å™ªå£°è®­ç»ƒ (noise-augmented training) æ•ˆæœæ›´ä½³ã€‚**

- âŒ åŸå‡è®¾ï¼š"å° $K$ (<25% ç‰¹å¾) èƒ½æ˜¾è‘—æå‡é«˜å™ªå£°æ€§èƒ½"
- âœ… å®éªŒç»“æœï¼šTop-K åœ¨ Ridge æ¨¡å‹ä¸Šæå‡ $\Delta R^2=+0.58$ @ $N=1.0$ï¼Œä½† LightGBM æå‡å¾ˆå°ï¼›é«˜å™ªå£°è®­ç»ƒç­–ç•¥æ›´æœ‰æ•ˆ

## 6.2 å…³é”®ç»“è®ºï¼ˆ2-4 æ¡ï¼‰

| # | ç»“è®º | è¯æ® |
|---|------|------|
| 1 | **Top-K åœ¨çº¿æ€§æ¨¡å‹é«˜å™ªå£°ä¸‹æœ‰æ•ˆ** | Ridge: $\Delta R^2=+0.58$ @ $N=1.0$, $K=1000$ |
| 2 | **é«˜å™ªå£°è®­ç»ƒæ•ˆæœæœ€ä½³** | Ridge nz1.2: $R^2=0.47$ vs Top-K: $R^2=0.34$ @ $N=1.0$ |
| 3 | **Error $\sigma$ åŒ…å«ç‰©ç†ä¿¡æ¯** | Error-only Ridge: $R^2=0.91$ ($\alpha=0.001$) |
| 4 | **LightGBM éšå¼ç‰¹å¾é€‰æ‹©èƒ½åŠ›å¼º** | Top-K å¯¹ LightGBM æå‡ $< 0.003$ |

## 6.3 è®¾è®¡å¯ç¤º

### æ¶æ„åŸåˆ™

| åŸåˆ™ | å»ºè®® | åŸå›  |
|------|------|------|
| ç‰¹å¾é€‰æ‹©å‰ç«¯ | å­¦ä¹  soft masks æˆ– attention | Top-K è¯æ˜ç¨€ç–ç‰¹å¾æœ‰æ•ˆ |
| è¾“å…¥å¢å¼º | ä½¿ç”¨ $[\text{flux}, \sigma]$ æˆ– SNR | Error ç¼–ç ç‰©ç†ä¿¡æ¯ ($R^2=0.91$) |
| è®­ç»ƒç­–ç•¥ | Noise augmentation ($1.2 \times$ target) | nz1.2 training æœ€ä½³ |
| æ®‹å·®è·¯å¾„ | ä¿ç•™ full-spectrum åˆ†æ”¯ | é¿å…è¿‡åº¦å‰ªæ (K<3000 æ—¶å´©æºƒ) |

### âš ï¸ å¸¸è§é™·é˜±

| å¸¸è§åšæ³• | å®éªŒè¯æ® |
|----------|----------|
| "å¤§å¹…å‰ªæç‰¹å¾ (K<500) èƒ½æå‡é«˜å™ªå£°æ€§èƒ½" | K<500 æ—¶ $R^2$ æ€¥å‰§ä¸‹é™ï¼ŒRandom subset å®Œå…¨å¤±è´¥ |
| "LightGBM éœ€è¦æ˜¾å¼ Top-K" | LightGBM å·²æœ‰éšå¼ç‰¹å¾é€‰æ‹©ï¼Œ$\Delta R^2 < 0.003$ |
| "å…¨å…‰è°± + ä½å™ªå£°è®­ç»ƒè¶³å¤Ÿ" | åœ¨ $N=1.0$ æµ‹è¯•æ—¶ Ridge Full: $R^2=-0.24$ |

## 6.4 ç‰©ç†è§£é‡Š

1. **Error $\sigma$ ç¼–ç æ’æ˜Ÿç‰©ç†**ï¼šè§‚æµ‹è¯¯å·®ä¸æ’æ˜Ÿäº®åº¦ã€è¡¨é¢é‡åŠ›ç›¸å…³ï¼Œæš—æ˜Ÿ/ä½ $\log g$ æ˜Ÿå…·æœ‰æ›´å¤§çš„ç›¸å¯¹è¯¯å·®
2. **Top-K æœ‰æ•ˆæ€§**ï¼š$\log g$ ä¿¡æ¯é›†ä¸­åœ¨ç‰¹å®šå…‰è°±ç‰¹å¾ï¼ˆå¦‚ Balmer wings, Ca II tripletï¼‰ï¼Œé«˜å™ªå£°ä¸‹è¿™äº›å…³é”®ç‰¹å¾è¢«å™ªå£°æ·¹æ²¡
3. **é«˜å™ªå£°è®­ç»ƒæœ‰æ•ˆæ€§**ï¼šæ¨¡å‹åœ¨è®­ç»ƒæ—¶å­¦ä¼šäº†å¯¹å™ªå£°çš„é²æ£’è¡¨ç¤º

## 6.5 å…³é”®æ•°å­—é€ŸæŸ¥

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| æœ€ä½³æ— å™ªå£°æ€§èƒ½ | $R^2=0.998$ (LightGBM Full) |
| é«˜å™ªå£° ($N=1.0$) æœ€ä½³æ€§èƒ½ | $R^2=0.471$ (Ridge nz1.2 Full) |
| Top-K Sweet Spot | $K=1000$ (24.4% coverage) |
| Top-K æœ€å¤§æå‡ | $\Delta R^2=+0.58$ @ $N=1.0$ (vs Ridge Full) |
| Error-only é¢„æµ‹èƒ½åŠ› | $R^2=0.91$ ($\alpha=0.001$) |

## 6.6 ä¸‹ä¸€æ­¥å·¥ä½œ

| æ–¹å‘ | å…·ä½“ä»»åŠ¡ |
|------|----------|
| Top-K + LightGBM | éªŒè¯ Top-K å¯¹éçº¿æ€§æ¨¡å‹æ˜¯å¦æœ‰æ•ˆ |
| Cross-noise è¯„ä¼° | å®Œæ•´çš„ train\_noise $\times$ test\_noise çŸ©é˜µ |
| å¼‚æ–¹å·®å™ªå£° | ä½¿ç”¨çœŸå® error map ç”Ÿæˆå™ªå£° |
| Flux + Error è”åˆè¾“å…¥ | æµ‹è¯• 8192 ç»´ $[\text{flux}, \sigma]$ è¾“å…¥ |
| ç¥ç»ç½‘ç»œéªŒè¯ | ViT + Top-K gating æ¶æ„ |

## 6.7 ç›¸å…³æ–‡ä»¶

| ç±»å‹ | è·¯å¾„ |
|------|------|
| ç»Ÿä¸€å®éªŒè¡¨ | `/home/swei20/VIT/results/noise/all_noise_experiments.csv` |
| ç»“æœæ±‡æ€» | `/home/swei20/VIT/results/noise/summary_noise_topk.md` |
| GPT åˆ†æ | `/home/swei20/VIT/gpt/noise/all_noise_experiments.md` |
| Top-K vs Full å¯¹æ¯” | `/home/swei20/VIT/gpt/noise/topk_vs_full_comparison.md` |

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-11-28*  
*å®éªŒè¦†ç›–: 2000+ ç‹¬ç«‹å®éªŒé…ç½®*  
*æ ¸å¿ƒå‘ç°: Top-K ($K=1000$) åœ¨çº¿æ€§æ¨¡å‹ + é«˜å™ªå£°ä¸‹æå‡ $\Delta R^2=+0.58$ï¼›é«˜å™ªå£°è®­ç»ƒç­–ç•¥æ•ˆæœæœ€ä½³*

